var aminder=function(){var e="1.5.4",t="1.4.43",n=function(e,t){function n(e){for(var t=e.toString().split("."),n=["","0","00","000","0000"].reverse(),r=0;r<t.length;r++){var o=t[r].length;t[r]=n[o]+t[r]}return t.join("")}var r=n(e),o=n(t);return r==o?0:r>o?-1:r<o?1:void 0},r={},o=kity.Utils.extend.bind(kity.Utils),i=kity.Utils.each.bind(kity.Utils);function a(e){var t=Object.prototype.toString;return function(n){return t.apply(n)=="[object "+e+"]"}}var s=a("String"),c=a("Function"),l=a("Array"),u=a("Number"),d=a("RegExp"),h=a("Object"),g=a("Undefined"),f=a("Null"),p={extend:o,each:i,uuid:function(e){return r[e]=r[e]?r[e]+1:1,e+r[e]},guid:function(){return(1e6*+new Date+Math.floor(1e6*Math.random())).toString(36)},trim:function(e){return e.replace(/(^[ \t\n\r]+)|([ \t\n\r]+$)/g,"")},keys:function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(n);return t},clone:function(e){return JSON.parse(JSON.stringify(e))},comparePlainObject:function(e,t){return JSON.stringify(e)==JSON.stringify(t)},clearWhiteSpace:function(e){return e.replace(/[\u200b\t\r\n]/g,"")},encodeHtml:function(e,t){return e?e.replace(t||/[&<">'](?:(amp|lt|quot|gt|#39|nbsp);)?/g,(function(e,t){return t?e:{"<":"&lt;","&":"&amp;",'"':"&quot;",">":"&gt;","'":"&#39;"}[e]})):""},isString:s,isFunction:c,isArray:l,isNumber:u,isRegExp:d,isObject:h,isUndefined:g,isNull:f,isEmpty:function(e){return g(e)||f(e)},throttle:function(e,t){t=void 0===t?300:t;var n=!0;return function(){if(n){n=!1;var r=this,o=arguments;setTimeout((function(){e.apply(r,o),n=!0}),t)}}},checkBridgeApi:function(e){return window.bridge&&"function"==typeof window.bridge[e]},debounce:function(e,t){t=void 0===t?300:t;var n=null;return function(){var r=this,o=arguments;clearTimeout(n),n=setTimeout((function(){e.apply(r,o)}),t)}},getTanDeg:function(e,t){var n=(t.y-e.y)/(t.x-e.x),r=Math.atan(n)/(Math.PI/180);return Math.abs(Math.round(r))},getQuadrant:function(e,t){var n=e.getLayoutBox(),r=t.getLayoutBox(),o=n.cx>r.cx?"right":"left",i=n.cy>r.cy?"bottom":"top";return"right"===o&&"top"===i?1:"right"===o&&"bottom"===i?2:"left"===o&&"top"===i?3:4},getOrientation:function(){return 90==window.orientation||-90==window.orientation?"portrait":0==window.orientation||180==window.orientation?"landscape":void 0}},m=[],y=kity.createClass("Minder",{constructor:function(e){this._options=p.extend({},e);for(var t,n=m.slice();n.length;)"function"==typeof(t=n.shift())&&t.call(this,this._options);this.fire("finishInitHook")}});y.registerInitHook=function(e){m.push(e)};var b=kity.createClass("MindEvent",{constructor:function(e,t,n){(t=t||{}).getType&&"ShapeEvent"==t.getType()?(this.kityEvent=t,this.originEvent=t.originEvent):t.target&&t.preventDefault?this.originEvent=t:kity.Utils.extend(this,t),this.type=e,this._canstop=n||!1},getPosition:function(e){if(this.kityEvent)return e&&"minder"!=e?this.kityEvent.getPosition(e):this.kityEvent.getPosition(this.minder.getRenderContainer())},getTargetNode:function(){var e=this.kityEvent&&this.kityEvent.targetShape;if(!e)return null;for(;!e.minderNode&&e.container;)e=e.container;var t=e.minderNode;return t&&e.getOpacity()<1?null:t||null},stopPropagation:function(){this._stoped=!0},stopPropagationImmediately:function(){this._immediatelyStoped=!0,this._stoped=!0},shouldStopPropagation:function(){return this._canstop&&this._stoped},shouldStopPropagationImmediately:function(){return this._canstop&&this._immediatelyStoped},preventDefault:function(){this.originEvent.preventDefault()},isRightMB:function(){var e=!1;return!!this.originEvent&&("which"in this.originEvent?e=3==this.originEvent.which:"button"in this.originEvent&&(e=2==this.originEvent.button),e)},getKeyCode:function(){var e=this.originEvent;return e.keyCode||e.which}});y.registerInitHook((function(e){this._initEvents()})),kity.extendClass(y,{_initEvents:function(){this._eventCallbacks={}},_resetEvents:function(){this._initEvents(),this._bindEvents()},_bindEvents:function(){this._paper.on("click dblclick mousedown contextmenu mouseup mousemove mouseover mousewheel DOMMouseScroll touchstart touchmove touchend dragenter dragleave drop wheel",this._firePharse.bind(this)),window&&window.addEventListener("resize",this._firePharse.bind(this))},dispatchKeyEvent:function(e){this._firePharse(e)},_firePharse:function(e){var t,n,r;t=new b("before"+e.type,e,!0),this._fire(t)||(n=new b("pre"+e.type,e,!0),r=new b(e.type,e,!0),(this._fire(n)||this._fire(r))&&this._fire(new b("after"+e.type,e,!1)))},_interactChange:function(e){var t=this;t._interactScheduled||(setTimeout((function(){t._fire(new b("interactchange")),t._interactScheduled=!1}),100),t._interactScheduled=!0)},_listen:function(e,t){(this._eventCallbacks[e]||(this._eventCallbacks[e]=[])).push(t)},_fire:function(e){e.minder=this;var t=this.getStatus(),n=this._eventCallbacks[e.type.toLowerCase()]||[];if(t&&(n=n.concat(this._eventCallbacks[t+"."+e.type.toLowerCase()]||[])),0!==n.length){for(var r=0;r<n.length&&(n[r].call(this,e),!e.shouldStopPropagationImmediately());r++);return e.shouldStopPropagation()}},on:function(e,t){var n=this;return e.split(/\s+/).forEach((function(e){n._listen(e.toLowerCase(),t)})),this},once:function(e,t){var n=this;return e.split(/\s+/).forEach((function(r){n._listen(r.toLowerCase(),(function r(o){t.call(n,o),n.off(e,r)}))})),this},off:function(e,t){var n,r,o,i,a=e.split(/\s+/);for(n=0;n<a.length;n++)if(o=this._eventCallbacks[a[n].toLowerCase()]){for(i=null,r=0;r<o.length;r++)o[r]==t&&(i=r);null!==i&&o.splice(i,1)}},fire:function(e,t){var n=new b(e,t);return this._fire(n),this}});var v=kity.createClass("Command",{constructor:function(){this._isContentChange=!0,this._isSelectionChange=!1},execute:function(e,t){throw new Error("Not Implement: Command.execute()")},setContentChanged:function(e){this._isContentChange=!!e},isContentChanged:function(){return this._isContentChange},setSelectionChanged:function(e){this._isSelectionChange=!!e},isSelectionChanged:function(){return this._isContentChange},queryState:function(e){return 0},queryValue:function(e){return 0},isNeedUndo:function(){return!0}});v.STATE_NORMAL=0,v.STATE_ACTIVE=1,v.STATE_DISABLED=-1,kity.extendClass(y,{_getCommand:function(e){return this._commands[e.toLowerCase()]},_queryCommand:function(e,t,n){var r=this._getCommand(e);if(r){var o=r["query"+t];if(o)return o.apply(r,[this].concat(n))}return 0},queryCommandState:function(e){return this._queryCommand(e,"State",[].slice.call(arguments,1))},queryCommandValue:function(e){return this._queryCommand(e,"Value",[].slice.call(arguments,1))},execCommand:function(e){if(!e)return null;e=e.toLowerCase();var t,n,r,o=[].slice.call(arguments,1),i=this;return r={command:t=this._getCommand(e),commandName:e.toLowerCase(),commandArgs:o},!(!t||!~this.queryCommandState(e))&&(this._hasEnterExecCommand?(n=t.execute.apply(t,[i].concat(o)),this._hasEnterExecCommand||this._interactChange()):(this._hasEnterExecCommand=!0,this._fire(new b("beforeExecCommand",r,!0))||(this._fire(new b("preExecCommand",r,!1)),n=t.execute.apply(t,[i].concat(o)),this._fire(new b("execCommand",r,!1)),t.isContentChanged()&&this._firePharse(new b("contentchange")),this._interactChange()),this._hasEnterExecCommand=!1),void 0===n?null:n)}});var w="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},k=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},x=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),C=function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e},S=function e(t,n,r){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,n);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,n,r)}if("value"in o)return o.value;var a=o.get;return void 0!==a?a.call(r):void 0},A=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},M=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],r=!0,o=!1,i=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){o=!0,i=e}finally{try{!r&&s.return&&s.return()}finally{if(o)throw i}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},R=kity.createClass("MinderNode",{constructor:function(e){this.parent=null,this.root=this,this.children=[],this.data={id:p.guid(),created:+new Date},this.initContainers(),p.isString(e)?this.setText(e):p.isObject(e)&&p.extend(this.data,e)},initContainers:function(){this.rc=(new kity.Group).setId(p.uuid("minder_node")),this.rc.minderNode=this},isRoot:function(){return this.root===this},isSubtreeRoot:function(){return this.isRoot()&&this.isSubtree},isSubtreeNode:function(){return this.getRoot().isSubtree},isGeneralizeNode:function(){return this.getRoot().isGeneralize},isLeaf:function(){return 0===this.children.length},getRoot:function(){return this.root||this},getParent:function(){return this.parent},getSiblings:function(){var e=this.parent.children,t=[],n=this;return e.forEach((function(e){e!=n&&t.push(e)})),t},getLevel:function(){for(var e=0,t=this.parent;t;)e++,t=t.parent;return e},getComplex:function(){var e=0;return this.traverse((function(){e++})),e},getType:function(e){return this.type=["root","main","sub"][Math.min(this.getLevel(),2)],this.type},isAncestorOf:function(e){for(var t=e.parent;t;){if(t==this)return!0;t=t.parent}return!1},getData:function(e){return e?this.data[e]:this.data},setData:function(e,t){if("object"==(void 0===e?"undefined":w(e))){var n=e;for(e in n)n.hasOwnProperty(e)&&(this.data[e]=t)}else this.data[e]=t;return this},delData:function(e){delete this.data[e]},setText:function(e){return this.data.text=e},getText:function(){return this.data.text||null},setHtml:function(e){return this.data.html=e},getHtml:function(){return this.data.html||null},setContent:function(e,t){void 0!==e&&void 0!==t&&(this.data.html=e,this.data.text=t)},getDataRightNumber:function(){var e=this.getData("right-number");return e=minder.getTemplate()&&minder.getTemplate().includes("right")?this.getChildren().length:p.isNumber(e)?e:Math.ceil(this.getChildren().length/2)},setDataRightNumber:function(e){p.isNumber(e)?this.setData("right-number",e):this.delData("right-number")},preTraverse:function(e,t){var n=this.getChildren();t||e(this);for(var r=0;r<n.length;r++)n[r].preTraverse(e)},postTraverse:function(e,t){for(var n=this.getChildren(),r=0;r<n.length;r++)n[r].postTraverse(e);t||e(this)},traverse:function(e,t){return this.postTraverse(e,t)},getChildren:function(){return this.children},getIndex:function(){return this.parent?this.parent.children.indexOf(this):-1},insertChild:function(e,t){var n=this;p.isEmpty(t)&&(t=this.children.length),e.parent&&e.parent.removeChild(e),e.parent=this,e.root!==this.root&&e.traverse((function(e){e.root=n.root})),this.children.splice(t,0,e)},appendChild:function(e){return this.insertChild(e)},prependChild:function(e){return this.insertChild(e,0)},removeChild:function(e){var t,n=e;e instanceof R&&(n=this.children.indexOf(e)),n>=0&&((t=this.children.splice(n,1)[0]).parent=null,t.root=t)},clearChildren:function(){this.children=[]},getChild:function(e){return this.children[e]},getRenderContainer:function(){return this.rc},getCommonAncestor:function(e){return R.getCommonAncestor([this,e])},contains:function(e){return this==e||this.isAncestorOf(e)},clone:function(){var e=new R;return e.data=p.clone(this.data),this.children.forEach((function(t){e.appendChild(t.clone())})),e},compareTo:function(e){if(!p.comparePlainObject(this.data,e.data))return!1;if(!p.comparePlainObject(this.temp,e.temp))return!1;if(this.children.length!=e.children.length)return!1;for(var t=0;this.children[t];){if(!this.children[t].compareTo(e.children[t]))return!1;t++}return!0},getMinder:function(){return this.getRoot().minder},show:function(){this.setVisible(!0)},hide:function(){this.setVisible(!1)},setVisible:function(e){this.getRenderContainer().setVisible(e),this.visible=e},isFirstChild:function(){return!this.parent||this===this.parent.getChildren()[0]},isLastChild:function(){if(this.parent){var e=this.parent.getChildren();return this===e[e.length-1]}return!0}});p.extend(R,{getCommonAncestor:function(e){if(!e||!e.length)return null;if(1===e.length)return e[0].parent||e[0];return e.reduce((function(e,t){if(!e||!t)return null;if(e.isAncestorOf(t))return e;if(t.isAncestorOf(e))return t;for(var n=e.parent;n&&!n.isAncestorOf(t);)n=n.parent;return n}))},groupWithParent:function(e){var t=[];return e.forEach((function(e){if(e.parent){var n=t.find((function(t){return e.parent===t[0].parent}));n?n.push(e):t.push([e])}})),t}}),kity.extendClass(y,{getRoot:function(){return this._root},setRoot:function(e){this._root=e,e.minder=this},getAllNode:function(){var e=[];return this.getRoot().traverse((function(t){e.push(t)})),p.each(this._subtreeMap,(function(t){t.getRoot().traverse((function(t){e.push(t)}))})),e},getAllNodeExcludeGen:function(){return this.getAllNode().filter((function(e){return!e.isGeneralize}))},getGen:function(){return this.getAllNode().filter((function(e){return e.isGeneralize}))},getNodeById:function(e){return this.getNodesById([e])[0]},getNodesById:function(e){var t=this.getAllNode(),n=[];return t.forEach((function(t){-1!=e.indexOf(t.getData("id"))&&n.push(t)})),n},createNode:function(e,t,n){var r=new R(e);return this.fire("nodecreate",{node:r,parent:t,index:n}),this.appendNode(r,t,n),r},appendNode:function(e,t,n){return t&&t.insertChild(e,n),this.attachNode(e),this},getLayoutTemplate:function(){return this._template||this.root._template},removeNode:function(e){if(e.parent){if("main"===e.getType()){var t=e.getRoot(),n=t.getDataRightNumber();n>e.getIndex()&&t.setDataRightNumber(n-1)}this.fire("beforenodedetach",{node:e}),e.parent.removeChild(e),this.detachNode(e),this.fire("noderemove",{node:e})}},attachNode:function(e){var t=this.getNodeContainer();e.traverse((function(e){e.attached=!0,t.addShape(e.getRenderContainer())})),t.addShape(e.getRenderContainer()),this.fire("nodeattach",{node:e})},getNodeContainer:function(){return this._nodeContainer},detachNode:function(e){var t=this.getNodeContainer();e.traverse((function(e){e.attached=!1,t.removeShape(e.getRenderContainer())})),this.fire("nodedetach",{node:e})},getMinderTitle:function(){return this.getRoot().getText()}});var E=/Safari/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent),L=/MacMindmap/i.test(navigator.userAgent)||/windowsmindmap/i.test(navigator.userAgent),D=/Edge/i.test(navigator.userAgent)||/Edg/i.test(navigator.userAgent),N=/(?:Firefox)/.test(navigator.userAgent),T="MacIntel"===navigator.platform&&navigator.maxTouchPoints>1,I=/Electron/i.test(window.navigator.userAgent)&&/Windows/i.test(window.navigator.userAgent),O=/Electron/i.test(window.navigator.userAgent)&&/Mac/i.test(window.navigator.userAgent),P=/Electron/i.test(window.navigator.userAgent)&&/Linux/i.test(window.navigator.userAgent),z=I||O||P,G=/iPhone|iPad|iPod/i.test(window.navigator.userAgent)||T,B=/(?:Android)/.test(navigator.userAgent),_=/(?:iPad|PlayBook)/.test(navigator.userAgent)||B&&!/(?:Mobile)/.test(navigator.userAgent)||N&&/(?:Tablet)/.test(navigator.userAgent)||T,F=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)||_,V={isMobile:F,isSafari:E,isOldClient:L,isEdge:D,isIOS:G,isTablet:_,isPhone:F&&!_,isElectron:z},j="rounded-rect",U="rect",Q="circle",H="annulus",Z="ellipse",Y="diamond",W="hexagon",J="rect-arc",q={multiColor1:["#FD6D5A","#FEB40B","#6DC354","#994487","#518CD8","#443295"],multiColor2:["#264653","#2A9D8F","#E9C46A","#F4A261","#E76F51","#253777"],multiColor3:["#C1C976","#C8A9A1","#FEC2E4","#77CCE0","#FFD372","#F88078"],multiColor4:["#FFE577","#FEC051","#FF7F59","#4A3838","#A56C43","#E3C498"],multiColor5:["#88857E","#D0CCC3","#ABC0B7","#DA8157","#A99D8F","#444C57"],multiColor6:["#5BD4FF","#38B2FF","#2589E5","#005FA2","#253777","#14235A"],multiColor7:["#C1E194","#A5C669","#70AE7D","#2D9594","#2D8495","#1E7080"],multiColor8:["#C2E199","#A4C678","#74AB84","#398F8D","#26878F","#147082"],multiColor9:["#9F4494","#F6910D","#37A6A7","#37A6A7","#F35B5F","#90A7A5"],multiColor10:["#F1787D","#F8D889","#69cde0","#5EB7F1","#EDA462","#f6c4e6"],multiColor11:["#64b6ea","#fb8857","#a788eb","#80d172","#fc7a77","#61d4d5"],multiColor12:["#037cd2","#00aaaa","#927fd3","#e54e5d","#eaa700","#f57f4b"],multiColor13:["#4C87D6","#F38562","#f2b825","#d4c114","#88b421","#199fe0"],multiColor14:["#104FFF","#2FD151","#64C7B8","#FF1038","#45CAFF","#B913FF"]},K=V.isTablet?600:V.isMobile?500:700;function X(e){if(p.isObject(e))return e;var t=p.isString(e)?e:window.bridge.trans("edit.topic")||"分支主题";return{html:"<p>"+t+"</p>",text:t}}var $=["color","font-family","font-size","font-weight","font-style","background","stroke","stroke-width","stroke-dasharray","radius","shape"];function ee(e,t){if(!t.isRoot()){var n=t.getData();$.forEach((function(t){n[t]&&(e[t]=n[t])}))}return e}y.registerInitHook((function(e){this._defaultOptions={}})),kity.extendClass(y,{setDefaultOptions:function(e){return p.extend(this._defaultOptions,e),this},getOption:function(e){return e?e in this._options?this._options[e]:this._defaultOptions[e]:p.extend({},this._defaultOptions,this._options)},setOption:function(e,t){this._options[e]=t},getColorGroupList:function(){var e=[];return Object.keys(q).forEach((function(t){e.push(q[t])})),JSON.parse(JSON.stringify(e))}});var te={enableAnimation:!0,layoutAnimationDuration:300,viewAnimationDuration:100,zoomAnimationDuration:300},ne={};y.registerInitHook((function(){this.setDefaultOptions(te),this.getOption("enableAnimation")||this.disableAnimation()})),y.prototype.enableAnimation=function(){for(var e in te)te.hasOwnProperty(e)&&this.setOption(ne[e])},y.prototype.disableAnimation=function(){for(var e in te)te.hasOwnProperty(e)&&(ne[e]=this.getOption(e),this.setOption(e,0))};var re=t;function oe(e,t){t(e),e.children&&e.children.forEach((function(e){oe(e,t)}))}var ie=[{version:"1.4.43",handler:function(e){function t(e){if(!e.data.html){var t=p.encodeHtml(e.data.text||"");e.data.html="<p>"+t.split("\n").join("</p><p>")+"</p>"}}oe(e.root,t),e.subtree&&e.subtree.forEach((function(e){oe(e.root,t)}))}},{version:"1.5.0",handler:function(e){e.generalize&&e.generalize.forEach((function(t){(e.subtree||[]).some((function(e){if(t.treeId===e.id)return e.nodeId=t.nodeId,e.genId=t.id,!0}))}))}},{version:"1.5.1",handler:function(e){function t(e){delete e.data.expandSide,delete e.data.layout}oe(e.root,t),e.subtree&&e.subtree.forEach((function(e){oe(e.root,t)}))}},{version:"1.5.2",handler:function(e){e.style&&(Object.entries(e.style).forEach((function(t){var n=t[0].split("-"),r=n.shift();e.style[r]=e.style[r]||{},p.isEmpty(t[1])||(e.style[r][n.join("-")]=t[1]),delete e.style[t[0]]})),e.style.map=e.style.map||{},e.background&&(e.style.map.background=e.background),e.backgroundImage&&(e.style.map["background-image"]=e.backgroundImage))}},{version:"1.5.3",handler:function(e){e.style&&e.style.map&&(e.style.map["background-image"]=e.style.map["background-image"]||e.style.map.backgroundImage,delete e.style.map.backgroundImage)}}];var ae={};kity.extendClass(y,{setup:function(e){if("string"==typeof e&&(e=document.querySelector(e)),e){var t=e.getAttribute("minder-data-type");if(t in ae){var n=e.textContent;e.textContent=null,this.renderTo(e),this.importData(t,n)}return this}},exportJson:function(){var t={};if(t.root=this.exportNode(this.getRoot()),t.subtree=this.getAllSubtreeData(),t.template=this.getTemplate(this.getRoot()),t.theme=this.getTheme(),t.relLine=this.getAllRelLineData(),t.style=this._style,t.colorGroup=this._colorGroup,t.version=e,t.zoom=this.getZoomValue(),!V.isMobile&&p.checkBridgeApi("getWordwrapState")&&void 0!==window.bridge.getWordwrapState()&&(t.wordWrap=this.getWordWrap()),!V.isMobile){var n=this.getViewDragger().getMovement();t.position={x:n.x,y:n.y}}return JSON.parse(JSON.stringify(t))},importJson:function(e){var t=this;if(e)return this._fire(new b("preimport",null,!1)),this.getRenderTarget().style.visibility="hidden",this.reset(),e=function(e){var t=e.version||re;return ie.forEach((function(r){1!==n(r.version,t)&&r.handler&&r.handler(e)})),e}(e),this._colorGroup=e.colorGroup,this._setStyle(e.style),this.importNode(this._root,e.root),this.setTemplate(e.template||"default"),this.setTheme(e.theme||null),this._position=e.position,this._subtreeData=e.subtree||[],this.drawSubtree(),e.relLine&&e.relLine.forEach((function(e){t.createRelLine(e)})),this.once("layoutallfinish",(function(){V.isMobile||(t._position?(t.getViewDragger().moveTo(t._position),t.zoom(e.zoom||t.getZoomValue())):(minder._viewDragger.moveToOptimalView(),t.zoom(e.zoom||t.getZoomValue()))),t.getRenderTarget().style.visibility=null})),this.refresh(),this._interactChange(),this.fire("import"),this},Text2Children:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(e instanceof R){for(var o,i=[],a={},s=0,c=/\r|\n|\r\n/,l=/^(\t|\x20{4})/,u=t.split(c),d="",h=0,g=this;void 0!==(d=u[h++]);)if(!y(d=d.replace(/&nbsp;/g,"")))if(n?(s=0,o=v(d)):(s=w(d),o=b(d)),0===s)a={},i.push(o),a[0]=i[i.length-1];else{if(!a[s-1])throw new Error("Invalid local format");k(a[s-1],o),a[s]=o}if(n&&1===i.length&&!r){var f=i[0],p=e.data.text+f.data.text,m=C(p);g.execCommand("content",m,p,e)}else x(e,i);this._firePharse({type:"contentchange"}),g.refresh()}function y(e){return""===e&&!/\S/.test(e)}function b(e){return{data:{text:e.replace(/^(\t|\x20{4})+/,"").replace(/(\t|\x20{4})+$/,"")},children:[]}}function v(e){return{data:{text:e,html:"<p>"+e+"</p>"},children:[]}}function w(e){for(var t=0;l.test(e);)e=e.replace(l,""),t++;return t}function k(e,t){e.children.push(t)}function x(e,t){for(var r=0,o=t.length;r<o;r++){var i=void 0;if(n){var a=t[r].data;a=ee(a,e),i=g.createNode(a,e)}else(i=g.createNode(null,e)).setData("text",t[r].data.text||"");n&&t[r].data.html&&i.setData("html",t[r].data.html),x(i,t[r].children)}}function C(e){var t=document.createElement("p");null!=t.textContent?t.textContent=e:t.innerText=e;var n=t.innerHTML;return t=null,n}},exportNode:function(e){var t=this,n={};n.data=e.getData(),n.commentCount=e.getCommentCount(),e.generalizes&&(n.generalizes=[],e.generalizes.forEach((function(e){var r=e.subtree,o=r._root;n.generalizes.push({id:e.getData("id"),range:e.getRange(),tree:{id:r.id,root:t.exportNode(o),pos:r.pos,template:o._template||t.getTemplate()}})}))),n.children=[];for(var r=e.getChildren(),o=0;o<r.length;o++)n.children.push(this.exportNode(r[o]));return n},importNode:function(e,t){var n=this,r=t.data;for(var o in r)e.setData(o,r[o]);for(var i=t.children||[],a=0;a<i.length;a++){var s=this.createNode(null,e);this.importNode(s,i[a])}return t.generalizes&&t.generalizes.forEach((function(t){n.createGeneralize(e,t.range,t)})),e},importNodeAndClearId:function(e,t){var n=t.data;for(var r in delete n.id,delete n.created,n)e.setData(r,n[r]);for(var o=t.children||[],i=0;i<o.length;i++){var a=this.createNode(null,e);this.importNodeAndClearId(a,o[i])}return e},importChildNode:function(e,t){if(t)return this.importNode(this.createNode(null,e),t),e.renderTree(),this.layout(e.getRoot()),this._firePharse({type:"contentchange"}),this._interactChange(),this},exportData:function(e,t){var n,r;return n=this.exportJson(),!e||(r=ae[e])&&r.encode?(this._fire(new b("beforeexport",{json:n,protocolName:e,protocol:r})),Promise.resolve(r.encode(n,this,t,r))):Promise.reject(new Error("Not supported protocol:"+e))},importData:function(e,t,n){var r,o=this;if(e&&(!(r=ae[e])||!r.decode))return Promise.reject(new Error("Not supported protocol:"+e));var i={local:t,protocolName:e,protocol:r};return this._fire(new b("beforeimport",i)),Promise.resolve(r.decode(t,this,n)).then((function(e){return o.importJson(e),e}))},decodeData:function(e,t,n){var r;if(e&&(!(r=ae[e])||!r.decode))return Promise.reject(new Error("Not supported protocol:"+e));var o={local:t,protocolName:e,protocol:r};return this._fire(new b("beforeimport",o)),Promise.resolve(r.decode(t,this,n))}});var se={registerProtocol:function(e,t){for(var n in ae[e]=t,ae)ae.hasOwnProperty(n)&&(ae[n].name=n)},getRegisterProtocol:function(e){return void 0===e?ae:ae[e]||null}},ce={Backspace:8,Tab:9,Enter:13,Shift:16,Control:17,Alt:18,CapsLock:20,Esc:27,Spacebar:32,PageUp:33,PageDown:34,End:35,Home:36,Insert:45,Left:37,Up:38,Right:39,Down:40,direction:{37:1,38:1,39:1,40:1},Del:46,NumLock:144,Cmd:91,CmdFF:224,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,"`":192,"=":187,"-":189,"/":191,".":190,"<":188,">":190,"[":219,controlKeys:{16:1,17:1,18:1,20:1,91:1,224:1},notContentChange:{13:1,9:1,33:1,34:1,35:1,36:1,16:1,17:1,18:1,20:1,91:1,37:1,38:1,39:1,40:1,113:1,114:1,115:1,144:1,27:1},isSelectedNodeKey:{37:1,38:1,39:1,40:1,13:1,9:1}};for(var le in ce)ce.hasOwnProperty(le)&&(ce[le.toLowerCase()]=ce[le]);var ue="a".charCodeAt(0);"abcdefghijklmnopqrstuvwxyz".split("").forEach((function(e){ce[e]=e.charCodeAt(0)-ue+65}));var de=9;do{ce[de.toString()]=de+48}while(de--);function he(e){var t=0;return"string"==typeof e?e.toLowerCase().split(/\+\s*/).forEach((function(e){switch(e){case"ctrl":case"cmd":t|=4096;break;case"alt":t|=8192;break;case"shift":t|=16384;break;default:t|=ce[e]}})):((e.ctrlKey||e.metaKey)&&(t|=4096),e.altKey&&(t|=8192),e.shiftKey&&(t|=16384),t|=ge(e.keyCode)),t}var ge=function(e){return e>=96&&e<=105&&(e-=48),e};kity.extendClass(b,{isShortcutKey:function(e){var t=this.originEvent;return!!t&&he(e)==he(t)}}),y.registerInitHook((function(){this._initShortcutKey()})),kity.extendClass(y,{_initShortcutKey:function(){this._bindShortcutKeys()},_bindShortcutKeys:function(){var e=this._shortcutKeys={};this.on("keydown",(function(t){var n=this;for(var r in e)e.hasOwnProperty(r)&&t.isShortcutKey(r)&&(e[r].forEach((function(e){e.__statusCondition&&e.__statusCondition!==n.getStatus()||e()})),t.preventDefault())}))},addShortcut:function(e,t){var n=this._shortcutKeys;e.split(/\|\s*/).forEach((function(e){var r,o=e.split("::");o.length>1&&(e=o[1],r=o[0],t.__statusCondition=r),n[e]||(n[e]=[]),n[e].push(t)}))},addCommandShortcutKeys:function(e,t){var n=this._commandShortcutKeys||(this._commandShortcutKeys={}),r={};t?r[e]=t:r=e;var o=this;p.each(r,(function(e,t){n[t]=e,o.addShortcut(e,(function(){-1!==o.queryCommandState(t)&&o.execCommand(t)}))}))},getCommandShortcutKey:function(e){var t=this._commandShortcutKeys;return t&&t[e]||null},supportClipboardEvent:function(e){return!!e.ClipboardEvent}(window)});var fe=~window.location.href.indexOf("status"),pe=~window.location.href.indexOf("trace");y.registerInitHook((function(){this._initStatus()})),kity.extendClass(y,{_initStatus:function(){this._status="normal",this._rollbackStatus="normal"},setStatus:function(e,t){return"readonly"!=this._status||t?(e!=this._status&&(this._rollbackStatus=this._status,this._status=e,this.fire("statuschange",{lastStatus:this._rollbackStatus,currentStatus:this._status}),fe&&(console.log(window.event.type,this._rollbackStatus,"->",this._status),pe&&console.trace())),this):this},rollbackStatus:function(){this.setStatus(this._rollbackStatus)},getRollbackStatus:function(){return this._rollbackStatus},getStatus:function(){return this._status},isNormalStatus:function(){return"normal"===this.getStatus()},isMinderEdit:!0,setMobileMinderEditStatus:function(e){this.isMinderEdit=e},getMobileMinderEditStatus:function(){return this.isMinderEdit}}),y.registerInitHook((function(){this._initPaper()})),kity.extendClass(y,{_initPaper:function(){this._paper=new kity.Paper,this._paper._minder=this,this._paper.getNode().ondragstart=function(e){e.preventDefault()},this._paper.shapeNode.setAttribute("transform","translate(0.5, 0.5)"),this._addRenderContainer(),this.setRoot(this.createNode()),this._options.renderTo&&this.renderTo(this._options.renderTo),this.on("mouseover",(function(e){V.isMobile||(e.getTargetNode()?this.fire("hoverSelected",{node:e.getTargetNode()}):this.fire("hoverRemove",{node:null}))}))},_addRenderContainer:function(){this._rc=(new kity.Group).setId(p.uuid("minder")),this._paper.addShape(this._rc),this._addComponentContainer()},_addComponentContainer:function(){this._connectContainer=(new kity.Group).setId("minder_connect_container"),this._connectContainer.setAttr("stroke-linecap","round"),this.getRenderContainer().appendShape(this._connectContainer),this._nodeContainer=(new kity.Group).setId("minder_node_container"),this.getRenderContainer().appendShape(this._nodeContainer),this._relLineContainer=(new kity.Group).setId("minder_rel_line_container"),this.getRenderContainer().appendShape(this._relLineContainer),this._generalizeContainer=(new kity.Group).setId("minder_generalize_container"),this.getRenderContainer().appendShape(this._generalizeContainer),this._selectedRectContainer=(new kity.Group).setId("minder_selectedRect_container"),this._selectedRectContainer.setStyle("pointer-events","none"),this.getRenderContainer().appendShape(this._selectedRectContainer),this._touchContainer=(new kity.Group).setId("minder_touch_container"),this.getRenderContainer().appendShape(this._touchContainer)},getTouchContainer:function(){return this._touchContainer},renderTo:function(e){if("string"==typeof e&&(e=document.querySelector(e)),e){if("script"==e.tagName.toLowerCase()){var t=document.createElement("div");t.id=e.id,t.class=e.class,e.parentNode.insertBefore(t,e),e.parentNode.removeChild(e),e=t}e.classList.add("km-view"),this._paper.renderTo(this._renderTarget=e),this._bindEvents(),this.fire("paperrender")}return this},getRenderContainer:function(){return this._rc},getPaper:function(){return this._paper},getRenderTarget:function(){return this._renderTarget}}),y.registerInitHook((function(){this._initSelection()})),kity.extendClass(y,{_initSelection:function(){this._selectedNodes=[]},renderChangedSelection:function(e){var t=this.getSelectedNodes(),n=[];t.forEach((function(t){-1===e.indexOf(t)&&n.push(t)})),e.forEach((function(e){-1===t.indexOf(e)&&n.push(e)})),n.length&&(this._interactChange(),this.fire("selectionchange",{changed:n}))},getSelectedNodes:function(){return this._selectedNodes},getSelectedNode:function(){return this.getSelectedNodes()[0]||null},removeAllSelectedNodes:function(){var e=this._selectedNodes.splice(0);return this._selectedNodes=[],this.renderChangedSelection(e),this.fire("selectionclear")},removeSelectedNodes:function(e){var t=this,n=this._selectedNodes.slice(0);return(e=p.isArray(e)?e:[e]).forEach((function(e){var n;-1!==(n=t._selectedNodes.indexOf(e))&&t._selectedNodes.splice(n,1)})),this.renderChangedSelection(n),this},updateSelectStatusExcludeGen:function(e){e||(e=this.getSelectedNodes());var t=[];e.forEach((function(e){e.visible||e.isGeneralize||t.push(e)})),this.removeSelectedNodes(t)},setGenSelectStatus:function(e){var t=this;this.getGen().forEach((function(n){!e&&n.generalize.getStatus()?t.removeSelectedNodes(n):e&&!n.generalize.getStatus()&&t.select(n)}))},select:function(e,t){e||(e=[]);var n=this.getSelectedNodes().slice(0);t&&(this._selectedNodes=[]);var r=this;return(e=p.isArray(e)?e:[e]).forEach((function(e){-1===r._selectedNodes.indexOf(e)&&r._selectedNodes.unshift(e)})),this.renderChangedSelection(n),this},selectById:function(e,t){e=p.isArray(e)?e:[e];var n=this.getNodesById(e);return this.select(n,t)},toggleSelect:function(e){return p.isArray(e)?e.forEach(this.toggleSelect.bind(this)):e.isSelected()?this.removeSelectedNodes(e):this.select(e),this},isSingleSelect:function(){return 1===this._selectedNodes.length},getSelectedAncestors:function(e){var t=this.getSelectedNodes().slice(0),n=[],r=void 0,o=t.indexOf(this.getRoot());function i(e,t){for(var n=e.length-1;n>=0;--n)if(e[n].isAncestorOf(t))return!0;return!1}for(~o&&!e&&t.splice(o,1),t.sort((function(e,t){return e.getLevel()-t.getLevel()}));r=t.pop();)i(t,r)||n.push(r);return n},clearSelect:function(){}}),kity.extendClass(R,{isSelected:function(){var e=this.getMinder();return e&&-1!==e.getSelectedNodes().indexOf(this)}}),y.registerInitHook((function(){this.on("beforemousedown",(function(e){this.focus(),e.preventDefault()})),this.on("paperrender",(function(){this.focus()}))})),kity.extendClass(y,{focus:function(){this.isFocused()||(this._renderTarget.classList.add("focus"),this.renderNodeBatch(this.getSelectedNodes()));return this.fire("focus"),this},blur:function(){this.isFocused()&&(this._renderTarget.classList.remove("focus"),this.renderNodeBatch(this.getSelectedNodes()));return this.fire("blur"),this},isFocused:function(){var e=this._renderTarget;return e&&e.classList.contains("focus")}}),y.registerInitHook((function(e){this.setDefaultOptions({enableKeyReceiver:!0}),this.getOption("enableKeyReceiver")&&this.on("paperrender",(function(){this._initKeyReceiver()}))})),kity.extendClass(y,{_initKeyReceiver:function(){if(!this._keyReceiver){var e=this._keyReceiver=document.createElement("input");e.classList.add("km-receiver"),this._renderTarget.appendChild(e);var t,n,r=this;t=e,n=function(t){switch(t.type){case"blur":r.blur();break;case"focus":r.focus();break;case"input":e.value=null}r._firePharse(t),t.preventDefault()},"keydown keyup keypress copy paste blur focus input".split(" ").forEach((function(e){t.addEventListener(e,n,!1)})),this.on("focus",(function(){e.focus()})),this.on("blur",(function(){e.blur()})),this.isFocused()&&e.focus()}}});var me={};y.registerInitHook((function(){this._initModules()})),kity.extendClass(y,{_initModules:function(){var e,t,n,r,o,i,a,s=me,c=this._options.modules||p.keys(s);this._commands={},this._query={},this._modules={},this._rendererClasses={};for(e=0;e<c.length;e++)if(s[t=c[e]]&&(r="function"==typeof s[t]?s[t].call(this):s[t],this._modules[t]=r,r)){for(t in r.defaultOptions&&this.setDefaultOptions(r.defaultOptions),r.init&&r.init.call(this,this._options),o=r.commands)this._commands[t.toLowerCase()]=new o[t];if(i=r.events)for(n in i)this.on(n,i[n]);if(a=r.renderers)for(n in a)this._rendererClasses[n]=this._rendererClasses[n]||[],p.isArray(a[n])?this._rendererClasses[n]=this._rendererClasses[n].concat(a[n]):this._rendererClasses[n].push(a[n]);r.commandShortcutKeys&&this.addCommandShortcutKeys(r.commandShortcutKeys)}},_garbage:function(){this.clearSelect();for(var e=this._root.getChildren();e.length;)this.removeNode(e[0]);this.removeAllSubtree(),this.detachNode(this.getRoot()),this.setRoot(this.createNode())},destroy:function(){var e=this._modules;for(var t in this._resetEvents(),this._garbage(),e)e[t].destroy&&e[t].destroy.call(this)},reset:function(){var e=this._modules;for(var t in this._garbage(),e)e[t].reset&&e[t].reset.call(this)}});var ye,be={register:function(e,t){me[e]=t}},ve={map:"map",root:"root",main:"main",sub:"sub",float:"float",relLine:"relLine",generalize:"generalize"},we=(C(ye={},ve.map,{background:"#fff"}),C(ye,ve.root,{color:"#fff",background:"#1cabfc","font-size":24,"font-weight":"bold",padding:[16,26],margin:[20,30],radius:8,stroke:"#41599E","stroke-width":0}),C(ye,ve.main,{color:"#333",background:"#fff","font-size":18,padding:[12,18],margin:[20,20],radius:6,"connect-width":3,"connect-color":"#bdc5c9",stroke:"#41599E","stroke-width":0}),C(ye,ve.sub,{color:"#333",background:"transparent","font-size":14,padding:[5,10],margin:[6,15],radius:5,"connect-width":2,"connect-color":"#bdc5c9",stroke:"#41599E","stroke-width":0}),C(ye,ve.float,{color:"#fff",background:"#3982fc","font-size":16,"font-weight":"bold",padding:[10,15],margin:[20,20],radius:6,stroke:"#41599E","stroke-width":0}),C(ye,ve.relLine,{"line-color":"#3982fc","line-width":2,"line-dasharray":[4,2],color:"#333",background:"transparent","font-size":12,padding:[2,5],margin:[0,0],radius:4,stroke:"#41599E","stroke-width":0}),C(ye,ve.generalize,{"line-color":"#3982fc","line-width":2,color:"#fff",background:"#3982fc","font-size":16,"font-weight":"bold",padding:[6,10],margin:[15,15],radius:6,stroke:"#3982fc","stroke-width":0}),ye),ke={left:function(e){return 3 in e&&e[3]||1 in e&&e[1]||e[0]},right:function(e){return 1 in e&&e[1]||e[0]},top:function(e){return e[0]},bottom:function(e){return 2 in e&&e[2]||e[0]}};kity.extendClass(y,{setStyle:function(e,t,n){e&&t&&(this._style[e]=this._style[e]||{},p.isEmpty(n)?delete this._style[e][t]:this._style[e][t]=n,this._updateFinalStyleMap(),this.fire("contentchange"))},_setStyle:function(e){this._style=e||this._style,this._updateFinalStyleMap()},getStyle:function(e,t){return this._finalStyle[e]&&this._finalStyle[e][t]},getUserStyle:function(e,t){return this._style[e]&&this._style[e][t]},getNodeStyle:function(e,t){var n=e.getData(t);if(!p.isEmpty(n))return n;var r="";switch(!0){case e.isGeneralizeNode():r=e.isRoot()?ve.generalize:ve.sub;break;case e.isRelLine:r=ve.relLine;break;default:r=ve[e.getType()]}return this._finalStyle[r]&&this._finalStyle[r][t]},getStyleOfRelLine:function(e){return this._finalStyle[ve.relLine][e]},_updateFinalStyleMap:function(){var e=this,t={},n=this.getThemeItems();Object.entries(we).forEach((function(r){var o=M(r,2),i=o[0],a=o[1],s=n[i];i!==ve.float||s||(s=n[ve.root]);var c=e._style[i];t[i]=p.extend({},a,s,c),["margin","padding"].forEach((function(e){t[i][e]&&["top","right","bottom","left"].forEach((function(n){t[i][e+"-"+n]=ke[n](t[i][e])}))}))})),this._finalStyle=t}}),kity.extendClass(R,{getStyle:function(e){return this.getMinder().getNodeStyle(this,e)},getConnectColor:function(){var e="connect-color",t=this.getData(e);if(t)return t;for(var n=this;n.getLevel()>1&&!n.getData(e);)n=n.parent;if(t=n.getData(e))return t;var r=this.getMinder().getColorGroup();return r?r[n.getIndex()%r.length]:1!==this.getLevel()&&this.getMinder().getStyle("main","background-multicolor")&&(t=n.getBackgroundColor("main"))?t:this.getStyle(e)},getFontColor:function(){var e=this.getNodeLevelType(),t=this.getLevel();if(this.isSubtreeNode())return this.getStyle("color");var n=this.getData("color");if(n)return n;var r=this.getMinder().getColorGroup(e,"color-multicolor");if(r){if(t>1){var o=this.getParent().getNodeLevelType();return"main"===o?this.getParent().getBackgroundColor(o):this.getParent().getFontColor()}return r[this.getIndex()%r.length]}return this.getStyle("color")},getBackgroundColor:function(){var e="background",t=this.getNodeLevelType();if(this.isSubtreeNode())return this.getStyle(e);var n=this.getData(e);if(n)return n;var r=this.getMinder().getColorGroup(t,"background-multicolor");return r?this.getLevel()>1?this.getParent().getBackgroundColor(t):r[this.getIndex()%r.length]:this.getStyle(e)},getStrokeColor:function(){var e=this.getData("stroke");return e||(this.getMinder().getColorGroup()&&(e=this.getConnectColor())?e:this.getStyle("stroke"))},getNodeLevelType:function(){var e="",t=this.getLevel();return 1===t?e="main":t>1&&(e="sub"),e},getFillColor:function(){var e=this.getData("background");if(e)return e;var t=this.getNodeLevelType();return this.getMinder().getColorGroup(t,"background-multicolor")&&(e=this.getBackgroundColor(t))?e:this.getStyle("background")}}),be.register("Style",{init:function(){this._style={},this._finalStyle=we}}),y.registerInitHook((function(e){e.readOnly&&this.setDisabled()})),kity.extendClass(y,{disable:function(){var e=this;e.bkqueryCommandState=e.queryCommandState,e.bkqueryCommandValue=e.queryCommandValue,e.queryCommandState=function(t){var n=this._getCommand(t);return n&&n.enableReadOnly?e.bkqueryCommandState.apply(e,arguments):-1},e.queryCommandValue=function(t){var n=this._getCommand(t);return n&&n.enableReadOnly?e.bkqueryCommandValue.apply(e,arguments):null},this.setStatus("readonly"),e._interactChange()},enable:function(){var e=this;e.bkqueryCommandState&&(e.queryCommandState=e.bkqueryCommandState,delete e.bkqueryCommandState),e.bkqueryCommandValue&&(e.queryCommandValue=e.bkqueryCommandValue,delete e.bkqueryCommandValue),this.setStatus("normal",!0),e._interactChange()},isReadonly:function(){return"readonly"===this.getStatus()}});var xe=kity.createClass("Renderer",{constructor:function(e){this.node=e},create:function(e){throw new Error("Not implement: Renderer.create()")},shouldRender:function(e){return!0},watchChange:function(e){this.watchingData=e},shouldDraw:function(e){return!0},update:function(e,t,n){return this.shouldDraw()&&this.draw(e,t),this.place(e,t,n)},draw:function(e,t){throw new Error("Not implement: Renderer.draw()")},place:function(e,t,n){throw new Error("Not implement: Renderer.place()")},getRenderShape:function(){return this._renderShape||null},setRenderShape:function(e){this._renderShape=e}});kity.extendClass(y,{renderNodeBatch:function(e){var t=this;e.forEach((function(e){t.renderNode(e)}))},renderTreeBatch:function(e){e.forEach((function(e){e.renderTree()}))},renderNode:function(e){var t,n=this._rendererClasses;e._renderers||function(e,t){var n=[];["center","left","right","top","bottom","outline","outside"].forEach((function(e){var r="before"+e,o="after"+e;t[r]&&(n=n.concat(t[r])),t[e]&&(n=n.concat(t[e])),t[o]&&(n=n.concat(t[o]))})),e._renderers=n.map((function(t){return new t(e)}))}(e,n);var r=!e.parent||e.parent.isExpanded();if(e.isGeneralize){var o=e.generalize.targetNode;r=o.attached&&o.visible&&o.isExpanded()}e.setVisible(r),r&&(this.fire("beforerender",{node:e}),e._contentBox=new kity.Box,e._renderers.forEach((function(n){n.shouldRender(e)?(n.getRenderShape()||(n.setRenderShape(n.create(e)),n.bringToBack?e.getRenderContainer().prependShape(n.getRenderShape()):e.getRenderContainer().appendShape(n.getRenderShape())),n.getRenderShape().setVisible(!0),"function"==typeof(t=n.update(n.getRenderShape(),e,e._contentBox))&&(t=t()),t&&(e._contentBox=e._contentBox.merge(t),n.contentBox=t)):n.getRenderShape()&&n.getRenderShape().setVisible(!1)})),this.fire("noderender",{node:e}))},renderTree:function(e){e?e.renderTree():(this.getRoot().renderTree(),this.getAllSubtree().forEach((function(e){e.getRoot().renderTree()})))}}),kity.extendClass(R,{render:function(){if(this.attached)return this.getMinder().renderNode(this),this},renderTree:function(){if(this.attached)return this.traverse((function(e){e.render(),e.generalizes&&e.generalizes.forEach((function(e){e.subtree.render()}))})),this},getRenderer:function(e){var t=this._renderers;if(!t)return null;for(var n=0;n<t.length;n++)if(t[n].getType()==e)return t[n];return null},getContentBox:function(){return this.parent&&this.parent.isCollapsed()?new kity.Box:this._contentBox||new kity.Box},getRenderBox:function(e,t){var n=e&&this.getRenderer(e),r=n&&n.contentBox?n.contentBox:this.getContentBox();return kity.Matrix.getCTM(this.getRenderContainer(),t||"paper").transformBox(r)}});var Ce={},Se=["connect-style","connect-width","connect-color"];function Ae(e,t){Ce[e]=t}Ae("default",(function(e,t,n){n.setPathData(["M",t.getLayoutVertexOut(),"L",e.getLayoutVertexIn()])})),kity.extendClass(R,{getConnect:function(){return this.data.connect||"default"},getConnectProvider:function(e){var t=this.getConnect(e),n=minder.getTapered(e)?t+"-tapared":t,r=Ce[n];return minder.isSupportTapared=Boolean(r),r||(r=Ce[t]),r||Ce.default},getConnection:function(){return this._connection||null}}),kity.extendClass(y,{defaultConnectWidth:2,getConnectContainer:function(){return this._connectContainer},getTaperedStrokePath:function(e,t,n){var r;switch(!0){case"arc"===t&&e.includes("Q"):r=e.split("L"),e=r[0]+"L"+r[1];break;case"poly"===t&&e.includes("Q"):var o=(r=e.split("L"))[3].split("Q");e=["right","left"].includes(n)?r[0]+"H"+r[2].split(",")[0]+"V"+o[0].split(",")[1]+"H"+r[4].split(",")[0]:r[0]+"V"+r[2].split(",")[1]+"H"+o[0].split(",")[0]+"V"+r[4].split(",")[1]}return e},getTapered:function(e){return 1===e.getLevel()&&minder.getStyle("map","branch-tapared")},setTapered:function(e){var t=this;this.setStyle("map","branch-tapared",e),minder.getRoot().children.forEach((function(n){t.updateConnect(n,e)})),Object.values(minder._subtreeMap).forEach((function(n){n.getRoot().isGeneralize||n.getRoot().children.forEach((function(n){t.updateConnect(n,e)}))}))},getConnectStartPosX:function(e,t,n){if(t.isGeneralizeNode())return n.cx;var r,o=t.getRoot(),i=o.getChildren().length,a=o.getDataRightNumber(),s=t.getIndex(),c=1;"left"===e?(s-=a,r=(i-a)/2-.5,c=-1):r=a/2-.5;var l=Math.ceil(Math.abs(r-s));if(1===l||0===l)return c*(n.width/2-20)+n.cx;if(2===l)return c*(n.width/4)+n.cx;if(3===l)return c*(n.width/6)+n.cx;var u=c*(n.width/6)+n.cx-c*(l-3)*5;return("left"===e&&u>n.cx||"right"===e&&u<n.cx)&&(u=n.cx),u},createConnect:function(e){if(!e.isRoot()){var t=new kity.Path;e._connection=t,this._connectContainer.addShape(t),this.updateConnect(e)}},removeConnect:function(e){var t=this;e.traverse((function(e){t._connectContainer.removeShape(e._connection),e._connection=null}))},updateConnect:function(e){var t=e._connection,n=e.parent;if(n&&t)if(n.isCollapsed())t.setVisible(!1);else{t.setVisible(!0),t.setAttr("stroke-dasharray",null);var r=e.getConnectProvider(e),o=0,i="none";if(this.getTapered(e)&&this.isSupportTapared){var a=e.getConnectColor()||"white";o=e.getStyle("connect-width")||this.defaultConnectWidth,t.stroke(i,o),t.fill(a),r(e,n,t,o,a)}else e.data.hasOwnProperty("text")&&(i=e.getConnectColor()||"white",o=e.getStyle("connect-width")||this.defaultConnectWidth,t.stroke(i,o),t.fill("none"),r(e,n,t,o,i))}},setNodeConnectStyle:function(e,t){e&&t&&(e.forEach((function(e){Se.forEach((function(n){n in t&&e.setData(n,t[n])}))})),this.layout(),this.fire("contentChange"))},clearNodeConnectStyle:function(e){e&&(e.forEach((function(e){Se.forEach((function(t){delete e.data[t]}))})),this.layout(),this.fire("contentChange"))}}),be.register("Connect",{init:function(){},events:{nodeattach:function(e){this.createConnect(e.node)},nodedetach:function(e){this.removeConnect(e.node)},layoutfinish:function(e){this.updateConnect(e.node)}}});var Me={register:Ae},Re={};var Ee=kity.createClass("Layout",{doLayout:function(e){throw new Error("Not Implement: Layout.doLayout()")},align:function(e,t){var n=this;e.forEach((function(e){var r=n.getTreeBox([e]),o=e.getLayoutTransform();switch(t){case"left":return o.translate(-r.left,0);case"right":return o.translate(-r.right,0);case"top":return o.translate(0,-r.top);case"bottom":return o.translate(0,-r.bottom)}}))},stack:function(e,t){var n=this,r=this,o=0;e.forEach((function(e,n,i){var a=r.getTreeBox([e]),s={x:a.width,y:a.height}[t],c={x:a.left,y:a.top}[t],l=e.getLayoutTransform();"x"===t?l.translate(o-c,0):l.translate(0,o-c),o+=s,i[n+1]&&(o+=function(e,t,n){return e.getStyle("margin-bottom")+t.getStyle("margin-top")}(e,i[n+1]))}));var i=e[0]&&e[0].parent;i&&i.generalizes&&i.generalizes.forEach((function(o){var a=o.getRange(),s=M(a,2),c=s[0],l=s[1],u=i.getChildren().length;if(l>u-1){l=u-1,o.setRange([c,l]);var d=o.getRange(),h=M(d,2);c=h[0],l=h[1]}if(c>u-1){c=0,o.setRange([c,l]);var g=o.getRange(),f=M(g,2);c=f[0],l=f[1]}var p=r.getTreeBox([i.getChild(c),i.getChild(l)]),m=n.getTreeBox(o.rootNode),y=void 0,b=void 0;if("x"===t){var v=p.width;y=Math.round(Math.abs(m.left)-v/2),b=Math.round(Math.abs(m.right)-v/2)}else{var w=p.height;y=Math.round(Math.abs(m.top)-w/2),b=Math.round(Math.abs(m.bottom)-w/2)}y=y>0?y:0,b=b>0?b:0,e.forEach((function(e){var n=e.getIndex();n>=c&&("x"===t?e.getLayoutTransform().translate(y,0):e.getLayoutTransform().translate(0,y)),n>l&&("x"===t?e.getLayoutTransform().translate(b,0):e.getLayoutTransform().translate(0,b))}))}))},move:function(e,t,n){e.forEach((function(e){e.getLayoutTransform().translate(t,n)}))},getBranchBox:function(e){var t,n,r,o,i=new kity.Box;for(t=0;t<e.length;t++)r=(n=e[t]).getLayoutTransform(),o=n.getContentBox(),i=i.merge(r.transformBox(o));return i},getTreeBox:function(e){var t,n,r,o,i=this,a=new kity.Box;for(e instanceof Array||(e=[e]),t=0;t<e.length;t++)r=(n=e[t]).getLayoutTransform(),o=n.getContentBox(),n.isExpanded()&&(n.children.length&&(o=o.merge(this.getTreeBox(n.children))),n.generalizes&&n.generalizes.forEach((function(e){var t=e.getRange(),r=M(t,2),a=r[0],s=r[1],c=n.getChildren().length;if(s>c-1){s=c-1,e.setRange([a,s]);var l=e.getRange(),u=M(l,2);a=u[0],s=u[1]}var d=i.getTreeBox([n.getChild(a),n.getChild(s)]),h=e.getOffsetOnTargetArea(d),g=(new kity.Matrix).translate(h.x,h.y);o=o.merge(g.transformBox(i.getTreeBox(e.rootNode)))}))),a=a.merge(r.transformBox(o));return a},getTreeLayoutBox:function(e,t){var n,r,o,i,a,s,c,l=this,u=new kity.Box;for(e instanceof Array||(e=[e]),n=0;n<e.length;n++){if(r=e[n],o=r.getLayoutBox(),r.isExpanded()){var d,h;if(r.children.length&&(o=o.merge(this.getTreeLayoutBox(r.children))),r.generalizes)if((h=(d=r.generalizes).findIndex((function(e){return e.data.id===t})))>-1)for(var g=0;g<h;g++)o=o.merge(this.getTreeLayoutBox(d[g].rootNode));else d.forEach((function(e){e.data.id!==t&&(o=o.merge(l.getTreeLayoutBox(e.rootNode)))}));if(r.parent&&r.parent.generalizes)if((h=(d=r.parent.generalizes).findIndex((function(e){return e.data.id===t})))>-1)for(var f=0;f<h;f++){var p=d[f].getRange(),m=d[h].getRange();i=m[0],a=m[1],s=p[0],c=p[1],i<s&&a<s||i>c&&a>c||(o=o.merge(this.getTreeLayoutBox(d[f].rootNode)))}else d.forEach((function(e){e.data.id!==t&&(o=o.merge(l.getTreeLayoutBox(e.rootNode)))}))}u=u.merge(o)}return u},getOrderHint:function(e){return[]}});Ee.register=function(e,t){Re[e]=t},p.extend(y,{getLayoutList:function(){return Re},getLayoutInstance:function(e){var t=Re[e];if(!t)throw new Error("Missing Layout: "+e);return new t}}),kity.extendClass(R,{getLayout:function(){var e=this.getData("layout");return e||(e=this.isRoot()?"mind":this.parent.getLayout())},setLayout:function(e){return e&&("inherit"==e?this.setData("layout"):this.setData("layout",e)),this},layout:function(e){return this.setLayout(e).getMinder().layout(),this},getLayoutInstance:function(){return y.getLayoutInstance(this.getLayout())},getOrderHint:function(e){return this.parent.getLayoutInstance().getOrderHint(this)},getLayoutTransform:function(){return this._layoutTransform||new kity.Matrix},getGlobalLayoutTransform:function(){return this._globalLayoutTransform?this._globalLayoutTransform:this.parent?this.parent.getGlobalLayoutTransform():new kity.Matrix},setLayoutTransform:function(e){return this._layoutTransform=e,this},setGlobalLayoutTransform:function(e){return this.getRenderContainer().setMatrix(this._globalLayoutTransform=e),this},setVertexIn:function(e){this._vertexIn=e},setVertexOut:function(e){this._vertexOut=e},getVertexIn:function(){return this._vertexIn||new kity.Point},getVertexOut:function(){return this._vertexOut||new kity.Point},getLayoutVertexIn:function(){return this.getGlobalLayoutTransform().transformPoint(this.getVertexIn())},getLayoutVertexOut:function(){return this.getGlobalLayoutTransform().transformPoint(this.getVertexOut())},setLayoutVectorIn:function(e){return this._layoutVectorIn=e,this},setLayoutVectorOut:function(e){return this._layoutVectorOut=e,this},getLayoutVectorIn:function(){return this._layoutVectorIn||new kity.Vector},getLayoutVectorOut:function(){return this._layoutVectorOut||new kity.Vector},getLayoutBox:function(){return this.getGlobalLayoutTransform().transformBox(this.getContentBox())},getLayoutPoint:function(){return this.getGlobalLayoutTransform().transformPoint(new kity.Point)},getLayoutOffset:function(){if(!this.parent)return new kity.Point;var e=this.getData("layout_"+this.parent.getLayout()+"_offset");return e?new kity.Point(e.x,e.y):new kity.Point},setLayoutOffset:function(e){return this.parent?(this.setData("layout_"+this.parent.getLayout()+"_offset",e?{x:e.x,y:e.y}:void 0),this):this},hasLayoutOffset:function(){return!!this.getData("layout_"+this.parent.getLayout()+"_offset")},resetLayoutOffset:function(){return this.setLayoutOffset(null)},getLayoutRoot:function(){return this.isLayoutRoot()?this:this.parent.getLayoutRoot()},isLayoutRoot:function(){return this.getData("layout")||this.isRoot()},getTreeLayoutBox:function(e){return this.getLayoutInstance().getTreeLayoutBox(this,e)}}),kity.extendClass(y,{layout:function(e){var t=this,n=[];function r(e,t){e.isExpanded()&&(e.children.forEach((function(e){r(e,t)})),e.generalizes&&e.generalizes.forEach((function(e){r(e.rootNode,t)}))),e.getLayoutInstance().doLayout(e,e.getChildren(),t)}return e&&!e.isGeneralize?n=p.isArray(e)?e:[e]:(n.push(this.getRoot()),p.each(this.getAllSubtree(),(function(e){n.push(e.getRoot())}))),n.forEach((function(e){r(e,1),r(e,2)})),t.applyLayoutResult(),setTimeout((function(){t.fire("layoutallfinish")}),0),this.fire("layout")},applyLayoutResult:function(e){var t=this;return e?e=p.isArray(e)?e:[e]:((e=[]).push(this.getRoot()),p.each(this.getAllSubtree(),(function(t){e.push(t.getRoot())}))),e.forEach((function(e){!function e(n,r){var o=n.getLayoutTransform().merge(r.clone()),i=n.getGlobalLayoutTransform()||new kity.Matrix,a=n.getLayoutOffset();o.translate(a.x,a.y),o.m.e=Math.round(o.m.e),o.m.f=Math.round(o.m.f),n.isSubtreeRoot()&&(o=i),n._layoutTimeline&&(n._layoutTimeline.stop(),n._layoutTimeline=null),function(e,t){e.setGlobalLayoutTransform(t)}(n,o),t.fire("layoutfinish",{node:n,matrix:o});for(var s=0;s<n.children.length;s++)e(n.children[s],o);n.generalizes&&n.generalizes.forEach((function(t){var n=t.targetNode;n.attached&&n.visible&&n.isExpanded()?(t.show(),t.updatePosition()):t.hide(),e(t.rootNode,new kity.Matrix)}))}(e,e.parent?e.parent.getGlobalLayoutTransform():new kity.Matrix)})),this},resetLayout:function(e){e||(e=minder.getSelectedNodes()),e.length||(e=[minder.getRoot()]),e.forEach((function(e){e.traverse((function(e){e.resetLayoutOffset()}))})),minder.layout()},refresh:function(){return this.renderTree(),this.layout()._interactChange(),this}});var Le={};p.extend(y,{getThemeList:function(){return Le}}),kity.extendClass(y,{useTheme:function(e){return this.setTheme(e),this.refresh(),!0},_updateThemeData:function(e,t,n){Le[this._theme][e]||(Le[this._theme][e]={}),Le[this._theme][e][t]=n},setTheme:function(e){e||(e=this.getOption("defaultTheme")),Le[e]||(console.error("Theme "+e+" not exists!"),e=this.getOption("defaultTheme"));var t=this._theme;this._theme=e||null;var n=this.getRenderTarget();return n&&(n.classList.remove("km-theme-"+t),e&&n.classList.add("km-theme-"+e)),this._updateThemeData("map","branch-tapared",Le[this._theme].root["branch-tapared"]),this._updateThemeData("map","startPos",Le[this._theme].root.startPos),this._updateFinalStyleMap(),this.updateBackground(),this.fire("themechange",{theme:e}),this},getTheme:function(){return this._theme||this.getOption("defaultTheme")},getThemeItems:function(){return Le[this.getTheme()]},setBackground:function(e){this.setStyle("map","background",e),this.setStyle("map","background-image",null),this.updateBackground(),this.fire("contentchange")},setBackgroundImage:function(e){this.setStyle("map","background",null),this.setStyle("map","background-image",e),this.updateBackground(),this.fire("contentchange")},resetBackground:function(){this.setStyle("map","background",null),this.setStyle("map","background-image",null),this.updateBackground(),this.fire("contentchange")},updateBackground:function(){var e=this.getRenderTarget();e&&(e.style.background=this.getBackground())},getBackground:function(){var e=this.getUserStyle("map","background-image"),t=this.getUserStyle("map","background"),n=this.getBackgroundImageName();if(window.bridge.getBackgroundUrl(n)&&(e||n&&!t)){var r=V.isMobile?"cover":"100% 100%";return"url("+window.bridge.getBackgroundUrl(n)+") left bottom / "+r}return this.getStyle("map","background")},getBackgroundImageName:function(){return this.getStyle("map","background-image")},getBackgroundColor:function(){return this.getStyle("map","background")},setColorGroup:function(e){this._colorGroup=e,this.getRoot().renderTree(),this.layout(),this.fire("contentchange")},getColorGroup:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"root",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"branch-multicolor";if(this._colorGroup&&"branch-multicolor"===t)return this._colorGroup;var n=this.getStyle(e,t);return n?q[n]||q.multiColor1:null}}),be.register("Theme",{defaultOptions:{defaultTheme:"sky"},commands:{theme:kity.createClass("ThemeCommand",{base:v,execute:function(e,t){return e.useTheme(t)},queryValue:function(e){return e.getTheme()||"default"}})}});var De={register:function(e,t){Le[e]=t}};function Ne(e,t,n){t!==n&&["default","default-poly"].includes(t)&&e.setDataRightNumber(null)}var Te={};var Ie,Oe,Pe,ze={register:function(e,t){Te[e]=t}};function Ge(e,t){var n=t.path.split("/");n.shift();var r=n.shift(),o=e.getRoot(),i=[];if(p.each(e._subtreeMap,(function(e){i.push(e)})),"subtree"===r&&1!==n.length){var a=n.shift();if(!i[a])return;o=i[a].getRoot(),r=n.shift()}if("root"===r){var s,c=n.indexOf("data");if(c>-1){r="data";var l=n.splice(c+1);t.dataPath=l}else r="node";for(;s=n.shift();)"children"!==s?"generalizes"!==s?"tree"!==s&&"root"!==s&&(k=+s,p.isUndefined(k)||"generalize"===r?p.isUndefined(k)||"generalize"!==r||p.isNumber(k)&&!isNaN(k)&&o.generalizes&&o.generalizes[k]&&(o=o.generalizes[k]):p.isNumber(k)&&!isNaN(k)&&(o.getChild&&o.getChild(k)?o=o.getChild(k):o.rootNode&&o.rootNode.getChild(k)&&(o=o.rootNode.getChild(k)))):(r="generalize",k=null):r="node";t.index=k,t.node=o,c>-1&&(r="data")}switch(t.express=[r,t.op].join(".")){case"theme.replace":e.useTheme(t.value);break;case"backgroundImage.replace":case"backgroundImage.remove":case"backgroundImage.add":e.setBackgroundImage(t.value);break;case"style.replace":if("map"===n[0]&&"background-image"===n[1])e.setBackgroundImage(t.value);else if("map"===n[0]&&"background"===n[1])e.setBackground(t.value);else if("margin"===n[1]){(S=e.getStyle(n[0],n[1]))[n[2]]=t.value,e.setStyle(n[0],n[1],S)}break;case"colorGroup.replace":var u=e.getColorGroup();if(C=t.path.match(/\/colorGroup\/(\d+)/))u[k=C[1]]=t.value,e.clearNodeStyle(["connect-color"]),e.setColorGroup(u);else e.clearNodeStyle(["connect-color"]),e.setColorGroup(null);break;case"style.remove":e.setStyle(n[0],n[1],null);break;case"template.replace":var d,h,g=e.exportJson(),f=t.path.includes("subtree");f&&(h=t.path.match(/[0-9a-zA-Z_]\/(\S*)\/template/)[1]),d=f?e._subtreeMap[g.subtree[h].id].getRoot():e.getRoot(),e.useTemplate(t.value,0,d);break;case"subtree.add":e.createSubtree(t.value);break;case"subtree.remove":a=t.path.match(/\/subtree\/(\d+)/)[1];e.removeSubtree(e.getAllSubtree()[a].getRoot());break;case"generalize.add":var m=t.value.range;e.createGeneralize(t.node,m,t.value);break;case"generalize.remove":void 0===t.index||null===t.index?(t.index=0,e.removeGeneralize(t.node.generalizes[t.index])):e.removeGeneralize(t.node);break;case"relLine.add":var y=parseInt(t.path.match(/\/relLine\/(\d+)/)[1]),b=e.getAllRelLine()[y];if(C=t.path.match(/\/relLine\/\d+\/([a-zA-Z-]+)/)){var v=C[1],w=t.path.match(/\/relLine\/\d+\/line-dasharray\/(\d)/)[1];(S=(S=b.getData(v))||[])[w]=t.value,b.setData(v,S)}else e.createRelLine(t.value);break;case"relLine.remove":y=parseInt(t.path.match(/\/relLine\/(\d+)/)[1]),b=e.getAllRelLine()[y];if((C=t.path.match(/\/relLine\/\d+\/([a-zA-Z-]+)/))&&(v=C[1]),v)if("node"===v){o=b.node;(C=t.path.match(/\/relLine\/\d+\/node\/data\/(text|html)/))&&(o.setHtml(""),o.setText("")),o.render()}else{if("line-dasharray"===v){if(C=t.path.match(/\/relLine\/\d+\/line-dasharray\/(\d)/)){var k=C[1];(S=b.getData(v)).splice(k,1),b.setData(v,S)}}else b.setData(v,null)}else e.removeRelLine(b);e.updateRelLine();break;case"relLine.replace":y=parseInt(t.path.match(/\/relLine\/(\d+)/)[1]),b=e.getAllRelLine()[y];if("ctrl"===(v=t.path.match(/\/relLine\/\d+\/([a-zA-Z-]+)/)[1])){var x;x="0"===t.path.match(/\/relLine\/\d+\/ctrl\/(\d+)/)[1]?"ctrlP1":"ctrlP2";w=t.path.match(/\/relLine\/\d+\/ctrl\/\d+\/([xy])/)[1];(S=b.getData(x))[w]=t.value,b.setData(x,S,!0)}else if("startP"===v){if(t.path.match(/\/relLine\/\d+\/startP\/([xy])/)){w=t.path.match(/\/relLine\/\d+\/startP\/([xy])/)[1];(S=b.getData(v))[w]=t.value,b.setData(v,S)}}else if("endP"===v){if(t.path.match(/\/relLine\/\d+\/endP\/([xy])/)){w=t.path.match(/\/relLine\/\d+\/endP\/([xy])/)[1];(S=b.getData(v))[w]=t.value,b.setData(v,S)}}else if("node"===v){o=b.node;(C=t.path.match(/\/relLine\/\d+\/node\/data\/(text|html)/))&&o.setData(C[1],t.value),o.render()}else if("line-width"===v)b.setData(v,t.value);else if("line-dasharray"===v){var C;if(C=t.path.match(/\/relLine\/\d+\/line-dasharray\/([01])/)){var S;w=C[1];(S=b.getData(v))[w]=t.value,b.setData(v,S)}else b.setData(v,t.value)}else"line-color"===v&&b.setData(v,t.value);e.updateRelLine();break;case"node.add":(function e(t,n,r,o){return r=t.createNode(n.data,r,o),n.children.forEach((function(n,o){e(t,n,r,o)})),r})(e,t.value,t.node,t.index).renderTree();break;case"node.remove":e.removeNode(t.node);break;case"data.add":case"data.replace":case"data.remove":var A;g=t.node.data;for(n=t.dataPath.slice();g&&n.length>1;)(A=n.shift())in g?g=g[A]:"remove"!=t.op&&(g=g[A]={});g&&(g[A=n.shift()]=t.value)}e.fire("patch",{patch:t})}p.extend(y,{getTemplateList:function(){return Te}}),kity.extendClass(y,(Ie=y.prototype.getTheme,{useTemplate:function(e,t,n){var r;this.setLastTemplate(e),r=n?[n]:this.getSelectedNodes();var o=new Set;r.forEach((function(e){o.add(e.getRoot())})),(o=Array.from(o)).forEach((function(t){Ne(t,e,t._template),t._template=e})),o.length||this.setAllSameTemplate(e),this.layout()},setAllSameTemplate:function(e){Ne(this.getRoot(),e,this._template),this.getRoot()._template=this._template=e,p.each(this.getAllSubtree(),(function(t){Ne(t.getRoot(),e,t.getRoot()._template),t.getRoot()._template=e}))},setLastTemplate:function(e){this._lastTemplate=e},getLastTemplate:function(){return this._lastTemplate||this.getTemplate()},getTemplate:function(e){return e||(e=this.getRoot()),e._template||e.getRoot()._template||this.getRoot()._template},setTemplate:function(e){"string"==typeof e&&(this._template=e||"default"),this.getRoot()._template=this._template},getTemplateSupport:function(e,t){var n=Te[this.getTemplate(t)];return n&&n[e]},getTheme:function(e){return(this.getTemplateSupport("getTheme",e)||Ie).call(this,e)}})),kity.extendClass(R,(Oe=R.prototype.getLayout,Pe=R.prototype.getConnect,{getLayout:function(){return this.isGeneralizeNode()?this.getRoot().generalize.getLayout():(this.getMinder().getTemplateSupport("getLayout",this)||Oe).call(this,this)},getConnect:function(){return this.isGeneralizeNode()?this.getRoot().generalize.getConnect():(this.getMinder().getTemplateSupport("getConnect",this)||Pe).call(this,this)}})),be.register("TemplateModule",{commands:{template:kity.createClass("TemplateCommand",{base:v,execute:function(e,t){e.useTemplate(t)},queryValue:function(e){return e.getTemplate()||"default"}})}}),kity.extendClass(y,{applyPatches:function(e){for(var t=0;t<e.length;t++)Ge(this,e[t]);return minder.refresh(),this.fire("contentchange"),this}});function Be(e,t){var n=Math.round((e.x+t.x)/2),r=Math.round((e.y+t.y)/2),o=-1/((t.y-e.y)/(t.x-e.x)),i=Math.round(Math.sqrt(Math.pow(100,2)/(Math.pow(o,2)+1))),a=Math.round(i*o);return Math.abs(o)===1/0&&(i=0,a=100),[{x:n+i,y:r+a},{x:n-i,y:r-a}]}var _e=kity.createClass("RelLine",{constructor:function(e,t,n){n=n||{},this.startNode=e,this.endNode=t,this.minder=this.startNode.getMinder(),this.visible=!0,n.startId=e.getData("id"),n.endId=t.getData("id"),this.data={id:n.id||"rl-"+p.guid(),created:n.created||+new Date,text:n.text||"",startId:e.getData("id"),endId:t.getData("id"),startP:this.startNode.getLayoutPoint(),endP:this.endNode.getLayoutPoint(),ctrlP1:n.ctrl?n.ctrl[0]:null,ctrlP2:n.ctrl?n.ctrl[1]:null,node:n.node||{data:{text:""}},"line-color":n["line-color"],"line-width":n["line-width"],"line-dasharray":n["line-dasharray"]},this.initContainers(),this.createPath(),this.createMarker(),this.createNode()},initContainers:function(){this.rc=(new kity.Group).setId(p.uuid("minder_rel_line")),this.rc.relLine=this},createPath:function(){this.line=new kity.Path,this.lineMask=new kity.Path,this.rc.addItem(this.line),this.rc.addItem(this.lineMask),this.pen=new kity.Pen,this.maskPen=new kity.Pen,this.maskPen.setColor("transparent"),this.maskPen.setWidth(8),this.lineMask.stroke(this.maskPen),this.lineMask.setStyle("cursor","pointer")},createMarker:function(){this.endMarker=(new kity.Marker).pipe((function(){this.setWidth(8),this.setHeight(8),this.setRef(2,4),this.addShape((new kity.Path).setPathData("M 2 2 L 6 4 L 2 6"))})),this.minder.getPaper().addResource(this.endMarker),this.line.setMarker(this.endMarker,"end"),this.clip=(new kity.Clip).pipe((function(){this.path=new kity.Path,this.path.setAttr("clip-rule","evenodd"),this.addShape(this.path)})),this.minder.getPaper().addResource(this.clip),this.clip.clip(this.line)},createNode:function(){this.node=new R(this.data.node.data),this.node.type="relLine",this.node.minder=this.minder,this.node.relLine=this,this.node.isRelLine=!0,this.minder.attachNode(this.node)},renderNode:function(){(this.node.getData("text")||this.isSelected)&&this.minder.renderNode(this.node)},updateNodePosition:function(){var e=this.line.getNode().getTotalLength(),t=this.line.getNode().getPointAtLength(e/2),n=this.node.getContentBox(),r=t.x-n.cx,o=t.y-n.cy;this.node.setGlobalLayoutTransform((new kity.Matrix).translate(Math.round(r),Math.round(o)))},updateStyle:function(){var e=this.getStyle("line-color"),t=this.getStyle("line-width");this.pen.setColor(e),this.pen.setWidth(t);var n=this.getStyle("line-dasharray");n&&(n=n.map((function(e){return e*t}))),this.pen.setDashArray(n),this.line.stroke(this.pen),this.endMarker.eachItem((function(t,n){n.fill(e)}))},updateClipPath:function(){var e=this.line.getBoundaryBox().expand(10),t=this.node.getLayoutBox(),n=["M",e.x,e.y,"L",e.x+e.width,e.y,"L",e.x+e.width,e.y+e.height,"L",e.x,e.y+e.height,"M",t.x,t.y,"L",t.x+t.width,t.y,"L",t.x+t.width,t.y+t.height,"L",t.x,t.y+t.height];this.clip.path.setPathData(n)},render:function(){if(this.visible){this.updateStyle();var e,t,n=this.line.getDrawer(),r=this.lineMask.getDrawer(),o=this.startNode.getLayoutBox(),i=this.endNode.getLayoutBox(),a=e={x:o.cx,y:o.cy},s=t={x:i.cx,y:i.cy},c=Be(a,s),l=this.data.ctrlP1?this.getAbsoluteCoordinate(this.data.ctrlP1,e):c[0],u=this.data.ctrlP2?this.getAbsoluteCoordinate(this.data.ctrlP2,t):c[1];a=this.getEndpoint(this.startNode,l,2)||a,s=this.getEndpoint(this.endNode,u,4*this.getStyle("line-width")+2)||s,this.line.setPathData(""),this.lineMask.setPathData(""),n.moveTo(a.x,a.y),n.bezierTo(l.x,l.y,u.x,u.y,s.x,s.y),r.moveTo(a.x,a.y),r.bezierTo(l.x,l.y,u.x,u.y,s.x,s.y),this.data.startP=a,this.data.endP=s,this.data.scp=e,this.data.ecp=t,this.data.ctrlP1Cur=l,this.data.ctrlP2Cur=u,this.data.ctrlP1=this.getRelativeCoordinate(l,e),this.data.ctrlP2=this.getRelativeCoordinate(u,t),this.renderNode(),this.updateNodePosition(),this.updateClipPath()}},getEndpoint:function(e,t,n){var r=e.getLayoutBox(),o=e.getRenderer("OutlineRenderer").getRenderShape().getPathData(),i=e.getGlobalLayoutTransform().getTranslate(),a=new kity.Point(r.cx,r.cy).offset(-i.x,-i.y),s=new kity.Point(t.x,t.y).offset(-i.x,-i.y),c=this.getIntersectionPoint(o,[[a.x,a.y],[s.x,s.y]]);if(c){var l=new kity.Vector(s.x-a.x,s.y-a.y).normalize(n);return new kity.Point(c.x,c.y).offset(l.x,l.y).offset(i.x,i.y)}},getIntersectionPoint:function(e,t){var n=KldIntersections.ShapeInfo,r=KldIntersections.Intersection,o=n.path(e),i=n.line(t[0],t[1]);return r.intersect(o,i).points[0]},getRelativeCoordinate:function(e,t){return{x:e.x-t.x,y:e.y-t.y}},getAbsoluteCoordinate:function(e,t){return{x:e.x+t.x,y:e.y+t.y}},remove:function(){this.node&&this.minder.detachNode(this.node),this.rc.remove()},hide:function(){this.node.hide(),this.rc.setVisible(!1),this.visible=!1},show:function(){this.rc.setVisible(!0),this.visible=!0},getData:function(e){return e?this.data[e]:this.data},setData:function(e,t,n){if("ctrlP1"===e&&(n||(t=this.getRelativeCoordinate(t,this.data.scp))),"ctrlP2"===e&&(n||(t=this.getRelativeCoordinate(t,this.data.ecp))),"object"==(void 0===e?"undefined":w(e))){var r=e;for(e in r)r.hasOwnProperty(e)&&(this.data[e]=r[e])}else this.data[e]=t;return this},getStyle:function(e){var t=this.data[e];return p.isEmpty(t)?this.minder.getStyleOfRelLine(e):t},setStatus:function(e){switch(this.isSelected="selected"===e,e){case"selected":this.maskPen.setWidth(5),this.maskPen.setColor("rgba(255, 192, 0, 0.5)"),this.lineMask.stroke(this.maskPen),this.node.show(),this.renderNode(),this.updateNodePosition(),this.minder.select(this.node,!0),this.clip.setVisible(!0);break;case"normal":this.maskPen.setWidth(10),this.maskPen.setColor("transparent"),this.lineMask.stroke(this.maskPen);var t=!!this.node.getData("text");this.node.setVisible(t),this.clip.setVisible(t),this.updateClipPath()}}});p.extend(_e,{getCtrlPoint:Be});var Fe={};function Ve(e,t){Fe[e]=t}function je(e,t){var n=e.getStyle("padding-left"),r=e.getStyle("padding-right"),o=e.getStyle("padding-top"),i=e.getStyle("padding-bottom"),a=t.x-n,s=t.y-o,c=t.width+n+r,l=t.height+o+i;return{x:a,y:s,width:c,height:l,cx:Math.round(a+c/2),cy:Math.round(s+l/2)}}function Ue(e,t,n){var r=new kity.Vector(t.x-e.x,t.y-e.y).normalize(n);return new kity.Point(e.x,e.y).offset(r.x,r.y)}Ve(j,(function(e,t,n){var r=je(t,n),o=t.getStyle("radius")||6;return e.setPosition(r.x,r.y).setSize(r.width,r.height).setRadius(o),new kity.Box(r)})),Ve(U,(function(e,t,n){var r=je(t,n);return e.setPosition(r.x,r.y).setSize(r.width,r.height).setRadius(0),new kity.Box(r)})),Ve(Q,(function(e,t,n){var r=je(t,n),o=Math.round(Math.sqrt(Math.pow(r.width,2)+Math.pow(r.height,2))/2),i=new kity.Circle(o,r.cx,r.cy).pathdata;return e.setPathData(i),new kity.Box({x:r.cx-o,y:r.cy-o,width:2*o,height:2*o})})),Ve(H,(function(e,t,n){var r=je(t,n),o=t.getStyle("padding-left"),i=r.height/2,a=o;i>a?a=i-a:a-=i;var s=r.x-a,c=r.width+2*a;return e.setPosition(s,r.y).setSize(c,r.height).setRadius(i),new kity.Box({x:s,y:r.y,width:c,height:r.height})})),Ve(Z,(function(e,t,n){var r=je(t,n),o=Math.round(Math.sqrt(Math.pow(-r.width/2,2)+Math.pow(r.height/2,2)/Math.pow(.618,2))),i=Math.round(.618*o),a=new kity.Ellipse(o,i,r.cx,r.cy).pathdata;return e.setPathData(a),new kity.Box({x:r.cx-o,y:r.cy-i,width:2*o,height:2*i})})),Ve(Y,(function(e,t,n){var r=je(t,n),o=[],i=Math.round(r.height/2-.618*-r.width/2),a=Math.round(i/.618);return o.push("M",r.cx-a,r.cy),o.push("L",r.cx,r.cy-i),o.push("L",r.cx+a,r.cy),o.push("L",r.cx,r.cy+i,"Z"),e.setPathData(o),new kity.Box({x:r.cx-a,y:r.cy-i,width:2*a,height:2*i})})),Ve(W,(function(e,t,n){var r=je(t,n),o=r.cx,i=r.cy,a=Math.tan(10/180*Math.PI),s=Math.round(r.height/2-a*-r.width/2),c=Math.round(s/.56);c<r.width/2&&(c=r.width/2,s=Math.round(.56*c));var l=Math.round(c*a),u={x:o-c,y:i-s+l},d={x:o,y:i-s},h={x:o+c,y:i-s+l},g={x:o+c,y:i+s-l},f={x:o,y:i+s},p={x:o-c,y:i+s-l},m={x:o-c,y:i-s+l+5},y=Ue(u,d,5),b=Ue(d,u,5),v=Ue(d,h,5),w=Ue(h,d,5),k={x:o+c,y:i-s+l+5},x={x:o+c,y:i+s-l-5},C=Ue(g,f,5),S=Ue(f,g,5),A=Ue(f,p,5),M=Ue(p,f,5),R={x:o-c,y:i+s-l-5},E=["M",m.x,m.y,"Q",u.x,u.y,y.x,y.y,"L",b.x,b.y,"Q",d.x,d.y,v.x,v.y,"L",w.x,w.y,"Q",h.x,h.y,k.x,k.y,"L",x.x,x.y,"Q",g.x,g.y,C.x,C.y,"L",S.x,S.y,"Q",f.x,f.y,A.x,A.y,"L",M.x,M.y,"Q",p.x,p.y,R.x,R.y,"Z"];return e.setPathData(E),new kity.Box({x:o-c,y:i-s,width:2*c,height:2*s})})),Ve(J,(function(e,t,n){var r=je(t,n),o=r.cx,i=r.cy,a=Math.tan(15/180*Math.PI),s=Math.round(r.height/2-a*-r.width/2),c=Math.round(s/.6);c<r.width/2&&(c=r.width/2,s=Math.round(.6*c));var l=Math.round(c*a),u={x:o-c,y:i-s+l},d={x:o,y:i-s},h={x:o+c,y:i-s+l},g={x:o+c,y:i+s-l},f={x:o,y:i+s},p={x:o-c,y:i+s-l},m={x:o-c,y:i-s+l+5},y=Ue(u,d,5),b=Ue(h,d,5),v={x:o+c,y:i-s+l+5},w={x:o+c,y:i+s-l-5},k=Ue(g,f,5),x=Ue(p,f,5),C={x:o-c,y:i+s-l-5},S=["M",m.x,m.y,"Q",u.x,u.y,y.x,y.y,"Q",d.x,d.y,b.x,b.y,"Q",h.x,h.y,v.x,v.y,"L",w.x,w.y,"Q",g.x,g.y,k.x,k.y,"Q",f.x,f.y,x.x,x.y,"Q",p.x,p.y,C.x,C.y,"Z"];e.setPathData(S);var A=Math.round(e.getBoundaryBox().height);return new kity.Box({x:o-c,y:i-A/2,width:2*c,height:A})}));var Qe=j;function He(e,t){var n=e.getIndex();(e.parent.generalizes||[]).forEach((function(e){var r=e.getRange(),o=r[0],i=r[1];t>n?o===i?o<n||(o===n?o=i=t:o<=t&&(o=i-=1)):i<n||(o>n&&i<=t?(o-=1,i-=1):o>t||(o<=n&&i<=t?i-=1:o>n&&i>=t&&(o-=1))):o===i?o<t||(o===t||o<n?o=i+=1:o===n&&(o=i=t)):i<t||(o>=t&&i<n?(o+=1,i+=1):o>n||(o<=t&&i<n?i+=1:o>=t&&i>=n&&(o+=1))),e.setRange([o,i])}))}function Ze(e,t){return e.getIndex()-t.getIndex()}function Ye(e,t){return-Ze(e,t)}kity.extendClass(R,{getShape:function(){return this.getStyle("shape")||Qe},getShapeProvider:function(){return Fe[this.getShape()]||Fe[Qe]}}),kity.extendClass(R,{_arrange:function(e){var t=this.parent;if(t){var n=t.children;if(!(e<0||e>=n.length))return n.splice(this.getIndex(),1),n.splice(e,0,this),this}}});var We=kity.createClass("ArrangeUpCommand",{base:v,execute:function(e){var t=e.getSelectedNodes();t=t.filter((function(e){return!e.isFirstChild()})),R.groupWithParent(t).forEach((function(e){e.sort(Ze),e.forEach((function(e){var t=e.getIndex()-1;He(e,t),e._arrange(t)}))})),e.layout()},queryState:function(e){return e.getSelectedNode()?0:-1}}),Je=kity.createClass("ArrangeDownCommand",{base:v,execute:function(e){var t=e.getSelectedNodes();t=t.filter((function(e){return!e.isLastChild()})),R.groupWithParent(t).forEach((function(e){e.sort(Ye),e.forEach((function(e){var t=e.getIndex()+1;He(e,t),e._arrange(t)}))})),e.layout()},queryState:function(e){return e.getSelectedNode()?0:-1}}),qe=kity.createClass("ArrangeCommand",{base:v,execute:function(e,t){var n=e.getSelectedNodes();if((n=n.filter((function(e){return e.getIndex()!==t}))).length){var r=n[0].parent;if(!n.some((function(e){return e.parent!==r}))){var o=n.map((function(e){return{index:e.getIndex(),node:e}})),i=Math.min.apply(Math,o.map((function(e){return e.index})))>=t;o.sort((function(e,t){return i?t.index-e.index:e.index-t.index})),o.forEach((function(e){He(e.node,t),e.node._arrange(t)})),e.layout()}}},queryState:function(e){return e.getSelectedNode()?0:-1}}),Ke=kity.createClass("MoveToParentCommand",{base:v,execute:function(e,t,n,r){t=[].concat(function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}(t));for(var o=0;o<t.length;o++){var i=t[o];if(i.parent&&i.parent!==n){if(i.parent.generalizes){var a=i.getIndex();i.parent.generalizes=i.parent.generalizes.filter((function(e){var t=e.getRange(),r=t[0],o=t[1];if(a<r)r-=1,o-=1;else if(a>=r&&a<=o){if(r===o)return e.setRange([n.getChildren().length,n.getChildren().length]),e.targetNode=n,n.generalizes=n.generalizes||[],n.generalizes.push(e),!1;o-=1}return e.setRange([r,o]),!0}))}i.parent.removeChild(i),n.insertChild(i,p.isNumber(r)?r+o:null),i.render()}}n.expand(),e.select(t,!0)}});be.register("ArrangeModule",{commands:{arrangeup:We,arrangedown:Je,arrange:qe,movetoparent:Ke},contextmenu:[{command:"arrangeup"},{command:"arrangedown"},{divider:!0}],commandShortcutKeys:{}}),be.register("basestylemodule",(function(){var e=this;return{commands:{bold:kity.createClass("boldCommand",{base:v,execute:function(e){var t=e.getSelectedNodes();1==this.queryState("bold")?t.forEach((function(e){e.setData("font-weight").render()})):t.forEach((function(e){e.setData("font-weight","bold").render()})),e.layout()},queryState:function(){var t=e.getSelectedNodes(),n=0;return 0===t.length?-1:(t.forEach((function(e){if(e&&e.getData("font-weight"))return n=1,!1})),n)}}),italic:kity.createClass("italicCommand",{base:v,execute:function(e){var t=e.getSelectedNodes();1==this.queryState("italic")?t.forEach((function(e){e.setData("font-style").render()})):t.forEach((function(e){e.setData("font-style","italic").render()})),e.layout()},queryState:function(){var t=e.getSelectedNodes(),n=0;return 0===t.length?-1:(t.forEach((function(e){if(e&&e.getData("font-style"))return n=1,!1})),n)}})},commandShortcutKeys:{bold:"ctrl+b",italic:"ctrl+i"}}})),be.register("ClipboardModule",(function(){var e=this,t=[],n=[];function r(t,o){n.push(o),e.appendNode(o,t),o.render(),o.setLayoutOffset(null);var i=o.children.map((function(e){return e.clone()}));o.clearChildren();for(var a,s=0;a=i[s];s++)r(o,a)}function o(e){e.length&&(e.sort((function(e,t){return e.getIndex()-t.getIndex()})),t=e.map((function(e){return e.clone()})))}var i=kity.createClass("CopyCommand",{base:v,execute:function(e){o(e.getSelectedAncestors(!0)),this.setContentChanged(!1)}}),a=kity.createClass("CutCommand",{base:v,execute:function(e){var t=e.getSelectedAncestors();0!==t.length&&(o(t),e.select(R.getCommonAncestor(t),!0),t.slice().forEach((function(t){e.removeNode(t)})),e.layout())}}),s=kity.createClass("PasteCommand",{base:v,execute:function(e){if(p.checkBridgeApi("nodeLimiter")&&window.bridge.nodeLimiter())window.bridge.openNodeLimitMsg();else if(t.length){var o=e.getSelectedNodes();if(!o.length)return;for(var i,a=0;i=t[a];a++)for(var s,c=0;s=o[c];c++)r(s,i.clone());e.select(n,!0),n=[],e.layout()}},queryState:function(e){return e.getSelectedNode()?0:-1}});if(e.supportClipboardEvent){return{commands:{copy:i,cut:a,paste:s},clipBoardEvents:{copy:function(e){this.fire("beforeCopy",e)}.bind(e),cut:function(e){this.fire("beforeCut",e)}.bind(e),paste:function(e){this.fire("beforePaste",e)}.bind(e)},sendToClipboard:o}}return{commands:{copy:i,cut:a,paste:s},commandShortcutKeys:{copy:"normal::ctrl+c|",cut:"normal::ctrl+x",paste:"normal::ctrl+v"},sendToClipboard:o}}));var Xe=kity.createClass("DropHinter",{base:kity.Group,constructor:function(){this.callBase(),this.rect=new kity.Rect,this.addShape(this.rect)},render:function(e){this.setVisible(!!e),e&&(this.rect.setBox(e.getLayoutBox()).setRadius(3).stroke("rgba(0, 255, 0, .5)",3),this.bringTop())}}),$e=kity.createClass("OrderHinter",{base:kity.Group,constructor:function(){this.callBase(),this.area=new kity.Rect,this.path=new kity.Path,this.addShapes([this.area,this.path])},render:function(e){this.setVisible(!!e),e&&(this.area.setBox(e.area),this.area.fill("rgba(0, 255, 0, .5)"),this.path.setPathData(e.path),this.path.stroke("#0f0",1))}}),et=kity.createClass("TreeDragger",{constructor:function(e){this._minder=e,this._dropHinter=new Xe,this._orderHinter=new $e,e.getTouchContainer().addShapes([this._dropHinter,this._orderHinter])},dragStart:function(e){this._startPosition=e.getPosition(),this._targetNode=e.getTargetNode()},dragMove:function(e){if(this._startPosition){var t=kity.Vector.fromPoints(this._dragPosition||this._startPosition,e),n=this._minder;if(this._dragPosition=e,!this._dragMode){if(kity.Vector.fromPoints(this._dragPosition,this._startPosition).length()<6)return;if(!this._enterDragMode())return}for(var r=0;r<this._dragSources.length;r++){var o=this._dragSources[r];o.isSubtree?o.subtree.move(t):(this._dragSources[r].setLayoutOffset(this._dragSources[r].getLayoutOffset().offset(t)),n.applyLayoutResult(this._dragSources[r]))}this._orderTest()||this._dropTest()}},dragEnd:function(e){var t=this._startPosition;if(this._startPosition=null,this._dragPosition=null,this._dragMode){if(this._fadeDragSources(1),this._orderSucceedHint){var n=this._orderSucceedHint;this._minder.execCommand("movetoparent",this._dragSources,n.node.parent);var r=n.node.getIndex(),o=0;this._dragSources.map((function(e){return e.setLayoutOffset(null),e.parent===n.node.parent&&e.getIndex()<n.node.getIndex()&&o++,e.getIndex()})),"down"===n.type&&r++,r-=o,this._updateLayout(e,t),n.node.setLayoutOffset(null),this._minder.execCommand("arrange",r),this._renderOrderHint(null)}else if(this._dropSucceedTarget)this._dragSources.forEach((function(e){e.setLayoutOffset(null)})),this._minder.execCommand("movetoparent",this._dragSources,this._dropSucceedTarget);else{var i=e.getPosition(),a=Math.min(t.x,i.x);this._updateLayout(e,t),this._dragSources.forEach((function(e){if(["right"].includes(e.getRoot().getLayout())){var t=e.getParent();if(!t)return;t.getLayoutBox().cx>a&&e.setLayoutOffset(null)}})),this._minder.fire("savescene")}this._minder.layout(),this._leaveDragMode(),this._minder.fire("contentchange")}},_updateLayout:function(e,t){var n=this;if(!this._dropSucceedTarget){var r=e.getPosition(),o=Math.min(t.x,r.x),i=Math.max(t.x,r.x);this._dragSources.forEach((function(e){if(["mind"].includes(e.getRoot().getLayout())&&"main"===e.getType()){var t=e.getParent(),a=t.getLayoutBox();if(a.cx>o&&a.cx<i){var s=t.getDataRightNumber(),c=s,l=t.getChildren();if(r.x>a.cx?(l=l.slice(0,s),c++):(l=l.slice(s),c--),t.setDataRightNumber(c),!n._orderSucceedHint){var u=s;if((l=l.filter((function(t){return t!==e}))).length){var d=null;l.some((function(e){var t=e.getLayoutBox();if(r.y<t.cy)return d=e,!0})),u=d?d.getIndex():l[l.length-1].getIndex()+1}e.getIndex()<u&&u--,e.setLayoutOffset(null),n._minder.execCommand("arrange",u)}}}}))}},_enterDragMode:function(){return this._calcDragSources(),this._dragSources.length?(this._fadeDragSources(.5),this._calcDropTargetsAndOrderHints(),this._dragMode=!0,this._minder.setStatus("dragtree"),!0):(this._startPosition=null,!1)},_calcDragSources:function(){this._dragSources=this._minder.getSelectedAncestors().filter((function(e){return!e.isGeneralize&&!e.isRelLine}))},_fadeDragSources:function(e){var t=this._minder;this._dragSources.forEach((function(n){n.getRenderContainer().setOpacity(e,200),n.traverse((function(n){e<1?t.detachNode(n):t.attachNode(n)}),!0)}))},_calcDropTargetsAndOrderHints:function(){var e=this._dragSources,t=[];function n(e,r){e.indexOf(r)>-1||(t.push(r),r.getChildren().forEach((function(t){n(e,t)})),r.generalizes&&r.generalizes.forEach((function(t){var r=t.getRange(),o=t.targetNode.getChildren().slice(r[0],r[1]+1);(o.length>1||!e.includes(o[0]))&&n(e,t.rootNode)})))}n(e,this._minder.getRoot()),p.each(this._minder.getAllSubtree(),(function(t){n(e,t.getRoot())})),this._dropTargets=t;var r=[];this._dropTargetBoxes=this._dropTargets.map((function(e){return e.parent&&(r=r.concat(e.getOrderHint())),e.getLayoutBox()})),this._orderHints=r},_leaveDragMode:function(){this._dragMode=!1,this._dropSucceedTarget=null,this._orderSucceedHint=null,this._renderDropHint(null),this._renderOrderHint(null),this._minder.rollbackStatus()},_drawForDragMode:function(){this._text.setContent(this._dragSources.length+" items"),this._text.setPosition(this._startPosition.x,this._startPosition.y+5),this._minder.getRenderContainer().addShape(this)},_boxTest:function(e,t,n){var r,o,i;if(this._targetNode.isRoot())return null;r=new kity.Box({x:this._dragPosition.x-20,y:this._dragPosition.y-10,width:40,height:20}),n=n||function(e,t,n){return e&&!e.isEmpty()};for(var a=0;a<e.length;a++){if(o=e[a],i=t.call(this,o,a),n(r.intersect(i),r,i))return o}return null},_dropTest:function(){return this._dropSucceedTarget=this._boxTest(this._dropTargets,(function(e,t){return this._dropTargetBoxes[t]}),(function(e,t,n){function r(e){return e.width*e.height}return!!e&&(!!r(e)&&(r(e)>.5*Math.min(r(t),r(n))||(e.width+1>=Math.min(t.width,n.width)||e.height+1>=Math.min(t.height,n.height))))})),this._renderOrderHint(null),this._renderDropHint(this._dropSucceedTarget),!!this._dropSucceedTarget},_orderTest:function(){return this._orderSucceedHint=this._boxTest(this._orderHints,(function(e){return e.area})),this._renderDropHint(null),this._renderOrderHint(this._orderSucceedHint),!!this._orderSucceedHint},_renderDropHint:function(e){this._dragSources&&this._dragSources.every((function(e){return e.isSubtreeRoot()}))||this._dropHinter.render(e)},_renderOrderHint:function(e){this._orderHinter.render(e)},preventDragMove:function(){this._startPosition=null},importNode:function(e){var t=this;p.checkBridgeApi("isFileImportDragMode")&&window.bridge.isFileImportDragMode()&&window.bridge.getFileImportFileData().then((function(n){if(n)if(t._dropSucceedTarget)t._minder.importChildNode(t._dropSucceedTarget,n);else{var r=e.getPosition();minder.execCommand("addSubtree",{root:n,pos:r})}setTimeout((function(){t._dropSucceedTarget=null,t._dropHinter.render(null)}),200)}))}});function tt(e){var t=e.getSelectedNode();if(!t)return null;var n=t.getData("font-size");return n||t.getStyle("font-size")}be.register("DragTree",(function(){var e;return kity.extendClass(y,{getTreeDragger:function(){return e}}),{init:function(){e=new et(this)},events:{"normal.mousedown inputready.mousedown":function(t){if(!t.originEvent.button){var n=t.getTargetNode();n&&n!=this.getRoot()&&e.dragStart(t)}},"dragtree.mousemove":function(e){e.minder.fire("hideiconrequest")},"normal.mousemove dragtree.mousemove":function(t){e.dragMove(t.getPosition())},"normal.mousemove":function(t){if(p.checkBridgeApi("isFileImportDragMode")&&window.bridge.isFileImportDragMode()){var n=t.getTargetNode();n&&!n.isRelLine?(e._dropHinter.render(n),e._dropSucceedTarget=n):(e._dropHinter.render(null),e._dropSucceedTarget=null)}},"normal.mouseup dragtree.beforemouseup":function(t){e.dragEnd(t),t.preventDefault(),e.importNode(t)},statuschange:function(t){"textedit"==t.lastStatus&&"normal"==t.currentStatus&&e.preventDragMove()}}}})),kity.extendClass(R,{getCommentCount:function(){return void 0===this.commentCount?0:this.commentCount},setCommentCount:function(e){this.commentCount=e}}),kity.extendClass(y,{showAllCommentCount:!0,displayComment:function(e){this.showAllCommentCount=e},getDisplayComment:function(){return this.showAllCommentCount}}),be.register("CommentCountModule",(function(){var e=[5,5],t=void 0,n=void 0,r=!0,o=kity.createClass("ShowCommentCommand",{base:v,execute:function(e,t){r=t,e.displayComment(t),e.getAllNode().forEach((function(e){e.render()}))},queryState:function(){return!0},enableReadOnly:!0}),i=kity.createClass("CommentCount",{base:kity.Group,constructor:function(e){this.callBase(e),this.color="#f67d28",this.bg_A=new kity.Group,this.bg_A.addShapes([(new kity.Path).setPathData("M6.25,16.68q.9,2.34,0,3.11c-.9.77,4.44-.47,4.85-2.39Q11.51,15.48,6.25,16.68Z").fill(this.color),(new kity.Path).setPathData("M9.39,17.75a8.66,8.66,0,0,1-6.1-2.48,8.4,8.4,0,0,1,0-12A8.66,8.66,0,0,1,9.39.75h.71a8.66,8.66,0,0,1,6.1,2.48,8.4,8.4,0,0,1,0,12,8.66,8.66,0,0,1-6.1,2.48Z").fill("#fff"),(new kity.Path).setPathData("M10.11,1.5a7.94,7.94,0,0,1,5.58,2.26,7.65,7.65,0,0,1,0,11A7.94,7.94,0,0,1,10.11,17H9.39a7.94,7.94,0,0,1-5.58-2.26,7.65,7.65,0,0,1,0-11A7.94,7.94,0,0,1,9.39,1.5h.71m0-1.5H9.39A9.41,9.41,0,0,0,2.77,2.69a9.15,9.15,0,0,0,0,13.11A9.41,9.41,0,0,0,9.39,18.5h.71a9.41,9.41,0,0,0,6.63-2.69,9.15,9.15,0,0,0,0-13.11A9.41,9.41,0,0,0,10.11,0Z").fill(this.color)]),this.bg_B=new kity.Group,this.bg_B.addShapes([(new kity.Path).setPathData("M8.25,16.68q.9,2.34,0,3.11c-.9.77,4.44-.47,4.85-2.39Q13.51,15.48,8.25,16.68Z").fill(this.color),(new kity.Path).setPathData("M9.39,17.75a8.66,8.66,0,0,1-6.1-2.48,8.4,8.4,0,0,1,0-12A8.66,8.66,0,0,1,9.39.75h5.71a8.66,8.66,0,0,1,6.1,2.48,8.4,8.4,0,0,1,0,12,8.66,8.66,0,0,1-6.1,2.48Z").fill("#fff"),(new kity.Path).setPathData("M15.11,1.5a7.94,7.94,0,0,1,5.58,2.26,7.65,7.65,0,0,1,0,11A7.94,7.94,0,0,1,15.11,17H9.39a7.94,7.94,0,0,1-5.58-2.26,7.65,7.65,0,0,1,0-11A7.94,7.94,0,0,1,9.39,1.5h5.71m0-1.5H9.39A9.41,9.41,0,0,0,2.77,2.69a9.15,9.15,0,0,0,0,13.11A9.41,9.41,0,0,0,9.39,18.5h5.71a9.41,9.41,0,0,0,6.63-2.69,9.15,9.15,0,0,0,0-13.11A9.41,9.41,0,0,0,15.11,0Z").fill(this.color)]),this.bg_C=new kity.Group,this.bg_C.addShapes([(new kity.Path).setPathData("M7.25,16.68q.9,2.34,0,3.11c-.9.77,4.44-.47,4.85-2.39Q12.51,15.48,7.25,16.68Z").fill(this.color),(new kity.Path).setPathData("M9.39,17.75a8.66,8.66,0,0,1-6.1-2.48,8.4,8.4,0,0,1,0-12A8.66,8.66,0,0,1,9.39.75H20.11a8.66,8.66,0,0,1,6.1,2.48,8.4,8.4,0,0,1,0,12,8.66,8.66,0,0,1-6.1,2.48Z").fill("#fff"),(new kity.Path).setPathData("M20.11,1.5a7.94,7.94,0,0,1,5.58,2.26,7.65,7.65,0,0,1,0,11A7.94,7.94,0,0,1,20.11,17H9.39a7.94,7.94,0,0,1-5.58-2.26,7.65,7.65,0,0,1,0-11A7.94,7.94,0,0,1,9.39,1.5H20.11m0-1.5H9.39A9.41,9.41,0,0,0,2.77,2.69a9.15,9.15,0,0,0,0,13.11A9.41,9.41,0,0,0,9.39,18.5H20.11a9.41,9.41,0,0,0,6.63-2.69,9.15,9.15,0,0,0,0-13.11A9.41,9.41,0,0,0,20.11,0Z").fill(this.color)]),this.setId(p.uuid("node_comment_count")),this.setStyle("cursor","pointer")},create:function(e){this.outline&&this.removeShape(this.outline),this.count=e.getCommentCount();var r=void 0,o=void 0,i=void 0;this.count>99?(r="99+",o=this.bg_C,t=[26,17],i=[16,8.5],n=[-7,-17.5]):this.count>9?(r=this.count,o=this.bg_B,t=[24.5,20],i=[12,8.5],n=[-6,-18.5]):(r=this.count,o=this.bg_A,t=[19.5,20],i=[10,9],n=[-6,-17.5]),this.outline=new kity.Rect(t[0],t[1],0,0,0).stroke("transparent").fill("transparent"),this.text&&this.removeShape(this.text),this.text=new kity.Text(r).setTextAnchor("middle").setVerticalAlign("middle").setFontSize(11).setFontBold(!0).fill(this.color).setFontFamily("DinBold").setPosition(i[0],i[1]),this.addShapes([o,this.text,this.outline])},updateCount:function(e){this.count=e}});return{commands:{showCommentCount:o},events:{selectionchange:function(e){e.changed.forEach((function(e){e.render()}))}},renderers:{outside:kity.createClass("CommentCountRenderer",{base:xe,create:function(e){return this.commentCount=new i(e),this.commentCount.on("mousedown",(function(t){t.preventDefault(),e.getMinder().fire("commentCountClick",{node:e,event:t})})),e.commentCountRenderer=this,this.node=e,this.commentCount},shouldRender:function(e){var t=void 0;return t=p.checkBridgeApi("isLogin")&&(window.bridge.isLogin()||window.bridge.isLogin())?p.checkBridgeApi("isShowComment")&&(window.bridge.isGuest()||window.bridge.isShowComment()):r,!V.isMobile&&t&&e.getCommentCount()>0},update:function(t,r,o){var i=r.getCommentCount();return t.updateCount(i),t.create(r),t.setTranslate(o.right+e[0]+n[0],-o.height/2-e[1]+n[1]),new kity.Box({x:o.x+o.width,y:o.y,width:0,height:0})}})}}})),be.register("Expand",(function(){var e=this;kity.extendClass(R,{expand:function(){return this.setData("expandState","expand"),this.renderTree(),this},collapse:function(){return editor.fsm.jump("normal","input-cancel"),this.setData("expandState","collapse"),this.renderTree(),this},isExpanded:function(){var e="collapse"!==this.getData("expandState");return!!e&&(this.isGeneralize?e&&this.generalize.targetNode.isExpanded():e&&(this.isRoot()||this.parent.isExpanded()))},isCollapsed:function(){return!this.isExpanded()}});var t=kity.createClass("ExpandCommand",{base:v,execute:function(e,t){var n=e.getSelectedNode();if(n){for(t&&(n=n.parent);n.parent;)n.expand(),n=n.parent;e.layout(n.getRoot())}},queryState:function(e){var t=e.getSelectedNode();return!t||t.isRoot()||t.isExpanded()?-1:0}}),n=kity.createClass("ExpandToLevelCommand",{base:v,execute:function(e,t){e.getRoot().traverse((function(e){e.getLevel()<t&&e.expand(),e.getLevel()!=t||e.isLeaf()||e.collapse()})),e.layout()},enableReadOnly:!0}),r=kity.createClass("CollapseCommand",{base:v,execute:function(e){var t=e.getSelectedNode();t&&(t.collapse(),e.layout(t.getRoot()))},queryState:function(e){var t=e.getSelectedNode();return t&&!t.isRoot()&&t.isExpanded()?0:-1}}),o=kity.createClass("Expander",{base:kity.Group,constructor:function(e){this.callBase(),this.radius=6,V.isMobile&&(this.radius=8),this.outline=new kity.Circle(this.radius).stroke("gray").fill("white"),this.sign=(new kity.Path).stroke("gray"),this.mask=new kity.Circle(this.radius+5).fill("transparent"),this.addShapes([this.outline,this.sign,this.mask]),this.initEvent(e),this.setId(p.uuid("node_expander")),this.setStyle("cursor","pointer")},initEvent:function(t){this.on("mousedown touchstart",(function(n){e.isNormalStatus()&&e.select([t],!0),t.isExpanded()?t.collapse():t.expand(),t.getMinder().layout(t.getRoot()),t.getMinder().fire("contentchange"),n.stopPropagation(),n.preventDefault()})),this.on("dblclick click mouseup",(function(e){e.stopPropagation(),e.preventDefault()}))},setState:function(e){if("hide"!=e){this.setVisible(!0);var t=["M",1.5-this.radius,0,"L",this.radius-1.5,0];"collapse"==e&&t.push(["M",0,1.5-this.radius,"L",0,this.radius-1.5]),this.sign.setPathData(t)}else this.setVisible(!1)}});return{commands:{expand:t,expandtolevel:n,collapse:r},events:{layoutfinish:function(e){var t=e.node.getRenderer("ExpanderRenderer");t&&t.getRenderShape()&&t.update(t.getRenderShape(),e.node)},"normal.keydown":function(e){if("textedit"!=this.getStatus()){if(e.originEvent.keyCode==ce["/"]){var t=this.getSelectedNode();if(!t)return;var n=t.isExpanded(),r=this.getSelectedNodes();n&&this.setGenSelectStatus(!1),r.forEach((function(e){!e.isRoot()&&e.getChildren().length&&(n?e.collapse():e.expand())})),this.layout(),this.fire("contentchange"),e.preventDefault(),e.stopPropagationImmediately(),this.updateSelectStatusExcludeGen(r)}e.isShortcutKey("Alt+`")&&this.execCommand("expandtolevel",9999);for(var o=1;o<6;o++)e.isShortcutKey("Alt+"+o)&&this.execCommand("expandtolevel",o)}}},renderers:{outside:kity.createClass("ExpanderRenderer",{base:xe,create:function(e){if(!e.isRoot())return this.expander=new o(e),e.getRenderContainer().prependShape(this.expander),e.expanderRenderer=this,this.node=e,this.expander},shouldRender:function(e){return!e.isRoot()},update:function(e,t,n){if(t.parent){var r=t.parent.isExpanded();p.checkBridgeApi("isHideExpander")&&window.bridge.isHideExpander()?e.setState("hide"):e.setState(r&&t.children.length?t.getData("expandState"):"hide");var o=e.radius+Number(t.getStyle("stroke-width")),i=t.getLayoutVectorOut(),a=Math.round(Math.abs(i.getAngle()))%90;a=a<45?a:90-a;var s=t.getVertexOut().offset(i.normalize(o/Math.cos(a/180*Math.PI)));this.expander.setTranslate(s)}}})},contextmenu:[{command:"expandtoleaf",query:function(){return!e.getSelectedNode()},fn:function(e){e.execCommand("expandtolevel",9999)}},{command:"expandtolevel1",query:function(){return!e.getSelectedNode()},fn:function(e){e.execCommand("expandtolevel",1)}},{command:"expandtolevel2",query:function(){return!e.getSelectedNode()},fn:function(e){e.execCommand("expandtolevel",2)}},{command:"expandtolevel3",query:function(){return!e.getSelectedNode()},fn:function(e){e.execCommand("expandtolevel",3)}},{divider:!0}]}})),be.register("fontmodule",{commands:{forecolor:kity.createClass("fontcolorCommand",{base:v,execute:function(e,t){e.getSelectedNodes().forEach((function(e){e.setData("color",t),e.render()}))},queryState:function(e){return 0===e.getSelectedNodes().length?-1:0},queryValue:function(e){return 1==e.getSelectedNodes().length?e.getSelectedNodes()[0].getData("color"):"mixed"}}),background:kity.createClass("backgroudCommand",{base:v,execute:function(e,t){e.getSelectedNodes().forEach((function(e){e.setData("background",t),e.render()}))},queryState:function(e){return 0===e.getSelectedNodes().length?-1:0},queryValue:function(e){return 1==e.getSelectedNodes().length?e.getSelectedNodes()[0].getData("background"):"mixed"}}),fontfamily:kity.createClass("fontfamilyCommand",{base:v,execute:function(e,t){e.getSelectedNodes().forEach((function(e){e.setData("font-family",t),e.render()})),e.layout()},queryState:function(e){return 0===e.getSelectedNodes().length?-1:0},queryValue:function(e){var t=e.getSelectedNode();return t?t.getData("font-family"):null}}),fontsize:kity.createClass("fontsizeCommand",{base:v,execute:function(e,t){e.getSelectedNodes().forEach((function(e){e.setData("font-size",t),e.render()})),e.layout()},queryState:function(e){return 0===e.getSelectedNodes().length?-1:0},queryValue:tt}),addFontSize:kity.createClass("fontsizeCommand",{base:v,execute:function(e){var t=e.getSelectedNodes(),n=tt(e);t.forEach((function(e){e.setData("font-size",n+1),e.render()})),e.layout()}}),downFontSize:kity.createClass("fontsizeCommand",{base:v,execute:function(e){var t=e.getSelectedNodes(),n=tt(e);t.forEach((function(e){e.setData("font-size",n-1),e.render()})),e.layout()}})},commandShortcutKeys:{addFontSize:"ctrl+shift+>",downFontSize:"ctrl+shift+<"}});var nt=kity.createClass("Symbol",{base:kity.Shape,mixins:[kity.ShapeContainer],constructor:function(){this.callBase("symbol")}}),rt={nwseResize:(new kity.Group).pipe((function(){this.setId("symbol-nwse-resize"),this.addShape(new kity.Circle(10).setCenter(6,6).fill("white").stroke("#ddd")),this.addShape((new kity.Path).setPathData("M11.3 12.4l-3.8-.5c-.4 0-.7-.3-.8-.7-.1-.4 0-.8.2-1l.8-.8-4.2-4.2-.8.8c-.2.2-.4.3-.7.3-.5 0-.9-.4-1-.9L.5 1.6c0-.3.1-.6.2-.8.2-.2.5-.3.7-.3h.1l3.8.5c.4 0 .7.3.8.7.1.4 0 .8-.2 1l-.8.8 4.2 4.2.8-.8c.2-.2.4-.3.7-.3.5 0 .9.4 1 .9l.5 3.8c0 .3-.1.6-.2.8-.2.2-.5.3-.7.3h-.1").fill("#FDC145")),this.setStyle("cursor","nwse-resize")})),del:(new kity.Image).pipe((function(){this.width=this.height=25,this.setId("symbol-close-btn"),this.setUrl("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAyCAMAAAAp4XiDAAAAhFBMVEUAAAD+wC3+zFX+vyz+vyz+vyz+vyz+vyz+vyz/5af/57D+vy3/4Zz+wjX+vyz+13v+yU3+vyz+vyz+vyz+vyz+vyz+vyz+vyz/673+24r/5ar+vyz+vyz+vyz/46L/673+24j////+vyz/+u/+13n//fj/9uH/+/P/78n+1XT+wTL+y1T7oNo1AAAAIXRSTlMA8+KwiDwSBe38+fb06+nn4cunoX9qNyb86PLMxi/z++fM2sGjAAABhklEQVRIx+2VyZqCMBCEh1X2fRVcKBQB3//9Jl9kBoNBZuBqnXLIn3R1Ot1fH3G12/1nt6rEcihJoRwr6p9OT2RfwCDBl5PF25RAAyMtUN6HFDkgskXX0nXLFW0QOdGb8FIJgCkazbWiujaGaAKQ0jni4APwTsP+gTp5APzDzB0lIJzraqL6LABlyvUhEeJYcXQkjMTzE1GCqz1hIk52HSCvZpQDjvLyggFxTn007W3ce2sb6scDgumbJhrMjBL3/lL/Wr/0d8pkJrRkgsiASLPb9gBhBgLoW5prEZAn6SoA4xHKBT9MTZePMA2gUFnzAuxmPJow44KqsSGwCYhpXAzDEDSyeGrFrYhGpusGYpA7NRMCVsUyLFFZQMi8igToz3XVgah7rjcdkHYrkBWBrbC/Iskbn1L1lwvGV1eU5YriX/HFVn9ktl3sF9oFryntuYTGbUpEqU+Y/LX15QLgpzMNtgTgZWyDzYhzlIftbXx5WGwbSfzBV4yDryCDb9N4XR7iH/H0DcbqhmxM6YxzAAAAAElFTkSuQmCC"),this.setWidth(this.width),this.setHeight(this.height),this.setStyle("cursor","pointer")})),linkIcon:(new nt).pipe((function(){this.setAttr("viewBox","0 0 13 12"),this.addShape((new kity.Path).setPathData("M11.1,0.7c-0.9-1-2.6-1-3.5,0L5,3.3c0,0,0,0,0,0C4,4.3,4,5.9,5,6.9C5.1,7,5.2,7,5.4,7c0.1,0,0.3,0,0.4-0.1c0.2-0.2,0.2-0.5,0-0.7C5.1,5.6,5.1,4.6,5.7,4c0,0,0,0,0,0l2.6-2.6c0.5-0.6,1.5-0.5,2.1,0C11,2,11,3,10.4,3.6L8.1,5.8C8,6,8,6.4,8.2,6.6c0.1,0.1,0.2,0.1,0.4,0.1s0.3,0,0.4-0.1l2.3-2.3C12.1,3.3,12.1,1.7,11.1,0.7z").fill("inherit")),this.addShape((new kity.Path).setPathData("M6.2,4.9C6,5.1,6,5.4,6.2,5.6c0.6,0.6,0.6,1.5,0,2.1c0,0,0,0,0,0c0,0,0,0,0,0l-2.6,2.6c-0.3,0.3-0.6,0.4-1,0.4c-0.4,0-0.8-0.2-1.1-0.5c-0.6-0.6-0.6-1.5,0-2.1L3.8,6C4,5.8,4,5.4,3.8,5.2c-0.2-0.2-0.5-0.2-0.7,0L0.8,7.5c-1,1-0.9,2.5,0,3.5c0.5,0.5,1.1,0.7,1.8,0.7c0,0,0,0,0,0c0.7,0,1.3-0.3,1.7-0.7l2.6-2.6c0,0,0,0,0,0c0,0,0,0,0,0c1-1,0.9-2.5,0-3.5C6.8,4.7,6.4,4.7,6.2,4.9z").fill("inherit"))}))};y.registerInitHook((function(e){var t=this;Object.keys(rt).forEach((function(e){t.getPaper().addResource(rt[e])}))}));var ot=[16,16],it=[24,22];be.register("hyperlink",{commands:{hyperlink:kity.createClass("hyperlink",{base:v,execute:function(e,t,n){e.getSelectedNodes().forEach((function(e){e.setData("hyperlink",t),e.setData("hyperlinkTitle",n),e.render()})),e.layout()},queryState:function(e){var t=e.getSelectedNodes(),n=0;return 0===t.length?-1:(t.forEach((function(e){if(e&&e.getData("hyperlink"))return n=0,!1})),n)},queryValue:function(e){var t=e.getSelectedNode();return{url:t.getData("hyperlink"),title:t.getData("hyperlinkTitle")}}})},renderers:{right:kity.createClass("hyperlinkrender",{base:xe,create:function(e){var t=new kity.HyperLink,n=new kity.Use(rt.linkIcon);n.setAttr("width",ot[0]),n.setAttr("height",ot[1]),n.setAttr("x",(it[0]-ot[0])/2),n.setAttr("y",(it[1]-ot[1])/2);var r=new kity.Rect(it[0],it[1],0,0,4).stroke("transparent").fill("transparent");return t.addShape(r),t.addShape(n),t.setTarget("_blank"),t.setStyle("cursor","pointer"),t.on("mouseover",(function(){V.isMobile||r.fill("rgba(255, 255, 200, .8)")})).on("mouseout",(function(){r.fill("rgba(255, 255, 255, 0)")})).on("touchstart mouseup",(function(t){if(V.isMobile){t.stopPropagation();var n=e.getData("hyperlink");e.getMinder().fire("clickLinkOnMobile",{url:n})}})),t},shouldRender:function(e){return e.getData("hyperlink")},update:function(e,t,n){var r=t.getData("hyperlink"),o=t.getData("hyperlinkTitle");o=o?[o,"(",r,")"].join(""):r,e.node.setAttributeNS("http://www.w3.org/1999/xlink","title",o),/^(https?|ftp|mailto|file):/g.test(r)||(r="//"+r),e.setHref(r);var i=n.right+8,a=Math.round(n.cy-it[1]/2);return e.setTranslate(i,a),e.fill(t.getStyle("color")),new kity.Box({x:i,y:a,width:it[0],height:it[1]})}})}});be.register("image",(function(){var e=kity.createClass("ImageCommand",{base:v,execute:function(e,t,n,r){var o=e.getSelectedNodes();!function(e,t){var n=document.createElement("img");n.onload=function(){t(n.width,n.height)},n.onerror=function(){t(null)},n.src=e}(t,(function(i,a){o.forEach((function(o){var s=function(e,t,n,r){var o=e/t;return e>n&&o>n/r?t=(e=n)/o:t>r&&(e=(t=r)*o),{width:0|e,height:0|t}}(i,a,e.getOption("maxImageWidth"),e.getOption("maxImageHeight"));o.setData("image",t),o.setData("resource_id",r),o.setData("imageTitle",t&&n),o.setData("imageSize",t&&s),o.render()})),e.layout(),e.fire("saveScene"),e.fire("contentchange")}))},queryState:function(e){var t=e.getSelectedNodes(),n=0;return 0===t.length?-1:(t.forEach((function(e){if(e&&e.getData("image"))return n=0,!1})),n)},queryValue:function(e){var t=e.getSelectedNode();return{url:t.getData("image"),title:t.getData("imageTitle")}}}),t=kity.createClass("ImageRenderer",{base:xe,create:function(e){var t=new kity.Image(e.getData("image"));return t.addClass("km-image"),t.setAttr("type","image"),t},shouldRender:function(e){return e.getData("image")},update:function(e,t,n){e.on("error",(function(){e.setAttr("loadfailed","true")}));var r=t.getData("image"),o=t.getData("imageTitle"),i=t.getData("imageSize");if(i){o&&e.node.setAttributeNS("http://www.w3.org/1999/xlink","title",o);var a=n.cx-i.width/2;i.height=2*Math.floor(i.height/2);var s=n.y-i.height-5,c=parseFloat(t.getData("radius"))||0;return e.setUrl(r).setX(a+c/4|0).setY(0|s).setWidth(0|i.width).setHeight(0|i.height),new kity.Box(0|a,0|s,i.width+c/2|0,i.height+c/2|0)}}}),n=new(kity.createClass("ImageController",{constructor:function(){this.shape=(new kity.Use).pipe((function(){this.ref(rt.nwseResize)})),this.delShape=(new kity.Use).pipe((function(){this.ref(rt.del)})),this.bindEvent()},bindEvent:function(){var e=this;this.shape.on("mousedown",(function(t){t.stopPropagation();var n=e.node,r=n.getMinder(),o=n.getData("imageSize"),i=o.width,a=o.height,s=t.originEvent.x,c=t.originEvent.y;function l(t){var r=t.originEvent.x-s,o=t.originEvent.y-c,l=i,u=a;r-o*i/a>0?((l+=r)<20&&(l=20),u=a/i*l):((u+=o)<20&&(u=20),l=i/a*u),e.resizeImage(l,u),e.updatePosition(l,u),n.setData("imageSize",{width:l,height:u})}r.on("mousemove",l),r.on("mouseup",(function e(t){n.render(),t.minder.layout(),r.off("mousemove",l),r.off("mouseup",e)}))})),this.delShape.on("click",(function(t){e.node.getMinder().execCommand("image",null)}))},show:function(e){var t=e.getRenderContainer();this.node=e,this.updatePosition(),this.remove(),t.addShapes([this.shape,this.delShape])},resizeImage:function(e,t){var n=this.node.getRenderer("ImageRenderer").getRenderShape();n.setWidth(e),n.setHeight(t)},updatePosition:function(e,t){var n=this.node.getRenderer("ImageRenderer").contentBox;e=e||n.width,t=t||n.height,this.shape.clearTransform(),this.shape.translate(n.x+e-10,n.y+t-10),this.delShape.clearTransform(),this.delShape.translate(n.x+e-10,n.y-10)},remove:function(){this.shape&&this.shape.remove&&this.shape.remove(),this.delShape&&this.delShape.remove&&this.delShape.remove()}}));return{defaultOptions:{maxImageWidth:200,maxImageHeight:200},commands:{image:e},renderers:{top:t},events:{click:function(e){if("normal"!==this.getStatus()||V.isMobile){if("hand"===this.getStatus()&&V.isMobile){var t=e.kityEvent.targetShape,r=e.getTargetNode();t.getAttr&&"image"===t.getAttr("type")&&t.url&&r&&minder.fire("openiamgeviewer",{url:r.data.image})}}else{var o=e.kityEvent.targetShape,i=e.getTargetNode();o.getAttr&&"image"===o.getAttr("type")&&o.url&&i?n.show(i):n.remove()}},savescene:function(e){n.remove()}}}})),be.register("ImageViewer",(function(){function e(e,t,r){var o=document.createElement(e);return n(o,t),r&&r.length&&r.forEach((function(e){o.appendChild(e)})),o}function t(e,t,n){e.addEventListener(t,n)}function n(e,t){t&&t.split(" ").forEach((function(t){e.classList.add(t)}))}var r=kity.createClass("ImageViewer",{constructor:function(){var n=e("button","km-image-viewer-btn km-image-viewer-close"),r=e("button","km-image-viewer-btn km-image-viewer-source"),o=this.image=e("img"),i=this.toolbar=e("div","km-image-viewer-toolbar",[r,n]),a=e("div","km-image-viewer-container",[o]),s=this.viewer=e("div","km-image-viewer",[i,a]);this.hotkeyHandler=this.hotkeyHandler.bind(this),t(n,"click",this.close.bind(this)),t(r,"click",this.viewSource.bind(this)),t(o,"click",this.zoomImage.bind(this)),t(s,"contextmenu",this.toggleToolbar.bind(this)),t(document,"keydown",this.hotkeyHandler)},dispose:function(){this.close(),document.removeEventListener("remove",this.hotkeyHandler)},hotkeyHandler:function(e){this.actived&&e.keyCode===ce.esc&&this.close()},toggleToolbar:function(e){e&&e.preventDefault(),this.toolbar.classList.toggle("hidden")},zoomImage:function(e){var t=this.image;"boolean"==typeof e?e&&n(t,"limited"):t.classList.toggle("limited")},viewSource:function(e){window.open(this.image.src)},open:function(e){this.image.src=e,this.zoomImage(!0),document.body.appendChild(this.viewer),this.actived=!0},close:function(){this.image.src="",document.body.removeChild(this.viewer),this.actived=!1}});return{init:function(){this.viewer=new r},events:{dblclick:function(e){if(!V.isMobile){var t=e.kityEvent.targetShape,n=e.getTargetNode();if(t.getAttr&&"image"===t.getAttr("type")&&t.url&&n){var r="";p.checkBridgeApi("getOriginalImageUrl")&&(r=window.bridge.getOriginalImageUrl(n.getData("resource_id"))),p.checkBridgeApi("openViewer")?window.bridge.openViewer(r||t.url):this.viewer.open(r||t.url)}}}}}})),be.register("KeynavModule",(function(){var e=this,t=Math.min,n=Math.max,r=Math.sqrt;function o(t){var n,r=[];e.getAllNode().forEach((function(e){(n=e.getLayoutBox()).width&&n.height&&r.push({left:n.x,top:n.y,right:n.x+n.width,bottom:n.y+n.height,width:n.width,height:n.height,node:e})}));for(var o=0;o<r.length;o++)a(r,o)}function i(e,o){var i,a,s,c,l,u,d;i=t(e.left,o.left),a=n(e.right,o.right),s=t(e.top,o.top),c=n(e.bottom,o.bottom),l=a-i-e.width-o.width,u=c-s-e.height-o.height,d=l<0?u:u<0?l:r(l*l+u*u);var h=e.node,g=o.node;return h.parent==g.parent&&(d/=10),g.parent==h&&(d/=5),d}function a(e,t){for(var n,r,o=e[t],a={},s=0;s<e.length;s++)s!=t&&(r=i(n=e[s],o),n.right<o.left&&(!a.left||r<a.left.dist)&&(a.left={dist:r,node:n.node}),n.left>o.right&&(!a.right||r<a.right.dist)&&(a.right={dist:r,node:n.node}),n.bottom<o.top&&(!a.top||r<a.top.dist)&&(a.top={dist:r,node:n.node}),n.top>o.bottom&&(!a.down||r<a.down.dist)&&(a.down={dist:r,node:n.node}));o.node._nearestNodes={right:a.right&&a.right.node||null,top:a.top&&a.top.node||null,left:a.left&&a.left.node||null,down:a.down&&a.down.node||null}}function s(e,t){var n=e.getSelectedNode();if(!n)return e.select(e.getRoot()),void o(e.getRoot());n._nearestNodes||o(e.getRoot());var r=n._nearestNodes[t];r&&e.select(r,!0)}return kity.extendClass(y,{changeSelectNodeByArrowKey:function(e){s(this,e)}}),{events:{layoutallfinish:function(){this.getRoot();o()},"normal.keydown readonly.keydown":function(e){var t=this;["left","right","up","down"].forEach((function(n){e.isShortcutKey(n)&&(s(t,"up"==n?"top":n),e.preventDefault())}))}}}}));var at=kity.createClass("ResetLayoutCommand",{base:v,execute:function(e){e.resetLayout()},enableReadOnly:!0});be.register("LayoutModule",{commands:{resetlayout:at},contextmenu:[{command:"resetlayout"},{divider:!0}],commandShortcutKeys:{resetlayout:"Ctrl+Shift+L"}});var st=kity.createClass("AppendChildCommand",{base:v,execute:function(e,t,n){var r=e.getSelectedNode();if(!r||r.isRelLine)return null;if(p.checkBridgeApi("nodeLimiter")&&window.bridge.nodeLimiter())window.bridge.openNodeLimitMsg();else{if(r.isRoot()&&"mind"===r.getLayout()){var o=r.getRoot(),i=o.getDataRightNumber();i<=r.getChildren().length/2&&o.setDataRightNumber(i+1)}var a;t=ee(t=X(t),r),a=void 0!==n?e.createNode(t,r,n):e.createNode(t,r),r.isExpanded()?a.render():r.expand(),e.layout(a.getRoot()),e.select(a,!0)}},queryState:function(e){var t=e.getSelectedNode();return t&&!t.isRelLine?0:-1}}),ct=kity.createClass("AppendSiblingCommand",{base:v,execute:function(e,t){if(p.checkBridgeApi("nodeLimiter")&&window.bridge.nodeLimiter())window.bridge.openNodeLimitMsg();else{var n=e.getSelectedNode(),r=n.parent;if(!r)return e.execCommand("AppendChildNode",t);if("mind"===n.getRoot().getLayout()&&"main"===n.getType()){var o=n.getRoot(),i=o.getDataRightNumber();i<=r.getChildren().length/2&&o.setDataRightNumber(i+1)}t=ee(t=X(t),n);var a=e.createNode(t,r,n.getIndex()+1);a.setGlobalLayoutTransform(n.getGlobalLayoutTransform()),a.render(),e.layout(a.getRoot()),e.select(a,!0)}},queryState:function(e){var t=e.getSelectedNode();return t&&!t.isRelLine?0:-1}}),lt=kity.createClass("AppendParentCommand",{base:v,execute:function(e,t){if(p.checkBridgeApi("nodeLimiter")&&window.bridge.nodeLimiter())window.bridge.openNodeLimitMsg();else{var n=e.getSelectedNodes();n.sort((function(e,t){return e.getIndex()-t.getIndex()}));var r=n[0].parent;t=ee(t=X(t),n[0]);var o=e.createNode(t,r,n[0].getIndex());n.forEach((function(e){o.appendChild(e)})),o.setGlobalLayoutTransform(n[n.length>>1].getGlobalLayoutTransform()),o.render(),e.layout(),e.select(o,!0)}},queryState:function(e){var t=e.getSelectedNodes();if(!t.length)return-1;var n=t[0].parent;if(!n)return-1;for(var r=1;r<t.length;r++)if(t[r].parent!=n)return-1;return 0}}),ut=kity.createClass("RemoverNodeCommand",{base:v,execute:function(e){var t=e.getSelectedNodes(),n=R.getCommonAncestor(t),r=t[0].getIndex();if(t.forEach((function(t){t.isRoot()?t.isSubtree&&(e.removeSubtree(t),t.generalize&&e.removeGeneralize(t.generalize)):e.removeNode(t)})),e.layout(),1==t.length){var o=n.children[r-1]||n.children[r],i=n.attached?n:null;e.select(o||i,!0)}else e.select(n,!0)},queryState:function(e){var t=e.getSelectedNode();return t&&!t.isRoot()||t&&t.isSubtree?0:-1}}),dt=kity.createClass("RemoveSingleNodeCommand",{base:v,execute:function(e){var t=e.getSelectedNodes(),n=R.getCommonAncestor(t),r=t[0].getIndex();if(t.forEach((function(t){if(!t.isRoot()){var n=t.parent,r=t.getIndex(),o=t.getChildren().length;if(e.execCommand("movetoparent",t.getChildren(),n,t.getIndex()),e.removeNode(t),"mind"===n.getLayout()){var i=n.getDataRightNumber();i>r&&n.setDataRightNumber(i+o-1)}}})),e.layout(),1==t.length){var o=n.children[r-1]||n.children[r],i=n.attached?n:null;e.select(o||i,!0)}else e.select(n,!0)},queryState:function(e){var t=e.getSelectedNode();return t&&!t.isRoot()?0:-1}});be.register("NodeModule",(function(){return{commands:{AppendChildNode:st,AppendSiblingNode:ct,AppendParentNode:lt,RemoveNode:ut,RemoveSingleNode:dt},commandShortcutKeys:{}}}));var ht=[14.7,16],gt=[24,22];be.register("NoteModule",(function(){var e=kity.createClass("NoteCommand",{base:v,execute:function(e,t){var n=e.getSelectedNode(),r=n.getData("note");n.setData("note",t),(!r&&t||r&&!t)&&(n.render(),e.layout())},queryState:function(e){return 1===e.getSelectedNodes().length?0:-1},queryValue:function(e){var t=e.getSelectedNode();return t&&t.getData("note")}}),t=kity.createClass("NoteIcon",{base:kity.Group,constructor:function(){this.callBase(),this.color="#333",this.iconGroup=new kity.Group,this.path_A=(new kity.Path).setPathData("M13.3,0.8c-0.5-0.5-1.3-0.9-2-0.9H3.4c-0.8,0-1.5,0.4-2,0.9S0.6,2.5,0.6,3.3v9.3c0,0.9,0.3,1.8,0.8,2.4s1.2,1.1,2,1.1h7.8   c0.8,0,1.5-0.4,2-0.9c0.5-0.7,0.8-1.5,0.8-2.4V3.3C14.1,2.5,13.8,1.5,13.3,0.8z M12.7,12.7c0,0.5-0.1,1.1-0.5,1.5   c-0.1,0.3-0.5,0.5-0.9,0.5H3.4c-0.5,0-0.8-0.3-0.9-0.5c-0.3-0.4-0.5-0.9-0.5-1.5V3.3c0-0.5,0.1-1.1,0.5-1.5   c0.1-0.3,0.4-0.5,0.9-0.5h7.8c0.5,0,0.8,0.3,0.9,0.5c0.3,0.4,0.5,0.9,0.5,1.5C12.7,3.3,12.7,12.7,12.7,12.7z"),this.path_B=(new kity.Path).setPathData("M10,4H4.6C4.2,4,4,4.2,4,4.6C4,5,4.2,5.3,4.6,5.3H10c0.4,0,0.7-0.3,0.7-0.7C10.7,4.2,10.4,4,10,4z"),this.path_C=(new kity.Path).setPathData("M10,7.3H4.6C4.2,7.3,4,7.6,4,8c0,0.4,0.3,0.7,0.7,0.7H10c0.4,0,0.7-0.3,0.7-0.7C10.7,7.6,10.4,7.3,10,7.3z"),this.path_D=(new kity.Path).setPathData("M8.7,10.7h-4C4.2,10.7,4,11,4,11.4c0,0.4,0.3,0.7,0.7,0.7h4c0.4,0,0.7-0.3,0.7-0.7C9.4,11,9.1,10.7,8.7,10.7z"),this.rect=new kity.Rect(gt[0],gt[1],0,0,4).stroke("transparent").fill("transparent"),this.on("mouseover",(function(){this.rect.fill("rgba(255, 255, 200, .8)")})).on("mouseout",(function(){this.rect.fill("transparent")})),this.setStyle("cursor","pointer")},create:function(){this.rect&&this.removeShape(this.rect),this.path_A.fill(this.color),this.path_B.fill(this.color),this.path_C.fill(this.color),this.path_D.fill(this.color),this.iconGroup.addShapes([this.path_A,this.path_B,this.path_C,this.path_D]).setTranslate((gt[0]-ht[0])/2,(gt[1]-ht[1])/2),this.addShapes([this.iconGroup,this.rect])},updateColor:function(e){this.color=e}});return{renderers:{right:kity.createClass("NoteIconRenderer",{base:xe,create:function(e){var n=new t;return n.on("mousedown",(function(t){t.preventDefault(),e.getMinder().fire("editnoterequest",{node:e,icon:n})})),n.on("mouseover",(function(){e.getMinder().fire("shownoterequest",{node:e,icon:n})})),n.on("touchstart",(function(t){t.stopPropagation(),t.preventDefault(),e.getMinder().fire("shownoterequest",{node:e,icon:n})})),n.on("mouseout",(function(e){})),n},shouldRender:function(e){return e.getData("note")},update:function(e,t,n){var r=n.right+8,o=Math.round(n.cy-gt[1]/2);return e.updateColor(t.getStyle("color")),e.create(),e.setTranslate(r,o),new kity.Box(r,o,gt[0],gt[1])}})},commands:{note:e},events:{wheel:function(){this.fire("hidenoterequest")}}}}));var ft=["stroke","stroke-width","stroke-dasharray"],pt=kity.createClass("OutlineRenderer",{base:xe,create:function(e){var t=(new kity.Rect).setId(p.uuid("node_outline"));return this.bringToBack=!0,t},update:function(e,t,n){var r=t.getShapeProvider()(e,t,n),o=t.getStyle("stroke-width")||0,i=t.getStyle("stroke-dasharray")||[];return"string"==typeof i&&(i=i.split(",")),i=i.map((function(e){return e*o})),e.fill(t.getFillColor()).stroke(t.getStrokeColor(),o+"").setAttr("stroke-dasharray",i),r}}),mt=new kity.Marker;mt.setWidth(10),mt.setHeight(12),mt.setRef(0,0),mt.setViewBox(-6,-4,8,10),mt.addShape((new kity.Path).setPathData("M-5-3l5,3,-5,3").stroke("#33ffff"));var yt=/wire/.test(window.location.href),bt=kity.createClass("WireframeRenderer",{base:xe,create:function(){var e=new kity.Group,t=this.oxy=(new kity.Path).stroke("#f6f").setPathData("M0,-50L0,50M-50,0L50,0"),n=this.wireframe=(new kity.Rect).stroke("lightgreen"),r=this.vectorIn=(new kity.Path).stroke("#66ffff"),o=this.vectorOut=(new kity.Path).stroke("#66ffff"),i=this.text=(new kity.Text).fill("red");return r.setMarker(mt,"end"),o.setMarker(mt,"end"),e.addShapes([t,n,r,o,i])},shouldRender:function(){return yt},update:function(e,t,n){this.wireframe.setPosition(n.x,n.y).setSize(n.width,n.height);var r=t.getVertexIn(),o=t.getVertexOut(),i=t.getLayoutVectorIn().normalize(30),a=t.getLayoutVectorOut().normalize(30);this.vectorIn.setPathData(["M",r.offset(i.reverse()),"L",r]),this.vectorOut.setPathData(["M",o,"l",a]),this.text.setContent(n.x+","+n.y).setX(n.x).setY(n.y)}});be.register("OutlineModule",(function(){return kity.extendClass(y,{_fireDebounce:p.debounce((function(e){this.fire(e)}),1e3),setNodeOutlineStyle:function(e,t){e&&t&&(e.forEach((function(e){ft.forEach((function(n){n in t&&e.setData(n,t[n])})),e.render()})),this.fire("contentChange"))},clearNodeOutlineStyle:function(e){e&&(e.forEach((function(e){ft.forEach((function(t){delete e.data[t]})),e.render()})),this.fire("contentChange"))},setNodeRadiusStyle:function(e,t){e&&t&&(e.forEach((function(e){e.setData("radius",t),e.render()})),this._fireDebounce("contentchange"))},clearNodeRadiusStyle:function(e){e&&(e.forEach((function(e){delete e.data.radius,e.render()})),this.fire("contentChange"))}}),{events:yt?{ready:function(){this.getPaper().addResource(mt)},layoutallfinish:function(){this.getRoot().traverse((function(e){e.getRenderer("WireframeRenderer").update(null,e,e.getContentBox())}))}}:null,renderers:{outline:pt,outside:[bt]}}})),be.register("IconModule",(function(){var e=window.mindIcons||{},t=kity.createClass("Icon",{base:kity.Group,constructor:function(e){this.callBase(),this.setId(p.uuid("icon")),this.setSize(e),this.create(),this.setStyle("cursor","pointer")},setSize:function(e){e+="";var t=this.values=e.split(","),n=this.num=t.length;this.width=25*n-5,this.height=20},create:function(){var t=this,n=[];this.values.forEach((function(r,o){if(e[r]){var i=25*o-(25*t.num-5)/2,a=new kity.Image("",20,20,i,0);a.setUrl(e[r]),a.node.setAttribute("icon-type",r),n.push(a)}})),this.clear(),this.addShapes(n),this.images=n},update:function(e){this.setSize(e),this.create(e)}});return{commands:{icon:kity.createClass("IconCommand",{base:v,execute:function(e,t){for(var n=e.getSelectedNodes(),r=0;r<n.length;r++)n[r].setData("icon",t||null).render();e.layout()},queryValue:function(e){for(var t,n=e.getSelectedNodes(),r=0;r<n.length&&!(t=n[r].getData("icon"));r++);return t||null},queryState:function(e){return e.getSelectedNodes().length?0:-1}})},renderers:{left:kity.createClass("IconRenderer",{base:xe,create:function(e){var n=new t(e.getData("icon"));return n.on("mousedown",(function(t){t.preventDefault(),e.getMinder().fire("editiconrequest",{node:e,icon:n,event:t})})),n},shouldRender:function(e){return e.getData("icon")},update:function(e,t,n){var r,o,i=t.getData("icon");return e.update(i),r=n.left-e.width-5,o=-e.height/2,e.setTranslate(r+e.width/2,o+0+0),new kity.Box(r,o+0,e.width,e.height)}})},events:{wheel:function(){this.fire("hideiconrequest")}}}})),be.register("PriorityModule",(function(){var e=[null,["#e64248"],["#f9b62a"],["#5565fb"],["#bb3aac"],["#2bcc5b"],["#25b7e6"],["#80acb4"],["#83989b"],["#8e9698"],["#798ba0"],["#a17883"],["#a09379"],["#7899a0"],["#9677a0"],["#77a17e"],["#a69bc0"],["#c0b39d"],["#cca9a8"],["#acbbbe"],["#dfcaa1"]],t=kity.createClass("PriorityIcon",{base:kity.Group,constructor:function(){this.callBase(),this.setSize(20),this.create(),this.setId(p.uuid("node_priority")),this.setStyle("cursor","pointer")},setSize:function(e){this.width=this.height=e},create:function(){var e,t;e=new kity.Circle(10).setTranslate(0,0),t=(new kity.Text).setX(0).setY(0).setTextAnchor("middle").setVerticalAlign("middle").setFontSize(12).setFontBold(!0).fill("white"),this.addShapes([e,t]),this.mask=void 0,this.back=e,this.number=t},setValue:function(t){var n=this.back,r=this.number,o=e[t];o&&n.fill(o[0]),r.setContent(t),r.node.setAttribute("icon-type","priority_"+t),n.node.setAttribute("icon-type","priority_"+t)}});return{commands:{priority:kity.createClass("SetPriorityCommand",{base:v,execute:function(e,t){for(var n=e.getSelectedNodes(),r=0;r<n.length;r++)n[r].setData("priority",t||null).render();e.layout()},queryValue:function(e){for(var t,n=e.getSelectedNodes(),r=0;r<n.length&&!(t=n[r].getData("priority"));r++);return t||null},queryState:function(e){return e.getSelectedNodes().length?0:-1}})},renderers:{left:kity.createClass("PriorityRenderer",{base:xe,create:function(e){var n=new t;return n.on("mousedown",(function(t){t.preventDefault(),e.getMinder().fire("editiconrequest",{node:e,icon:n,event:t})})),n},shouldRender:function(e){return e.getData("priority")},update:function(e,t,n){var r,o,i=t.getData("priority");return e.setValue(i),r=n.left-e.width-5,o=-e.height/2,e.setTranslate(r+e.width/2,0),new kity.Box({x:r,y:o+0,width:e.width,height:e.height})}})}}}));var vt=[18,16],wt=V.isMobile?[24,22]:[18,16];kity.extendClass(R,{isCommentIconActive:function(){return void 0!==this.commentIconActive&&this.commentIconActive},setCommentIconActive:function(e){this.commentIconActive=e}}),be.register("CommentIconModule",(function(){var e=kity.createClass("CommentIcon",{base:kity.Group,constructor:function(){this.callBase(),this.color1="#333",this.color2="#333",this.iconGroup=new kity.Group,this.path_A=new kity.Path,this.path_A.setPathData("M5.25,12.68q.9,2.34,0,3.11c-.9.77,4.44-.47,4.85-2.39Q10.51,11.48,5.25,12.68Z"),this.path_B=new kity.Path,this.path_B.setPathData("M7.25,13.75a6.5,6.5,0,0,1-4.6-11.1A6.46,6.46,0,0,1,7.25.75h4a6.5,6.5,0,0,1,4.6,11.1,6.46,6.46,0,0,1-4.6,1.9Z").fill("#fff"),this.path_C=new kity.Path,this.path_C.setPathData("M11.25,1.5a5.75,5.75,0,0,1,0,11.5h-4a5.75,5.75,0,0,1,0-11.5h4m0-1.5h-4A7.25,7.25,0,0,0,2.12,12.38,7.2,7.2,0,0,0,7.25,14.5h4A7.25,7.25,0,0,0,16.38,2.12,7.2,7.2,0,0,0,11.25,0Z"),this.path_D=new kity.Path,this.path_D.setPathData("M5.75,6.25a1,1,0,1,1-1,1,1,1,0,0,1,1-1"),this.path_E=new kity.Path,this.path_E.setPathData("M9.25,6.25a1,1,0,1,1-1,1,1,1,0,0,1,1-1"),this.path_F=new kity.Path,this.path_F.setPathData("M12.75,6.33a1,1,0,1,1-1,1,1,1,0,0,1,1-1"),this.outline=V.isMobile?new kity.Rect(wt[0],wt[1],0,0,4).stroke("transparent").fill("transparent"):new kity.Rect(wt[0],wt[1],0,0,0).stroke("transparent").fill("transparent"),this.setId(p.uuid("node_comment")),this.setStyle("cursor","pointer")},create:function(){this.outline&&this.removeShape(this.outline),this.path_A.fill(this.color1),this.path_C.fill(this.color1),this.path_D.fill(this.color2),this.path_E.fill(this.color2),this.path_F.fill(this.color2),this.iconGroup.addShapes([this.path_A,this.path_B,this.path_C,this.path_D,this.path_E,this.path_F]),V.isMobile&&this.iconGroup.setTranslate((wt[0]-vt[0])/2,(wt[1]-vt[1])/2),this.addShapes([this.iconGroup,this.outline])},updateColor:function(e,t){V.isMobile?(this.color1=e,this.color2=t):(this.color1=e,this.color2=e)},updateColorAndFill:function(e,t){V.isMobile?(this.color1=e,this.color2=t):(this.color1=e,this.color2=e),this.path_A.fill(this.color1),this.path_C.fill(this.color1),this.path_D.fill(this.color2),this.path_E.fill(this.color2),this.path_F.fill(this.color2)}}),t=kity.createClass("CommentIconRenderer",{base:xe,create:function(t){var n=this;return this.commentIcon=new e,this.commentIcon.on("mousedown",(function(e){e.preventDefault(),t.getMinder().fire("commentIconClicked",{node:t,event:e}),e.stopPropagation()})),this.commentIcon.on("touchstart",(function(e){e.stopPropagation(),e.preventDefault()})),this.commentIcon.on("touchend",(function(e){e.stopPropagation(),e.preventDefault(),t.getMinder().fire("commentIconTouchend",{node:t,event:e})})),this.commentIcon.on("mouseover",(function(){V.isMobile||n.commentIcon.updateColorAndFill("#f67d28","#f67d28")})),this.commentIcon.on("mouseout",(function(){V.isMobile||t.isCommentIconActive()||n.commentIcon.updateColorAndFill("#333","#333")})),t.getRenderContainer().appendShape(this.commentIcon),t.commentIconRenderer=this,this.node=t,this.commentIcon},shouldRender:function(e){var t=void 0;return t=p.checkBridgeApi("isLogin")&&(window.bridge.isLogin()||window.bridge.isLogin())?p.checkBridgeApi("isShowComment")&&(window.bridge.isGuest()||window.bridge.isShowComment()):e.getMinder().getDisplayComment(),V.isMobile?0!==e.getCommentCount():t&&e.isSelected()&&0===e.getCommentCount()},update:function(e,t,n){if(V.isMobile){var r=n.right+8,o=Math.round(n.cy-wt[1]/2),i=t.getBackgroundColor();return-1!==["#fff","#FFF","#ffffff","#FFFFFF","rgb(255, 255, 255)","rgb(255, 255, 255, 1)","transparent"].indexOf(i)?e.updateColor("#f67d28","#f67d28"):e.updateColor("#FFF","#f67d28"),e.create(),e.setTranslate(r,o),new kity.Box(r,o,wt[0],wt[1])}var a="#333";return t.isCommentIconActive()&&(a="#f67d28"),e.updateColor(a),e.create(),e.setTranslate(n.right+4,-n.height/2-4-wt[1]),new kity.Box({x:n.x+n.width,y:n.y,width:0,height:0})}});return{commands:{},renderers:V.isMobile?{right:t}:{outside:t},events:{}}})),be.register("ProgressModule",(function(){var e={0:"",1:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2hpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMTM4IDc5LjE1OTgyNCwgMjAxNi8wOS8xNC0wMTowOTowMSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDpGODdGMTE3NDA3MjA2ODExOEY2MkExRjhGQUM5MkEzRiIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDpGN0I3QkIyRTVEOTQxMUU5QTJGODg0QjVBMzg5MzkyMCIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDpGN0I3QkIyRDVEOTQxMUU5QTJGODg0QjVBMzg5MzkyMCIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M2IChNYWNpbnRvc2gpIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6Q0JDREFDREY0M0JGMTFFOTkwODJFQ0ZCQjY1OUU1ODYiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6Q0JDREFDRTA0M0JGMTFFOTkwODJFQ0ZCQjY1OUU1ODYiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz5+N4+UAAAA7UlEQVR42mJkwAImzpzNA6SigDgAiE2AWBQq9RqIzwDxBiBelp+e+gVdLyMWw5KBVCcQCzPgB2+BuBxo6FysBgINYgNSIMkYBtLAEiBOBhr8C8RhQZIgxzAGJD2xIIIJyZvkGAY3FGoGAyM0Ah4QEWYMRISpAhM0Nik1jAFqRhQTNGlQCwQwQdMZtYAJC1KihYO8tBSidE+aNQddSJSJgcqABZqdRAnYTCx4zQTNm9QCZ5igGZ1aYAPIwGXQRMlAhYS9jAlaBJVTwUBQyfMFubRZTEF+XgI0DFE4QEEytChiIKf4on0BS60qACDAAO22R+pezxWdAAAAAElFTkSuQmCC",2:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2hpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMTM4IDc5LjE1OTgyNCwgMjAxNi8wOS8xNC0wMTowOTowMSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDpGODdGMTE3NDA3MjA2ODExOEY2MkExRjhGQUM5MkEzRiIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDpGN0I3QkIzMjVEOTQxMUU5QTJGODg0QjVBMzg5MzkyMCIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDpGN0I3QkIzMTVEOTQxMUU5QTJGODg0QjVBMzg5MzkyMCIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M2IChNYWNpbnRvc2gpIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6Q0JDREFDREY0M0JGMTFFOTkwODJFQ0ZCQjY1OUU1ODYiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6Q0JDREFDRTA0M0JGMTFFOTkwODJFQ0ZCQjY1OUU1ODYiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz6PijVHAAACD0lEQVR42qSVS0gbURSGz725mRhNrFERjCAiOJGCmGJBzMaFCILuxIUUwU0VhFIfCF2Xdql21eey+GhFQdCVKzeCooibLFxa6qOoqJE2M4kz3j8wgzUxTsy/SXJz/i/n3v/kDqMMCm4N+jixF8WisC9u6I1xI+HDumAuXTD+WzOSP0wy3x88/3J118vuLlRvD710MT6lFlSK7tJmT8Sv0uLZJn0+Xv2vTtYk5cubX02fJjICZVeK3+Wd9XJ314eafqW1+KldNHGwTJOHy5TeDSOFi23NSERkt3pqF9aXgFV7yjvn6l4rpcJHThRUAlTo8jQc6eez8mM31ri1TXQmYR6nsHpvkJZC47SojinwgpECIgCcGbbpFBYuqqF5dZQqZYfwwAtGKkykiQBun1k2Rfwh+qmO0O0fhxcMsDhGA2k6gXWUhGmm7hUV8fRyMMDimDOMxkPqKWuhr7UD5Gbins5VAktgaCvcT7LCOgPPKCRDYOljawsMsISzRKvIqXgBd1/9SVxQvgIDLAlUdtdje3kDwQCLXyb/fl8429DyBYIBFjfInN6LHybXLqOPhsELBlj2DRPeHddOEzEzV8EDr/XXsxXaGV5oj76L5wJFLTzw2ilbb2LX/3r3tZOVtuhb3cn2UYNaeODN6YK1Bh+jgTQRAM7s2jRG9ps+fst6Y2d7BGDOMBpIEwFkegTcCDAAydRFrNlwhNQAAAAASUVORK5CYII=",3:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2hpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMTM4IDc5LjE1OTgyNCwgMjAxNi8wOS8xNC0wMTowOTowMSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDpGODdGMTE3NDA3MjA2ODExOEY2MkExRjhGQUM5MkEzRiIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDpGN0I5MTlDNzVEOTQxMUU5QTJGODg0QjVBMzg5MzkyMCIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDpGN0I5MTlDNjVEOTQxMUU5QTJGODg0QjVBMzg5MzkyMCIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M2IChNYWNpbnRvc2gpIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6Q0JDREFDREY0M0JGMTFFOTkwODJFQ0ZCQjY1OUU1ODYiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6Q0JDREFDRTA0M0JGMTFFOTkwODJFQ0ZCQjY1OUU1ODYiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz78uHhEAAAB+0lEQVR42qSVvy8kYRzGv/Puu+8gayUim1AIBRJXuEMi0QiiIhQqkUsUJxINivsHROtOJUShEKGhECqVRCQuJ6LZiEai8OsQt4udnZ2Z995nY/aQvbVz8yRTzDvP9zPv+z7feUejLKr4ORJipA2GedFnwzEbDCcVwrjQAgmdieNH21h0SC6eN88/vK3V3g5UHowOBzT2vbagnPeXtuitxbW0fveD5q62Mx71XDKNGVLKsbOm2YWsQDUrURwoXClkwZ6ZqiHRFq7PmKbPN+nbxearFwuNk/JaDtFG3E4MqNmaGOeuAbBKvax7tWZMlPIQvSdTWmTZNo+Ikl51u6Kufowzd5mYmYLp+cBcqX2kS/OeS3L6wEgDEQD2DMv0AnspRiwARjpMpIkAXu6ZV8XsBEWCJQIshtZAmuRTnFgQLI4+Q2v41WnymnTGP3E0rZpuTnNjqJq+RDpyehKOScs3u0U8n7e3hz+kr1z6lYoBSKyABR+uU799LxkMsBRQHO3FT3wDwQCLxaynpbW7/aRfIBhgMdXtyyfGhbUTi/43DLVggJU5YT4efU3epuLSq1CDWvfTy6jucHytKzpleIHCixrU/v0Mn4Uj6Cx5s9UZnTTzWT488KIGtZ4OWLfx0RpIEwFgz2zpTPzzgM3nF4A+Q2sgTQSQ7RfwR4ABANqtU61ftGsWAAAAAElFTkSuQmCC",4:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2hpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMTM4IDc5LjE1OTgyNCwgMjAxNi8wOS8xNC0wMTowOTowMSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDpGODdGMTE3NDA3MjA2ODExOEY2MkExRjhGQUM5MkEzRiIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDpGN0I5MTlDQjVEOTQxMUU5QTJGODg0QjVBMzg5MzkyMCIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDpGN0I5MTlDQTVEOTQxMUU5QTJGODg0QjVBMzg5MzkyMCIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M2IChNYWNpbnRvc2gpIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6Q0JDREFDREY0M0JGMTFFOTkwODJFQ0ZCQjY1OUU1ODYiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6Q0JDREFDRTA0M0JGMTFFOTkwODJFQ0ZCQjY1OUU1ODYiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz4lPylRAAACRElEQVR42mJkwAKkzqTzMDEwxvCxcMX8+PdL/8e/3zwgcVZG5p/sTKw3vv39OfMfw//Fz0xmfkHXy4guIHc2K42ZkalPjUOSJVjYnN2KR41BjJWfweBSGVwNGyPLf6CBv4DMgkfG02ZgNRDoKjZeZs4VnEys3hMUEtjs+bRQLJI+m4HhE6CL/7Mxse78+veHP9C1IAsYWGCSIMPk2EW8Vqjmswmx8DAQA37//8vI+I/RnZuZYyOQ6wkSY4J5E+QyoGHsxBoGA7/+/2H89e+3O9AMsBcYQREADOgX85UzudG9ScjLyIAFGGF//v8VYQLFJigC8BlGDACawwbEsUygpAGKTQYKAcjrXMzs6UygdAZKGtQAP//91mACJVpQOiMEJFgFiIl1diZibV+vXsIgzy6KVw0jA+N/Jg4m1i+vfn8kaCAwjTJs0ihj0OKUwakGmNC/Aw1ku3jsyy2iXCnCwsuwTr2YwZxHBZvrGICOO8/06c+3JWvfnvxJrNeBOYphqWoegwu/Loo4NzP7v09/v89jAmbyJbd+PP9z8NM1omOTk4mNYa5yJkOIsDki2fz78wNILYeXMAYXS3++/f35PyngHxCWPljyX+ZMxj+QGSi2qp8vWOd6reUHKYaC1IL0KJ/L3Y3IMVDw+e/3iEc/32xzvtb0ixjvH/p0ncH5WvPPhz9fb/n+75cnyQUsOxMLw9Nf7xnOfrnHsOzNkR83fjz78/f/vyJgATsbb4mNrwoARsYnYMl0GZgyFgEjcxm2KgAgwACjlkBR3jRkmQAAAABJRU5ErkJggg==",5:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2hpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMTM4IDc5LjE1OTgyNCwgMjAxNi8wOS8xNC0wMTowOTowMSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDpGODdGMTE3NDA3MjA2ODExOEY2MkExRjhGQUM5MkEzRiIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDpGN0I5MTlDRjVEOTQxMUU5QTJGODg0QjVBMzg5MzkyMCIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDpGN0I5MTlDRTVEOTQxMUU5QTJGODg0QjVBMzg5MzkyMCIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M2IChNYWNpbnRvc2gpIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6Q0JDREFDREY0M0JGMTFFOTkwODJFQ0ZCQjY1OUU1ODYiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6Q0JDREFDRTA0M0JGMTFFOTkwODJFQ0ZCQjY1OUU1ODYiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz7PAm74AAAB3UlEQVR42qyVzytEURTH7z3v12BQSKGkRLKhKGVjYSEsLGwsKCu/NiMLf4A/QGwwLCjExkKhLG2UYoGSHxtZIKEwzPt5r3PUiDGZYd63Xu+9+9773PN959xzOUug4v3+IDDenaNmdpvCrjGFE6RxjSuWAdrpm2eFBZOL1/XhSPy3PH6g9GCoT+EwXhkoUjvzG4zGYCUr1HJZ7dHo5zs6VyUCbbwcvqqbmkkIxKj0bCVjNQO09omyXr0pp/rbRCUHAz+cYMRSB2371TM7MFqagKmxhwQrNQraVitCep4aZKnIkR7ngrdkKYF1vG2lMYjZpMgQZqQKi8mWLreF04KMDwucEoA/+na+fDAr3mYyy1+lYsJc6RUAZZMS8BssFSFHx6MHqDQomyxNkfVMxegHqjMqDT9kCacKqGipzvwQZt0A5qM44xICoEXunCdfgFjoUQTqh7uRc1+AWH7H8Oy+La097Fnpwmh9v3jRWcBFvnRu3rg7zydpASVjJp5WgFqQJ8XI8OWC/ehG/gXDVSIkkyFkRT+yjC1oNiqcza6LSeuvULKK/24DGXOfzYGE/ruurPut5pMxO1X7mFWhgrKF7avTrwYbwsjCv3bsJFuAifbOcAuYRuByoi3gXYABABVzzkbJT3SqAAAAAElFTkSuQmCC",6:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2hpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMTM4IDc5LjE1OTgyNCwgMjAxNi8wOS8xNC0wMTowOTowMSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDpGODdGMTE3NDA3MjA2ODExOEY2MkExRjhGQUM5MkEzRiIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDpGN0JCODkyMTVEOTQxMUU5QTJGODg0QjVBMzg5MzkyMCIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDpGN0JCODkyMDVEOTQxMUU5QTJGODg0QjVBMzg5MzkyMCIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M2IChNYWNpbnRvc2gpIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6Q0JDREFDREY0M0JGMTFFOTkwODJFQ0ZCQjY1OUU1ODYiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6Q0JDREFDRTA0M0JGMTFFOTkwODJFQ0ZCQjY1OUU1ODYiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz4QzL3rAAACQElEQVR42qxVTWsTURS9785X0sYKtQgqFEGM4kalBcGNy6IuKirookJXpioSsaA/QpB2YbFFcVGLVVdSFNyIIOhCg1BFWusHcVGsFKxpkvl+z3uDCTFN4gR7YJiZ996cd887994RUAdb36QSCGKgQ28bcKS315F+gscNobkWGnPF0B2XoCYXe8fztd+K2oHuzPmzmsDrydgW/cSmA9bBRBI2Gxth3+yVyhpT6IoIPXq89K1n7GZdQorK3KDFp+NoHB3ZPmge6tjz10bbMkNrlFDEykTjaSF0+ila3gD08iSTdVtdR6Z3ps1OPQFR4KtQCCn62rXYI3o9zGNYlsmREZkVlawMTwXCk34fcZQkCDaADvr7nR3n2mtl/ktyNXQyLFBhF7KbbEAzsiggHpOuM8ipwW7Cf4Klt2lWCjnPODXWA670dyMnLefZeoBct0ouCyEaLgopha9mpyIRChAKyeHVJW+lwY4BXPh6G+4uv4hESIluYxzN16/yC2smbenB4KcxmPmZiSyZgnuHK0Fh6v7yS6d6YjW04dTHEXie+xCZjOubvpvgM3zw2V0Knv16X5r44efg2Pw1yBS+tGSIAuCg7iG3IDr4y8PZSXe2mC2RzdmLLZFRlUgFKk1cdsXe5Nv0Q6nU8aJ0sRUylmqgPrOwf7S/0hwY+dA5Tb4/JqdkVDJeq6P2hNrXyWYNNkW3Ua5NLqdGUZFEl87tIjXYW007dvUvgGpziMppF1VA7A+RE0NjPhfaN9iAer+A3wIMAJUl5rgsMhT3AAAAAElFTkSuQmCC",7:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2hpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMTM4IDc5LjE1OTgyNCwgMjAxNi8wOS8xNC0wMTowOTowMSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDpGODdGMTE3NDA3MjA2ODExOEY2MkExRjhGQUM5MkEzRiIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDpGN0JCODkyNTVEOTQxMUU5QTJGODg0QjVBMzg5MzkyMCIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDpGN0JCODkyNDVEOTQxMUU5QTJGODg0QjVBMzg5MzkyMCIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M2IChNYWNpbnRvc2gpIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6Q0JDREFDREY0M0JGMTFFOTkwODJFQ0ZCQjY1OUU1ODYiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6Q0JDREFDRTA0M0JGMTFFOTkwODJFQ0ZCQjY1OUU1ODYiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz768fpCAAAB7UlEQVR42qxVTUsbURR9785XEqNCK0IrSEH8wI0VC4KbLqUKdaFLBVeNCn50058hZqFUEVyUonRlaSn0N1QR7KbirgtxKcaYmUzee54rJmiaxmjmwDAzb+add+8799wnRQU830slScjJJjsx6et8n6/DJI870go8cv5cqmBdC/Pp5NX6RflcWT7Qvj/3zpK03BV7Zo8/HfSGkl2i1WkWLw8/lP5xpW1AmMfj0t+BtY8VCRGV22jFd+LkjK68mHZfN/XeWahtf+afTBCxccn5mVX+GKLlBYRd/Mhk7V7LyE7novvETopaEBolpZbDDVbsK17f8BgV0+TIQObVSlZE3hRkXofD4LhOQbIA2OjTrY7ZhvI070v5NmwIVjCqhVhNFqAaWS0Aj4trirg0WE1RJzj1hOWliOuMSyMKBDrsIS5arrMoANU9FsWIiCCFNASFM1ERotBzFCf3F6wUCSGC+01nhexnuKRQLxn7O6NyG+yULxntBwly6yKEED5u28QtSBv9HhuqHksGl2gjzCK4cqVu03mwsBtq9ZYL9KGpOmR/O+5Pj5WaAyOrgnGbrO9QSj9AVY05P9C+Jqo12BRuafbm/6LlqJBigH2bR4PdrNqxbx8B8OYM7NQNB8RuiPwYOUfnKrfKAlQ6Aq4EGAB6ILRp6si9kwAAAABJRU5ErkJggg==",8:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2hpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMTM4IDc5LjE1OTgyNCwgMjAxNi8wOS8xNC0wMTowOTowMSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDpGODdGMTE3NDA3MjA2ODExOEY2MkExRjhGQUM5MkEzRiIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDpGN0JCODkyOTVEOTQxMUU5QTJGODg0QjVBMzg5MzkyMCIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDpGN0JCODkyODVEOTQxMUU5QTJGODg0QjVBMzg5MzkyMCIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M2IChNYWNpbnRvc2gpIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6Q0JDREFDREY0M0JGMTFFOTkwODJFQ0ZCQjY1OUU1ODYiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6Q0JDREFDRTA0M0JGMTFFOTkwODJFQ0ZCQjY1OUU1ODYiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz4fxzT4AAACI0lEQVR42qxVS2sTURS+98zjTiYxIu3KYClV1CwsSrsSXIcqEhcuXLQgVEkRtOovcOPKbrJQmtqdCx9dSUV04T+wGBHEIoJYcCEovtrJTDJz/Y5MQ2ynYWJ7hnmdufe73znnfmekSLC9LytZEnI8b7oTftQ84kVBnv2WNHxF1ru10K9FQt/7PFr7vXGu3OgYWLpUMSTNFDMF81zfcWc0t18U7D2iWL/eHmNLUwMwwOPVTyN3ZhMBwcreZWQeuGSfrA6eVyfyxX8WKixNbYoEjLVN1vPVsFEGW15AmDGYzBnOwwHVP7Zw8JrabbgijTV1KGUkS1nDeYzXMfYRXxDipNb69PxQJTXYugW6JYOoWUKq/oYgwc41pfGtpUO1z+4Ts0MXxdHs4KaJSSF3GjB8YPQT2I2jojY7V4Kvorx8S9z98kJoHL0YY+CcIJfUJNNe/4BVxI2VBXHhQ038CNd6Ct01VIWwz4aTBjz7XheltzdFffVjalBgHSZUSm01oDMFKauuuCi9JauLSSE1oTqNnQLERvcoQ/brnQKEzt/Qr9CbY21uF4wxGIuV8igW+rYMjDh19yluQdOIP/pfMNQhghCmgeW1N/SBV1cWW1F4qnOTpw3VInPx/bFqud0c2NA0z5hkPOmFKY/FnKdoX2e7NljcqqzNrdgyK4ToI2+X0WDnu3bsuD/m+BcAbU5BToegACcGajhkLf8MvdtcgKRfwB8BBgBO4NcxGjHCuwAAAABJRU5ErkJggg==",9:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2hpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMTM4IDc5LjE1OTgyNCwgMjAxNi8wOS8xNC0wMTowOTowMSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDpGODdGMTE3NDA3MjA2ODExOEY2MkExRjhGQUM5MkEzRiIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDpGN0JERDE3RTVEOTQxMUU5QTJGODg0QjVBMzg5MzkyMCIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDpGN0JERDE3RDVEOTQxMUU5QTJGODg0QjVBMzg5MzkyMCIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M2IChNYWNpbnRvc2gpIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6Q0JDREFDREY0M0JGMTFFOTkwODJFQ0ZCQjY1OUU1ODYiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6Q0JDREFDRTA0M0JGMTFFOTkwODJFQ0ZCQjY1OUU1ODYiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz56DCe+AAAByElEQVR42mJkwAKkzqTzAKkoIA4AYhMgFoVKvQbiM0C8AYiXPTOZ+QVdLyMWw5KBVCcQCzPgB2+BuBxo6FysBgINYgNSIMkYBtLAEiBOBhr8C8RhQZIgxzAGJD2xIIIJyZvkGAY3FGoGAyM0Ah4QEWYogJeZg+Hz3x/oYarABI1NkgyLFLFmuG7Qz6DMIY4sDDIjigmaNIgGVrzqDB1yUQz7Pl5hePDzNbp0ABM0nREFQC6ao5zOcPvHC4as+3MZ/v7/h67EhAkp0YIBMyMTgyu/HgMrIwuKSgEWboaFKtkMv/79YYi/M5XhC2r4wYAoE7qIPLsowwKVLIZ5yhkMnExsYDGQ4XOU0hkkWQUZEu5OY3j66x1OXzBBsxMc3PvxkiH/wQIGB35thmWqecDY5GTolI9isORVYygAil/4+gBfqLxmgeZNT2TRNW9PMHz6+41hplIawyHtRgYxVj6GzmcbGTa/P0somM8wQTM6Btj14RJDzO3JDFxAb4MsmPx8BzHxtoFgwuZmYmf4/u8Xwz+G/wxEFBYKTNAiqByXqq//fhJjGAO05PmCXNospiA/LwEahigcoCAZWhQxkFN80b6ApVYVABBgABBillOFM4g3AAAAAElFTkSuQmCC"},t=kity.createClass("ProgressIcon",{base:kity.Group,constructor:function(e){this.callBase(),this.setSize(20),this.create(e),this.setValue(e),this.setId(p.uuid("node_progress")),this.setStyle("cursor","pointer")},setSize:function(e){this.width=this.height=e},create:function(e){var t=new kity.Image("",20,20,-10,-10);this.addShape(t),this.image=t},setValue:function(t){this.image.setUrl(e[t]),this.image.node.setAttribute("icon-type","progress_"+t)}});return{commands:{progress:kity.createClass("ProgressCommand",{base:v,execute:function(e,t){for(var n=e.getSelectedNodes(),r=0;r<n.length;r++)n[r].setData("progress",t||null).render();e.layout()},queryValue:function(e){for(var t,n=e.getSelectedNodes(),r=0;r<n.length&&!(t=n[r].getData("progress"));r++);return t||null},queryState:function(e){return e.getSelectedNodes().length?0:-1}})},renderers:{left:kity.createClass("ProgressRenderer",{base:xe,create:function(e){var n=new t(e.getData("progress"));return n.on("mousedown",(function(t){t.preventDefault(),e.getMinder().fire("editiconrequest",{node:e,icon:n,event:t})})),n},shouldRender:function(e){return e.getData("progress")},update:function(e,t,n){var r,o=t.getData("progress");return e.setValue(o),r=n.left-e.width-5,0,e.setTranslate(r+e.width/2,0),new kity.Box(r,-10,e.width,e.height)}})}}})),be.register("Resource",(function(){var e,t,n,r,o,i,a,s,c,l,u=(e=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225],o=[608135816,2242054355,320440878,57701188,2752067618,698298832,137296536,3964562569,1160258022,953160567,3193202383,887688300,3232508343,3380367581,1065670069,3041331479],l=function(e){return e<0&&(e+=4*(1<<30)),("00000000"+e.toString(16)).slice(-8)},i=[[16,50,84,118,152,186,220,254],[174,132,249,109,193,32,123,53],[139,12,37,223,234,99,23,73],[151,19,205,235,98,165,4,143],[9,117,66,250,30,203,134,211],[194,166,176,56,212,87,239,145],[92,241,222,164,112,54,41,184],[189,231,28,147,5,79,104,162],[246,158,59,128,44,125,65,90],[42,72,103,81,191,233,195,13]],a=function(e,t,n){var r=s[e]^s[t];s[e]=r>>>n|r<<32-n},t=function(e,t,l,u,d){var h=r+i[n][e]%16,g=r+(i[n][e]>>4);l=4+l%4,u=8+u%4,d=12+d%4,s[t%=4]+=s[l]+(c[h]^o[g%16]),a(d,t,16),s[u]+=s[d],a(l,u,12),s[t]+=s[l]+(c[g]^o[h%16]),a(d,t,8),s[u]+=s[d],a(l,u,7)},function(i,a){var u,d,h,g,f,p,m,y;for(a instanceof Array&&4===a.length||(a=[0,0,0,0]),d=e.slice(0),u=o.slice(0,8),n=0;n<4;n+=1)u[n]^=a[n];if(f=(h=16*i.length)%512>446||h%512==0?0:h,h%512==432)i+="老";else{for(i+="耀";i.length%32!=27;)i+="\0";i+=""}for(c=[],y=0;y<i.length;y+=2)c.push(65536*i.charCodeAt(y)+i.charCodeAt(y+1));for(c.push(0),c.push(h),p=c.length-16,m=0,r=0;r<c.length;r+=16){for(m+=512,g=r===p?f:Math.min(h,m),(s=d.concat(u))[12]^=g,s[13]^=g,n=0;n<10;n+=1)for(y=0;y<8;y+=1)y<4?t(y,y,y,y,y):t(y,y,y+1,y+2,y+3);for(y=0;y<8;y+=1)d[y]^=a[y%4]^s[y]^s[y+8]}return d.map(l).join("")}),d=[51,303,75,200,157,0,26,254].map((function(e){return kity.Color.createHSL(e,100,85)}));kity.extendClass(y,{getHashCode:function(e){var t,n=1315423911;for(t=(e=u(e)).length-1;t>=0;t--)n^=(n<<5)+e.charCodeAt(t)+(n>>2);return 2147483647&n},getResourceColor:function(e){var t,n=this._getResourceColorIndexMapping();return Object.prototype.hasOwnProperty.call(n,e)||(t=this._getNextResourceColorIndex(),n[e]=t),d[n[e]]||kity.Color.createHSL(Math.floor(this.getHashCode(e)/2147483647*359),100,85)},getUsedResource:function(){var e,t=this._getResourceColorIndexMapping(),n=[];for(e in t)Object.prototype.hasOwnProperty.call(t,e)&&n.push(e);return n},_getNextResourceColorIndex:function(){var e,t,n,r=this._getResourceColorIndexMapping();for(e in t=[],r)Object.prototype.hasOwnProperty.call(r,e)&&t.push(r[e]);for(n=0;n<d.length;n++)if(!~t.indexOf(n))return n;return-1},_getResourceColorIndexMapping:function(){return this._resourceColorMapping||(this._resourceColorMapping={})}});var h=kity.createClass("ResourceCommand",{base:v,execute:function(e,t){var n=e.getSelectedNodes();"string"==typeof t&&(t=[t]),n.forEach((function(e){e.setData("resource",t).render()})),e.layout()},queryValue:function(e){var t=e.getSelectedNodes(),n=[];return t.forEach((function(e){var t=e.getData("resource");t&&t.forEach((function(e){~n.indexOf(e)||n.push(e)}))})),n},queryState:function(e){return e.getSelectedNode()?0:-1}}),g=kity.createClass("ResourceOverlay",{base:kity.Group,constructor:function(){var e,t;this.callBase(),t=this.rect=(new kity.Rect).setRadius(4),e=this.text=(new kity.Text).setFontSize(12).setVerticalAlign("middle"),this.addShapes([t,e])},setValue:function(e,t){var n,r,o;n=this.text,e==this.lastResourceName?r=this.lastBox:(n.setContent(e),r=n.getBoundaryBox(),this.lastResourceName=e,this.lastBox=r),n.setX(8).fill(t.dec("l",70)),(o=this.rect).setPosition(0,r.y-4),this.width=Math.round(r.width+16),this.height=Math.round(r.height+8),o.setSize(this.width,this.height),o.fill(t)}});return{commands:{resource:h},renderers:{right:kity.createClass("ResourceRenderer",{base:xe,create:function(e){return this.overlays=[],new kity.Group},shouldRender:function(e){return e.getData("resource")&&e.getData("resource").length},update:function(e,t,n){var r=t.getStyle("space-right"),o=this.overlays,i=t.getData("resource").filter((function(e){return null!==e}));if(0!==i.length){var a,s,c,l=t.getMinder();for(c=0,a=0;a<i.length;a++)c+=r,(s=o[a])||(s=new g,o.push(s),e.addShape(s)),s.setVisible(!0),s.setValue(i[a],l.getResourceColor(i[a])),s.setTranslate(c,-1),c+=s.width;for(;s=o[a++];)s.setVisible(!1);return e.setTranslate(n.right,0),new kity.Box({x:n.right,y:Math.round(-o[0].height/2),width:c,height:o[0].height})}}})}}}));be.register("Select",(function(){var e=this,t=e.getRenderContainer(),n=[];function r(){return e.getAllNodeExcludeGen()}var o,i,a,s=!1,c=(o=null,i=[],a=new kity.Path,{selectStart:function(a){if(!(a.originEvent.button||a.originEvent.altKey||e.getOption("enableLeftKeyDrag"))){if(o)return this.selectEnd();o=a.getPosition(t).round(),n=r(),i=a.isShortcutKey("Ctrl")?e.getSelectedNodes():[]}},selectMove:function(r){if("textedit"!=e.getStatus()&&o){var c=o,l=r.getPosition(t);if(!s){if(kity.Vector.fromPoints(c,l).length()<10)return;s=!0,e.setStatus("frame-selection"),t.addShape(a),a.fill("rgba(57, 130, 252, .2)").stroke("rgba(57, 130, 252, .7)").setOpacity(.8).getDrawer().clear()}var u=new kity.Box(c.x,c.y,l.x-c.x,l.y-c.y),d=[];u.left=Math.round(u.left),u.top=Math.round(u.top),u.right=Math.round(u.right),u.bottom=Math.round(u.bottom),a.getDrawer().pipe((function(){this.clear(),this.moveTo(u.left,u.top),this.lineTo(u.right,u.top),this.lineTo(u.right,u.bottom),this.lineTo(u.left,u.bottom),this.close()})),n.forEach((function(e){e.getLayoutBox().intersect(u).isEmpty()||d.push(e)})),d.push.apply(d,i),e.select(d,!0)}},selectEnd:function(t){o&&(o=null),s&&(a.fadeOut(200,"ease",0,(function(){a.remove&&a.remove()})),s=!1,e.setStatus("normal"))}}),l=null,u=null,d=!1;return{init:function(){window.addEventListener("mouseup",(function(){c.selectEnd()}))},events:{click:function(e){},mousedown:function(e){var t=e.getTargetNode();d=!!t,t?e.isShortcutKey("Ctrl")?this.toggleSelect(t):t.isSelected()?this.isSingleSelect()||(l=t,u=e.getPosition()):this.select(t,!0):(e.isShortcutKey("Ctrl")||this.removeAllSelectedNodes(),c.selectStart(e),this.setStatus("normal"))},touchstart:function(e){var t=e.getTargetNode();t?t&&!t.isSelected()&&this.select(t,!0):(this.removeAllSelectedNodes(),this.setStatus("normal"))},mousemove:c.selectMove,mouseup:function(e){var t=e.getTargetNode();if(s||d||e.isShortcutKey("Ctrl")||(d=!1),t&&t==l){var n=e.getPosition();kity.Vector.fromPoints(u,n).length()<1&&this.select(l,!0),l=null}c.selectEnd(e)},"normal.keydown":function(e){e.isShortcutKey("ctrl+a")&&(n=r().filter((function(e){return e.visible})),this.select(n,!0),e.preventDefault())},"hand.click":function(e){var t=e.getTargetNode();t?(this.select(t,!0),t.render()):this.removeAllSelectedNodes()}}}}));var kt=["font-size","font-family","font-weight","font-style","background","color","stroke","stroke-dasharray","stroke-width","shape","connect-color","connect-width"],xt=["font-size","font-family","font-weight","font-style","background","color","stroke","stroke-dasharray","stroke-width","shape","radius","connect-color","connect-width"],Ct=["line-color","line-width","line-dasharray"],St=["_colorGroup"];kity.extendClass(y,{resetAllStyle:function(){var e=this;this._style={},St.forEach((function(t){e[t]=null})),this.getAllNode().forEach((function(e){var t=!0,n=!1,r=void 0;try{for(var o,i=xt[Symbol.iterator]();!(t=(o=i.next()).done);t=!0){var a=o.value;delete e.data[a]}}catch(e){n=!0,r=e}finally{try{!t&&i.return&&i.return()}finally{if(n)throw r}}})),this.getAllRelLine().forEach((function(e){var t=!0,n=!1,r=void 0;try{for(var o,i=Ct[Symbol.iterator]();!(t=(o=i.next()).done);t=!0){var a=o.value;delete e.data[a];var s=e.node,c=!0,l=!1,u=void 0;try{for(var d,h=xt[Symbol.iterator]();!(c=(d=h.next()).done);c=!0){var g=d.value;delete s.data[g]}}catch(e){l=!0,u=e}finally{try{!c&&h.return&&h.return()}finally{if(l)throw u}}}}catch(e){n=!0,r=e}finally{try{!t&&i.return&&i.return()}finally{if(n)throw r}}})),this.getAllGeneralize().forEach((function(e){var t=!0,n=!1,r=void 0;try{for(var o,i=Ct[Symbol.iterator]();!(t=(o=i.next()).done);t=!0){var a=o.value;delete e.data[a]}}catch(e){n=!0,r=e}finally{try{!t&&i.return&&i.return()}finally{if(n)throw r}}}))},clearNodeStyle:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this.getRoot().traverse((function(t){var n=!0,r=!1,o=void 0;try{for(var i,a=e[Symbol.iterator]();!(n=(i=a.next()).done);n=!0){var s=i.value;delete t.data[s]}}catch(e){r=!0,o=e}finally{try{!n&&a.return&&a.return()}finally{if(r)throw o}}}))},hasCustomizeStyle:function(){var e=this;return[function(){return St.some((function(t){return!!e[t]}))},function(){return Object.values(ve).some((function(t){return Object.keys(e._style[t]||{}).length>0}))},function(){return e.getAllRelLine().some((function(e){return Ct.some((function(t){if(!p.isEmpty(e.data[t]))return!0;var n=e.node;return xt.some((function(e){if(!p.isEmpty(n.data[e]))return!0}))}))}))},function(){return e.getAllGeneralize().some((function(e){return Ct.some((function(t){if(!p.isEmpty(e.data[t]))return!0}))}))},function(){return e.getAllNode().some((function(e){return xt.some((function(t){if(!p.isEmpty(e.data[t]))return!0}))}))}].some((function(e){return e()}))}}),be.register("StyleModule",(function(){var e=null;return{commands:{copystyle:kity.createClass("CopyStyleCommand",{base:v,execute:function(t){var n=t.getSelectedNode().getData(),r={};return kt.forEach((function(e){e in n?r[e]=n[e]:delete r[e]})),e={node:r,richText:editor.richText.getFormat()}},queryState:function(e){return 1!==e.getSelectedNodes().length?-1:0}}),pastestyle:kity.createClass("PastStyleCommand",{base:v,execute:function(t){t.getSelectedNodes().forEach((function(t){var n=e.node;for(var r in n)n.hasOwnProperty(r)&&t.setData(r,n[r])})),editor.richText.clearFormat();var n=e.richText;return editor.richText.silentEdit((function(e,t,r){for(var o in n)n.hasOwnProperty(o)&&r.formatText(e,t,o,n[o])})),t.renderNodeBatch(t.getSelectedNodes()),t.layout(),e},queryState:function(t){return e&&t.getSelectedNodes().length?0:-1}}),clearstyle:kity.createClass("ClearStyleCommand",{base:v,execute:function(t){return t.getSelectedNodes().forEach((function(e){xt.forEach((function(t){e.setData(t)}))})),t.renderNodeBatch(t.getSelectedNodes()),t.layout(),e},queryState:function(e){return e.getSelectedNodes().length?0:-1}})}}}));var At=K;var Mt=kity.createClass("ForeignObject",{base:kity.Shape,constructor:function(){this.callBase("foreignObject"),this.init()},init:function(){this.node.style.overflow="visible",this.createDom()},createDom:function(){var e=this.dom=document.createElement("div");e.setAttribute("xmlns",e.namespaceURI),e.style.display="inline-block",e.style.lineHeight="1.2",e.style.verticalAlign="top",e.style.whiteSpace="pre",e.style.tabSize="4",e.style.MozTabSize="4",this.setAlign(),this.node.appendChild(e)},setVisible:function(e){this.node.style.visibility=e?null:"hidden"},setX:function(){this.setAttr("x",0)},setY:function(e){this.setAttr("y",e)},setFont:function(e){var t=this.dom;["color","font-family","font-weight","font-style"].forEach((function(n){var r;r="color"===n?e.getFontColor():e.getStyle(n),p.isEmpty(r)?t.style.removeProperty(n):t.style[n]=r}));var n=e.getStyle("font-size");return p.isEmpty(n)?t.style.removeProperty("font-size"):t.style.fontSize=n+"px",this},isWordWrap:function(){return p.checkBridgeApi("isSupportWordWrap")&&window.bridge.isSupportWordWrap()&&p.checkBridgeApi("isWordWrap")&&window.bridge.isWordWrap()},setWordWrap:function(e){this.isWordWrap()?(At=K,e.setWordWrap(!0)):(At=1/0,e.setWordWrap(!1)),e.setWordWrapWidth(At)},setHtml:function(e,t){if(this.isChangeOfContent(e)||t.getSupportChanging()){this.setWordWrap(t),this.setVisible(!1),this.setAttr("width",1e4);var n=this.dom;n.innerHTML=e;var r=Math.min(At,Math.ceil(n.offsetWidth));this.isWordWrap()&&r===At?(this.dom.style.whiteSpace="pre-wrap",this.dom.style["word-break"]="break-word"):(this.dom.style.whiteSpace="pre",this.dom.style["word-break"]="unset"),this.setAttr("width",r),this.setAttr("height",Math.ceil(Math.max(n.offsetHeight,12))),this.width=r,this.height=Math.ceil(Math.max(n.offsetHeight,12)),this.setVisible(!0)}},setAlign:function(e){["left","center","right"].includes(e=e||"left")&&(this.dom.style.textAlign=e)},isChangeOfContent:function(e){var t=!1;return e!==this._currentHtml&&(t=!0,this._currentHtml=e),this.dom.style.cssText!==this._prevStyleCssText&&(t=!0,this._prevStyleCssText=this.dom.style.cssText),t}}),Rt=kity.createClass("TextRenderer",{base:xe,create:function(){var e=(new kity.Group).setId(p.uuid("node_text")),t=new Mt;return e.addItem(t),this.foreign=t,e},update:function(e,t){this.foreign.setFont(t),this.foreign.setHtml(function(e){var t=e.getHtml();if(!t){var n=e.getText()||"";t="<p>"+(n=p.encodeHtml(n)).split("\n").join("</p><p>")+"</p>"}return e.isRelLine&&!e.getText()?"<p>"+window.bridge.trans(V.isMobile?"edit.relLine":"guide.addText")+"</p>":(t.includes("</span&nbsp;style")&&(t="<span>"+e.getText()+"</span>",e.setHtml(t)),t)}(t),t.getMinder());var n=Math.floor(this.foreign.height/2);e.setTranslate(0,-n);var r=new kity.Box(0,-n,this.foreign.width,2*n);return t._currentTextGroupBox=r,r}}),Et=kity.createClass({base:v,execute:function(e,t){var n=e.getSelectedNode();n&&(n.setText(t),n.render(),e.layout())},queryState:function(e){return 1==e.getSelectedNodes().length?0:-1},queryValue:function(e){var t=e.getSelectedNode();return t?t.getText():null}}),Lt=kity.createClass({base:v,execute:function(e,t,n,r){r||(r=e.getSelectedNode()),r&&(r.setContent(t,n),r.render(),e.layout())},queryState:function(e){return 1==e.getSelectedNodes().length?0:-1},queryValue:function(e){var t=e.getSelectedNode();return t?t.getHtml():null}});kity.extendClass(R,{getTextGroup:function(){return this.getRenderer("TextRenderer").getRenderShape()}}),kity.extendClass(y,{isSupportChanging:!1,wordWrapWidth:1/0,setSupportChanging:function(e){this.isSupportChanging=e},getSupportChanging:function(){return this.isSupportChanging},setWordWrap:function(e){this.wordWrap=e},getWordWrap:function(){return this.wordWrap},setWordWrapWidth:function(e){this.wordWrapWidth=e},getWordWrapWidth:function(){return this.wordWrapWidth}}),be.register("text",{commands:{text:Et,content:Lt},renderers:{center:Rt}});var Dt=kity.createClass("ViewDragger",{constructor:function(e){this._minder=e,this._enabled=!1,this._moveEnabled=!0,this._bind();var t=this;this._minder.getViewDragger=function(){return t},this.setEnabled(!1)},isEnabled:function(){return this._enabled},isMoveEnabled:function(){return this._moveEnabled},setMoveEnabled:function(e){this._moveEnabled=e},setEnabled:function(e){this._enabled=e},timeline:function(){return this._moveTimeline},move:function(e,t){var n=new kity.Point(e.x,e.y),r=this.getMovement().offset(n);this.moveTo(r,t)},moveTo:function(e,t){if(e instanceof kity.Point||(e=new kity.Point(e.x,e.y)),t){var n=this;return this._moveTimeline&&this._moveTimeline.stop(e),this._moveTimeline=this._minder.getRenderContainer().animate(new kity.Animator(this.getMovement(),e,(function(e,t){n.moveTo(t)})),t,"easeOutCubic").timeline(),this._moveTimeline.on("finish",(function(){n._moveTimeline=null})),this}this._minder.getRenderContainer().setTranslate(e),this._minder.fire("viewchange")},getMovement:function(){var e=this._minder.getRenderContainer().transform.translate;return e?e[0]:new kity.Point},getView:function(){var e=this._minder,t=e._lastClientSize||{width:e.getRenderTarget().clientWidth,height:e.getRenderTarget().clientHeight},n=this.getMovement(),r=new kity.Box(0,0,t.width,t.height);return e.getPaper().getViewPortMatrix().inverse().translate(-n.x,-n.y).transformBox(r)},moveToCenter:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"landscape",t=document.body.offsetHeight/2,n=document.body.offsetWidth/2,r=minder.getPaper(),o="landscape"===e?Math.min(t,n):Math.max(n,t),i="landscape"===e?Math.max(t,n):Math.min(n,t),a="translate("+o+" "+i+") scale("+minder.getZoomValue()/100+")";r.shapeNode.setAttribute("transform",a),this.moveTo({x:0,y:0})},moveToOptimalView:function(){this._minder.execCommand("camera")},_bind:function(){var e=this,t=!1,n=null,r=null;function o(r){n&&(n=null,r.stopPropagation(),t&&(e.setEnabled(!1),t=!1,"hand"==e._minder.getStatus()&&e._minder.rollbackStatus()),e._minder.fire("viewchanged"))}this._minder.on("normal.mousedown normal.touchstart inputready.mousedown inputready.touchstart readonly.mousedown readonly.touchstart",(function(r){2==r.originEvent.button&&r.originEvent.preventDefault(),(r.getTargetNode()==this.getRoot()||2==r.originEvent.button||r.originEvent.altKey||V.isMobile||e._minder.getOption("enableLeftKeyDrag")&&!r.getTargetNode())&&(n=r.getPosition("screen"),t=!0)})).on("normal.mousemove normal.touchmove readonly.mousemove readonly.touchmove inputready.mousemove inputready.touchmove",(function(e){("touchmove"==e.type&&e.preventDefault(),t)&&(kity.Vector.fromPoints(n,e.getPosition("screen")).length()>10&&this.setStatus("hand",!0))})).on("hand.beforemousedown hand.beforetouchstart",(function(t){p.checkBridgeApi("showLogin")&&window.bridge.showLogin(!0),e.isEnabled()&&(n=t.getPosition("screen"),t.stopPropagation())})).on("hand.beforemousemove hand.beforetouchmove",(function(t){if(n&&e.isMoveEnabled()){r=t.getPosition("screen");var o=kity.Vector.fromPoints(n,r);e.move(o),t.stopPropagation(),t.preventDefault(),t.originEvent.preventDefault(),n=r,t.minder.fire("hidenoterequest"),t.minder.fire("hideiconrequest"),p.checkBridgeApi("showLogin")&&window.bridge.showLogin(!1)}})).on("mouseup touchend",o),window.addEventListener("mouseup",o),this._minder.on("contextmenu",(function(e){V.isMobile||e.preventDefault()}))}});be.register("View",(function(){return{init:function(){this._viewDragger=new Dt(this)},commands:{hand:kity.createClass("ToggleHandCommand",{base:v,execute:function(e){"hand"!=e.getStatus()?e.setStatus("hand",!0):e.rollbackStatus(),this.setContentChanged(!1)},queryState:function(e){return"hand"==e.getStatus()?1:0},enableReadOnly:!0}),camera:kity.createClass("CameraCommand",{base:v,execute:function(e,t,n,r){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;V.isMobile&&(r=p.getOrientation()),t=t||e.getRoot();var i,a,s,c,l=e.getPaper().container;c=l.offsetWidth,s=l.offsetHeight,i=c/2,a=V.isMobile?(s-o)/2:s/2;var u=t.getRenderBox(),d=minder.getZoomValue(),h=100*(i-u.x-u.width/2)/d,g=100*(a-u.y-u.height/2)/d,f=e._viewDragger;n=p.isEmpty(n)?e.getOption("viewAnimationDuration"):n,f.move(new kity.Point(h,g),n),this.setContentChanged(!1)},enableReadOnly:!0}),move:kity.createClass("MoveCommand",{base:v,execute:function(e,t){var n=e._viewDragger,r=e._lastClientSize,o=e.getOption("viewAnimationDuration");switch(t){case"up":n.move(new kity.Point(0,r.height/2),o);break;case"down":n.move(new kity.Point(0,-r.height/2),o);break;case"left":n.move(new kity.Point(r.width/2,0),o);break;case"right":n.move(new kity.Point(-r.width/2,0),o)}},enableReadOnly:!0})},events:{statuschange:function(e){this._viewDragger.setEnabled("hand"==e.currentStatus)},wheel:function(e){var t=0,n=0;if(!(e=e.originEvent).ctrlKey&&!e.shiftKey){var r={0:1,1:30,2:30};e.deltaX&&(t=e.deltaX*r[e.deltaMode]),e.deltaY&&(n=e.deltaY*r[e.deltaMode]),this._viewDragger.move({x:Math.round(-t),y:Math.round(-n)});var o=this;clearTimeout(this._mousewheeltimer),this._mousewheeltimer=setTimeout((function(){o.fire("viewchanged")}),300),e.preventDefault()}},paperrender:function(e){this.getRenderTarget()&&(this._lastClientSize={width:this.getRenderTarget().clientWidth,height:this.getRenderTarget().clientHeight})},resize:function(e){if(!V.isMobile){var t={width:this.getRenderTarget().clientWidth,height:this.getRenderTarget().clientHeight},n=this._lastClientSize;this._viewDragger.move(new kity.Point((t.width-n.width)/2|0,(t.height-n.height)/2|0)),this._lastClientSize=t}},"selectionchange layoutallfinish":function(e){if(!V.isPhone){var t=this,n=this._viewDragger,r=n.timeline();r?r.on("finish",o):o()}function o(){var e=t.getSelectedNode();if(e){var r=n.getView(),o=e.getLayoutBox(),i=0,a=0;o.right>r.right?i+=r.right-o.right-50:o.left<r.left&&(i+=r.left-o.left+50),o.bottom>r.bottom&&(a+=r.bottom-o.bottom-50),o.top<r.top&&(a+=r.top-o.top+50),(i||a)&&n.move(new kity.Point(i,a))}}}}}}));be.register("Zoom",(function(){var e;function t(t,n){n||(n=100);var r=t.getOption("zoomAnimationDuration");if(t.getRoot().getComplex()>200||!r)t.zoom(n),t.fire("viewchange");else{var o=new kity.Animator({beginValue:t._zoomValue,finishValue:n,setter:function(e,t){e.zoom(t)}});t._zoomValue=n,e&&e.pause(),(e=o.start(t,r,"easeInOutSine")).on("finish",(function(){t.fire("viewchange")}))}}kity.extendClass(y,{zoom:function(e){this._zoomValue=e;var t=this.getPaper(),n=t.getViewPort();n.zoom=e/100,n.center={x:n.center.x,y:n.center.y},t.setViewPort(n),100==e&&function(e){var t=e.shapeNode,n=t.getCTM(),r=new kity.Matrix(n.a,n.b,n.c,n.d,.5+(0|n.e),.5+(0|n.f));t.setAttribute("transform","matrix("+r.toString()+")")}(t),V.isEdge&&this.renderTree(),this.fire("zoom",{zoom:e})},getZoomValue:function(){return this._zoomValue}});var n=kity.createClass("Zoom",{base:v,execute:t,queryValue:function(e){return e._zoomValue}}),r=kity.createClass("ZoomInCommand",{base:v,execute:function(e){t(e,this.nextValue(e))},queryState:function(e){return+!this.nextValue(e)},nextValue:function(e){var t=e.getOption("zoom"),n=e._zoomValue+10;return n>t[1]&&(n=t[1]),n},isContentChanged:function(){return!1},enableReadOnly:!0}),o=kity.createClass("ZoomOutCommand",{base:v,execute:function(e){t(e,this.nextValue(e))},queryState:function(e){return+!this.nextValue(e)},nextValue:function(e){var t=e.getOption("zoom"),n=e._zoomValue-10;return n<t[0]&&(n=t[0]),n},isContentChanged:function(){return!1},enableReadOnly:!0}),i=p.throttle((function(e,t){t<0?e.execCommand("zoomin"):e.execCommand("zoomout")}),80);return{init:function(){this._zoomValue=100,this.setDefaultOptions({zoom:[10,200]})},commands:{zoomin:r,zoomout:o,zoom:n},events:{wheel:function(e){if(e.originEvent.ctrlKey||e.originEvent.metaKey){e.originEvent.preventDefault();var t=e.originEvent.deltaY;i(minder,t)}}},commandShortcutKeys:{zoomin:"ctrl+=",zoomout:"ctrl+-",zoom:"ctrl+0"}}}));var Nt=kity.createClass("Generalize",{constructor:function(e,t,n){this.minder=e.getMinder(),this.targetNode=e,this.data=n||{id:"gen-"+p.guid(),range:t},this.initContainers(),this.createLine(),this.createTree(),this.setStatus("normal")},initContainers:function(){this.rc=(new kity.Group).setId(p.uuid("minder_generalize")),this.rc.generalize=this},createLine:function(){this.line=new kity.Path,this.pen=new kity.Pen,this.line.setAttr("stroke-linecap","round"),this.rc.addItem(this.line)},createTree:function(){var e=this.data.tree||(p.checkBridgeApi("trans")?window.bridge.trans("generalize"):"概括"),t=this.minder.createSubtree(e);t.isGeneralize=t._root.isGeneralize=!0,t.generalize=this,this.subtree=t,this.rootNode=t._root,this.rootNode.generalize=this},render:function(){this.subtree.render()},draw:function(){if(!this.targetNode.isCollapsed()){var e,t=this._contentBox,n=t.top,r=t.right,o=t.left,i=t.bottom,a=t.cx,s=t.cy,c={},l={},u={},d={},h={},g={},f={};"right"===this.direction?(e=[1,0,0,1],c={x:r+=10,y:n},l={x:r+6,y:n+6},u={x:r+6,y:s-6},d={x:r+12,y:s},h={x:r+6,y:s+6},g={x:r+6,y:i-6},f={x:r,y:i}):"left"===this.direction?(e=[0,1,1,0],c={x:o-=10,y:n},l={x:o-6,y:n+6},u={x:o-6,y:s-6},d={x:o-12,y:s},h={x:o-6,y:s+6},g={x:o-6,y:i-6},f={x:o,y:i}):"bottom"===this.direction?(e=[0,1,1,0],c={x:o,y:i+=10},l={x:o+6,y:i+6},u={x:a-6,y:i+6},d={x:a,y:i+12},h={x:a+6,y:i+6},g={x:r-6,y:i+6},f={x:r,y:i}):"top"===this.direction&&(e=[1,0,0,1],c={x:o,y:n-=10},l={x:o+6,y:n+6},u={x:a-6,y:n+6},d={x:a,y:n+12},h={x:a+6,y:n+6},g={x:r-6,y:n+6},f={x:r,y:n});var p=this.line.getDrawer();p.clear(),p.moveTo(c.x,c.y),p.carcTo(6,0,e[0],l.x,l.y),p.lineTo(u.x,u.y),p.carcTo(6,0,e[1],d.x,d.y),p.moveTo(d.x,d.y),p.carcTo(6,0,e[2],h.x,h.y),p.lineTo(g.x,g.y),p.carcTo(6,0,e[3],f.x,f.y),this.pen.setColor(this.rootNode.getStyle("line-color")),this.pen.setWidth(this.rootNode.getStyle("line-width")),this.line.stroke(this.pen)}},updatePosition:function(){var e=this.getRange(),t=e[0],n=e[1],r=this.targetNode.getChildren().slice(t,n+1),o=new kity.Box,i=this.data.id;if("mind"===this.targetNode.getLayout()){var a=this.targetNode.getDataRightNumber();t<a&&n>=a&&(n=a-1,this.setRange([t,n]))}r.forEach((function(e){e.traverse((function(e){e.visible&&(o=o.merge(e.getTreeLayoutBox(i)))}),!1)})),this._contentBox=o;var s,c,l=r[0].getLayoutVectorIn();l.x>0?this.direction="right":l.x<0?this.direction="left":l.y>0?this.direction="bottom":this.direction="top";var u=this.rootNode.getContentBox();"right"===this.direction?(s=o.right+12+10+6-u.left,c=o.cy):"left"===this.direction?(s=o.left-12-10-6-u.right,c=o.cy):"bottom"===this.direction?(s=o.cx-u.cx,c=o.bottom+12+10+6-u.top):"top"===this.direction&&(s=o.cx-u.cx,c=o.bottom-12-10-6-u.bottom),this.rootNode.setGlobalLayoutTransform((new kity.Matrix).translate(s,c))},getLayout:function(){if(this.targetNode.isGeneralizeNode())return this.targetNode.getRoot().generalize.getLayout();var e=this.getRange(),t=this.targetNode.getChildren().slice(e[0],e[1]+1)[0].getLayoutVectorIn();return t.x>0?"right":t.x<0?"left":t.y>0?"bottom":"top"},getConnect:function(){return"round-elbow"},getOffsetOnTargetArea:function(e){var t=this.getLayout(),n=this.rootNode.getContentBox(),r={x:e.cx,y:e.cy},o={right:"left",left:"right",top:"bottom",bottom:"top"},i=0;return i=["bottom","right"].includes(t)?e[t]+Math.abs(n[o[t]])+28:e[t]-Math.abs(n[o[t]])-28,["left","right"].includes(t)?r.x=i:r.y=i,r},remove:function(){this.rc.remove(),this.minder.removeSubtree(this.rootNode),this.rootNode=null},hide:function(){this.setVisible(!1)},show:function(){this.setVisible(!0)},setVisible:function(e){this.rootNode.setVisible(e),this.rc.setVisible(e)},setStatus:function(e){if(e)switch(e){case"normal":case"selected":this.status=e}},getStatus:function(){return"selected"===this.status},getData:function(e){return e?this.data[e]:this.data},setData:function(e,t){if("object"==(void 0===e?"undefined":w(e))){var n=e;for(e in n)n.hasOwnProperty(e)&&(this.data[e]=n[e])}else this.data[e]=t;return this},getRange:function(){return this.getData("range")},setRange:function(e){if(p.isArray(e)){var t=this.targetNode.getChildren().length,n=e[0],r=e[1];n<0&&(n=0),r>=t&&(n=t),this.setData("range",[n,r])}}}),Tt=null,It=kity.createClass("AddGeneralizeCommand",{base:v,execute:function(e){var t=e.getSelectedNodes().filter((function(e){return e.parent})),n=R.groupWithParent(t);(n=n.filter((function(e){return!t.includes(e[0].parent)}))).forEach((function(t){t.sort((function(e,t){return e.getIndex()-t.getIndex()}));var n=t[0].parent,r=[t[0].getIndex(),t[t.length-1].getIndex()];n.generalizes&&n.generalizes.some((function(e){return e.getRange().toString()===r.toString()}))||e.createGeneralize(n,r)})),e.refresh()},queryState:function(e){var t=e.getSelectedNodes();return 0===t.length||1===t.length&&t[0].isRoot()?-1:0}}),Ot=kity.createClass("RemoveGeneralizeCommand",{base:v,execute:function(e){Tt&&(e.removeGeneralize(Tt),Tt.cancelSelect())},queryState:function(e){return e.getSelectedGeneralize()?0:-1}});kity.extendClass(Nt,{select:function(){Tt&&Tt.cancelSelect(),this.setStatus("selected"),Tt=this},cancelSelect:function(){this.setStatus("normal"),Tt=null}}),kity.extendClass(y,{createGeneralize:function(e,t,n){if(e.getChild(t[1])){var r=new Nt(e,t,n);this._generalizeContainer.appendShape(r.rc),this._generalizeMap[r.data.id]=r,e.generalizes?e.generalizes.push(r):e.generalizes=[r]}},removeGeneralize:function(e){e.remove(),e.targetNode.generalizes=e.targetNode.generalizes.filter((function(t){return t!==e})),delete this._generalizeMap[e.data.id],delete this._subtreeMap[e.subtree.id]},getSelectedGeneralize:function(){return Tt},clearSelectedGeneralize:function(){Tt&&Tt.cancelSelect()},getAllGeneralize:function(){return Object.values(this._generalizeMap)}}),be.register("GeneralizeModule",(function(){return{init:function(){this._generalizeMap={}},commands:{addGeneralize:It,removeGeneralize:Ot},events:{nodeattach:function(e){var t=e.node.parent,n=this.getSelectedNode();if(n!==t&&n&&t&&t.generalizes&&n.parent===t){var r=n.getIndex();t.generalizes.forEach((function(e){var t=e.getRange(),n=t[0],o=t[1];r<n?(n+=1,o+=1):r>=n&&r<=o&&(o+=1),e.setRange([n,o])}))}},beforenodedetach:function(e){var t=this,n=e.node,r=n.parent;if(r&&r.generalizes){var o=n.getIndex();r.generalizes.forEach((function(e){var n=e.getRange(),r=n[0],i=n[1];o<r?(r-=1,i-=1):o>=r&&o<=i&&(r===i?t.removeGeneralize(e):i-=1),e.setRange([r,i])}))}},noderemove:function(e){var t=this;e.node.traverse((function(e){e.generalizes&&e.generalizes.forEach((function(e){t.removeGeneralize(e)}))}))},selectionchange:function(e){var t=this.getSelectedNodes();this.clearSelectedGeneralize(),t.forEach((function(e){e.isSubtree&&e.isGeneralize&&e.generalize.select()}))},layoutallfinish:function(){Object.values(this._generalizeMap).forEach((function(e){e.draw()}))}},commandShortcutKeys:{addGeneralize:"ctrl+alt+t"}}}));var Pt=kity.createClass("Subtree",{constructor:function(e,t){var n=function(e){var t={root:{data:{id:p.guid(),text:p.checkBridgeApi("trans")&&window.bridge.trans("edit.freeTopic")}},pos:{x:0,y:0}};return e&&p.isObject(e)?p.extend(t,e):t.root.data.text=e,t}(e);this._root=new R(n.root.data),this._root._template||(this._root._template=t.getLastTemplate()),this.minder=this._root.minder=t,this.id=this._root.getData("id"),this._root.isSubtree=!0,this._root.subtree=this,this.pos=new kity.Point(n.pos.x,n.pos.y),t.attachNode(this._root),t.importNode(this._root,n.root),this.setPosition()},setPosition:function(e){p.extend(this.pos,e),this.pos=new kity.Point(Math.round(this.pos.x),Math.round(this.pos.y)),this._root.setGlobalLayoutTransform((new kity.Matrix).translate(this.pos.x,this.pos.y))},move:function(e){this.pos=this.pos.offset(e.x,e.y),this.setPosition()},layout:function(){this.minder.layout(this._root)},getRoot:function(){return this._root},render:function(){this._root.renderTree()}});kity.extendClass(y,{getSubtreeDataById:function(e){var t=null;return e&&this._subtreeData.some((function(n){if(n.id===e)return t=n,!0})),t},createSubtree:function(e){var t=new Pt(e,this);this._subtreeMap[t.id]=t;var n=e.template||minder.getLastTemplate();return t.getRoot()._template=n,t},getAllSubtree:function(){var e=[];return p.each(this._subtreeMap,(function(t){t.isGeneralize||e.push(t)})),e},getAllSubtreeData:function(){var e=this,t=[];return p.each(this.getAllSubtree(),(function(n){if(!n.isGeneralize){var r=n._root,o={id:n.id,root:e.exportNode(r),pos:{x:n.pos.x,y:n.pos.y},template:r._template||this.minder.getTemplate()};t.push(o)}})),t},drawSubtree:function(){var e=this;p.each(this._subtreeData,(function(t){if(t.isGeneralize){var n=e.getNodeById(t.nodeId);if(n){var r=Array(2).fill(n.getIndex()),o={id:t.genId,range:r,tree:t};e.createGeneralize(n.parent,r,o)}}else e.createSubtree(t)}))},removeSubtree:function(e){var t=e.getData("id");this.detachNode(e),delete this._subtreeMap[t],this.fire("noderemove",{node:e})},removeAllSubtree:function(){var e=this;p.each(this.getAllSubtree(),(function(t){e.removeSubtree(t._root)}))}});var zt=kity.createClass("AddSubtreeCommand",{base:v,execute:function(e,t){if(p.checkBridgeApi("nodeLimiter")&&window.bridge.nodeLimiter())window.bridge.openNodeLimitMsg();else{var n=e.createSubtree(t);n.render(),e.layout(n._root)}},queryState:function(e){return 0}}),Gt=kity.createClass("RemoveSubtreeCommand",{base:v,execute:function(e){e.getSelectedNodes().forEach((function(t){t.isRoot()&&t.isSubtree&&e.removeSubtree(t)}))},queryState:function(e){return 0}}),Bt=!1;be.register("Subtree",(function(){return{init:function(){this._subtreeMap={}},commands:{addSubtree:zt,removeSubtree:Gt},commandShortcutKeys:{removeSubtree:"normal::Del|Backspace"},events:{"normal.mousedown":function(e){if(0===e.originEvent.button&&p.checkBridgeApi("isDblClickAddFloatNode")&&(window.bridge.isGuest()||window.bridge.isDblClickAddFloatNode())){if(!this.isNormalStatus()||!["Paper","Path"].includes(e.kityEvent.targetShape.__KityClassName))return;if(Bt){Bt=!1;var t=e.getPosition();minder.execCommand("addSubtree",{pos:t})}Bt=!0,setTimeout((function(){Bt=!1}),250)}}}}}));var _t=!1,Ft=null,Vt=null,jt=null,Ut=null,Qt=kity.createClass("AppendRelLineCommand",{base:v,execute:function(e){if(!Vt&&(Ft=e.getSelectedNode())){var t=Ft.getLayoutBox(),n={x:t.cx,y:t.cy};Vt=(new kity.Group).setId("rel_line_shadow"),e.getTouchContainer().appendShape(Vt);var r=new kity.Path;r.setStyle("pointer-events","none");var o=new kity.Pen;o.setColor(e.getStyle(ve.relLine,"line-color")),o.setWidth(e.getStyle(ve.relLine,"line-width")),o.setDashArray([6,3]),r.stroke(o);var i=r.getDrawer();Vt.addItem(r),e.on("mousemove",a),a(jt),e.once("mousedown",(function t(n){e.off("mousemove",a),e.off("mousedown",t)})),_t=!0}function a(e){var t=e.getPosition(),o=_e.getCtrlPoint(n,t);r.setPathData(""),i.moveTo(n.x,n.y);var a=o[0],s=o[1];i.bezierTo(a.x,a.y,s.x,s.y,t.x,t.y)}},queryState:function(e){var t=e.getSelectedNode();return t&&!t.isRelLine?0:-1}}),Ht=kity.createClass("RemoveRelLineCommand",{base:v,execute:function(e){e.removeSelectedRelLine()},queryState:function(e){return e.getSelectedRelLine()?0:-1}});be.register("RelLineModule",(function(){var e=null,t=null;kity.extendClass(y,{getAllRelLineData:function(){var e=[];for(var t in this._relLineMap)if(this._relLineMap.hasOwnProperty(t)){var n=this._relLineMap[t];e.push({id:n.data.id,startId:n.startNode.getData("id"),endId:n.endNode.getData("id"),ctrl:[n.data.ctrlP1,n.data.ctrlP2],ctrlCur:[n.data.ctrlP1Cur,n.data.ctrlP2Cur],startP:{x:n.data.startP?n.data.startP.x:0,y:n.data.startP?n.data.startP.y:0},endP:{x:n.data.endP?n.data.endP.x:0,y:n.data.endP?n.data.endP.y:0},node:{data:n.node.getData()},"line-color":n.getData("line-color"),"line-width":n.getData("line-width"),"line-dasharray":n.getData("line-dasharray")})}return e},createRelLine:function(e){var t=this.getNodeById(e.startId),n=this.getNodeById(e.endId);if(t&&n&&!this._relLineMap[e.id]){var r=new _e(t,n,e);this._relLineContainer.appendShape(r.rc),this._relLineMap[r.data.id]=r}},updateRelLine:function(){for(var e in this._relLineMap)this._relLineMap.hasOwnProperty(e)&&this._relLineMap[e].render()},removeAllRelLine:function(){for(var e in this._relLineMap)this._relLineMap.hasOwnProperty(e)&&(this._relLineMap[e].remove(),delete this._relLineMap[e])},removeRelLineByNodeId:function(e){for(var t in this._relLineMap)if(this._relLineMap.hasOwnProperty(t)){var n=this._relLineMap[t];n.startNode.getData("id")!==e&&n.endNode.getData("id")!==e||(n.remove(),delete this._relLineMap[t])}},removeSelectedRelLine:function(){this.removeRelLine(t),t=null,this.fire("contentchange")},removeRelLine:function(t){t&&(t.remove(),delete this._relLineMap[t.getData("id")],e&&(e.remove(),e=null),this.fire("rellineremove"))},clearRelLine:function(){for(var e in this._relLineMap)if(this._relLineMap.hasOwnProperty(e)){var t=this._relLineMap[e];this.getNodeById(t.startNode.getData("id"))&&this.getNodeById(t.endNode.getData("id"))||(t.remove(),delete this._relLineMap[e])}},toggleRelLine:function(){for(var e in this._relLineMap)if(this._relLineMap.hasOwnProperty(e)){var t=this._relLineMap[e],n=this.getNodeById(t.startNode.getData("id")),r=this.getNodeById(t.endNode.getData("id"));n&&r&&(n.attached&&r.attached&&n.visible&&r.visible?t.show():t.hide())}},getSelectedRelLine:function(){return t},getAllRelLine:function(){return Object.values(this._relLineMap)}});var n=kity.createClass("RelLineController",{base:kity.Group,constructor:function(e,t){this.callBase(),this.minder=t;var n=e.startP,r=e.endP,o=e.ctrlP1Cur,i=e.ctrlP2Cur;this.data={startP:e.startP,endP:e.endP,ctrlP1:e.ctrlP1Cur,ctrlP2:e.ctrlP2Cur},this.cp1=new kity.Circle(5,o.x,o.y).fill("#ffc000").setStyle("cursor","crosshair").setAttr("name","ctrlP1"),this.cp2=new kity.Circle(5,i.x,i.y).fill("#ffc000").setStyle("cursor","crosshair").setAttr("name","ctrlP2"),this.cl1=new kity.Line(n.x,n.y,o.x,o.y).stroke("#ffc000",2),this.cl2=new kity.Line(r.x,r.y,i.x,i.y).stroke("#ffc000",2),this.addShapes([this.cl1,this.cl2,this.cp1,this.cp2]),this.bindEvent()},bindEvent:function(){var e=this,n="";function r(r){if(e.dragMode){var o=r.getPosition();e.data[n]=o,e.update(),t.setData(n,o),t.render()}}this.on("mousedown",(function(t){t.stopPropagation(),t.preventDefault(),n=t.targetShape.getAttr("name"),e.dragMode=!0,e.minder.on("mousemove",r),e.minder.once("mouseup",(function(t){e.dragMode=!1,e.minder.off("mousemove",r),e.minder.fire("contentchange"),e.minder.fire("focus")}))}))},update:function(){var e=t.data;this.cp1.setCenter(this.data.ctrlP1.x,this.data.ctrlP1.y),this.cl1.setPoint1(e.startP.x,e.startP.y),this.cl1.setPoint2(this.data.ctrlP1.x,this.data.ctrlP1.y),this.cp2.setCenter(this.data.ctrlP2.x,this.data.ctrlP2.y),this.cl2.setPoint1(e.endP.x,e.endP.y),this.cl2.setPoint2(this.data.ctrlP2.x,this.data.ctrlP2.y),this.minder.updateSelectedRect()}});function r(r,o){t=r,V.isMobile||(e=new n(t.data,o),o.getTouchContainer().appendShape(e)),t.setStatus("selected")}function o(e){a(),i.call(this,e)}function i(e){var t;Ut||(t=e.getLayoutBox(),Ut=new kity.Rect(t.width+8,t.height+8,t.x-4,t.y-4).setRadius(4).stroke("rgba(0, 255, 0, .5)",2),this._touchContainer.appendShape(Ut))}function a(){Ut&&(Ut.remove(),Ut=null)}function s(){Vt&&Vt.remove(),Vt=null,Ft=null,_t=!1,a()}return{init:function(){this._relLineMap={}},commands:{appendrelline:Qt,removerelline:Ht},commandShortcutKeys:{appendrelline:"normal::F4",removerelline:"normal::Del|Backspace"},events:{mousedown:function(n){e&&(e.remove(),e=null),t&&(t.setStatus("normal"),t=null);var o=n.getTargetNode();if(o&&Ft&&Ft!==o&&!o.isRelLine){var i=new _e(Ft,o);this._relLineContainer.appendShape(i.rc),this._relLineMap[i.data.id]=i,i.render(),r(i,this),this.fire("contentchange")}s()},mousemove:function(e){if(jt=e,_t){var t=e.getTargetNode();t&&!t.isRelLine&&t!==Ft?o.call(this,t):a()}},layoutallfinish:p.throttle((function(e){this.toggleRelLine(),this.updateRelLine()}),10),"dragtree.mousemove":function(e){this.updateRelLine()},"nodeattach nodedetach":p.debounce((function(e){this.toggleRelLine()}),0),noderemove:function(e){this.clearRelLine()},"normal.mousedown":function(e){var t=e.getTargetNode(),n=e.kityEvent&&e.kityEvent.targetShape,o=null;n&&n.container&&n.container.relLine&&(o=n.container.relLine),t&&t.isRelLine&&(o=t.relLine),o&&r(o,this)},keydown:function(e){_t&&e.isShortcutKey("Esc")&&s()}}}}));be.register("SelectedRectModule",(function(){function e(e){n.call(this),t.call(this,e)}function t(e){var t,n,r,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"click",i=4,a=this,s={},c="#F67D28",l=2;e.forEach((function(e){e.attached&&!e.isRelLine&&(t=e.getData("id"),"hover"===o&&(r=t,t+="_hover",c="#FFA261",l=1),("click"===o&&!a._selectedRectMap[t]||"hover"===o&&!a._selectedRectMap[r]&&!a._hoverRectMap[t])&&(n=e.getLayoutBox(),s[t]=new kity.Rect(n.width+2*i,n.height+2*i,n.x-i,n.y-i).setRadius(4).stroke(c,l),a._selectedRectContainer.appendShape(s[t]),"hover"!==o||V.isMobile?a._selectedRectMap[t]=s[t]:a._hoverRectMap[t]=s[t]))}))}function n(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"click",n=this;if(e){var r;e.forEach((function(e){r=r=e.getData("id"),n._selectedRectMap[r]&&n._selectedRectMap[r].remove(),delete n._selectedRectMap[r]}))}else{var o="click"===t?n._selectedRectMap:n._hoverRectMap;Object.keys(o).forEach((function(e){o[e].remove()})),"click"===t?n._selectedRectMap={}:n._hoverRectMap={}}}return kity.extendClass(y,{updateSelectedRect:function(){var t=this.getSelectedNodes();e.call(this,t)}}),{init:function(){this._selectedRectMap={},this._hoverRectMap={}},events:{"noderemove rellineremove":function(t){var n=this.getSelectedNodes();e.call(this,n)},"normal.mouseup inputready.mouseup":function(e){if(!e.originEvent.button){var r=this.getSelectedNodes();r&&(t.call(this,r),n.call(this,null,"hover"))}},"dragtree.mousemove":function(e){var t=this.getSelectedNodes();t&&n.call(this,t),n.call(this,null,"hover")},layoutallfinish:function(t){var n=this.getSelectedNodes();n.length&&e.call(this,n)},selectionchange:function(t){var n=this.getSelectedNodes();e.call(this,n)},hoverSelected:function(e){t.call(this,[e.node],"hover")},hoverRemove:function(e){n.call(this,null,"hover")}}}})),se.registerProtocol("json",{fileDescription:"KityMinder 格式",fileExtension:".km",dataType:"text",mineType:"application/json",encode:function(e){return JSON.stringify(e)},decode:function(e){return JSON.parse(e)}});var Zt=kity.Browser,Yt=/\r\n|\r|\n/,Wt=function(e){return e.gecko?{REGEXP:new RegExp("^(\t|"+String.fromCharCode(160,160,32,160)+")"),DELETE:new RegExp("^(\t|"+String.fromCharCode(160,160,32,160)+")+")}:e.ie||e.edge?{REGEXP:new RegExp("^("+String.fromCharCode(32)+"|"+String.fromCharCode(160)+")"),DELETE:new RegExp("^("+String.fromCharCode(32)+"|"+String.fromCharCode(160)+")+")}:{REGEXP:/^(\t|\x20{4})/,DELETE:/^(\t|\x20{4})+/}}(Zt);function Jt(e){if(!e)return"";for(var t=[],n=["\\","\\","n"],r=0,o=0,i=e.length;r<i;r++)if(e[r]!==n[o])switch(o){case 0:t.push(e[r]),o=0;break;case 1:"n"===e[r]?t.push("\n"):t.push(e[r-1],e[r]),o=0;break;case 2:t.push(e[r-2]),"\\"!==e[r]&&(o=0,t.push(e[r-1],e[r]))}else 3===++o&&(o=0,t.push("\\n"));return t.join("")}var qt=null;function Kt(e,t){var n="";return n+=function(e,t){for(var n="";t--;)n+=e;return n}("\t",t=t||0),n+=function(e){if(!(qt=editor.quill)){var t=document.createElement("div");document.body.appendChild(t),qt=new window.Quill(t)}var n=e.data.text;return e.data.html&&(qt.clipboard.dangerouslyPasteHTML(e.data.html),n=qt.getText().replace(/\n$/,"")),n}(e)+"\r\n",e.children&&e.children.forEach((function(e){n+=Kt(e,t+1)})),n}function Xt(e){return!/\S/.test(e)}function $t(e){for(var t=0;Wt.REGEXP.test(e);)e=e.replace(Wt.REGEXP,""),t++;return t}function en(e){return{data:{text:Jt(e.replace(Wt.DELETE,""))}}}se.registerProtocol("text",{fileDescription:"大纲文本",fileExtension:".txt",dataType:"text",mineType:"text/plain",encode:function(e){var t=Kt(e.root,0);return e.subtree.forEach((function(e){t+="\r\n"+Kt(e.root,0)})),t},decode:function(e){return function(e){for(var t,n,r,o,i,a,s={},c=e.split(Yt),l=0;l<c.length;l++)if(!Xt(n=c[l])){if(r=$t(n),o=en(n),0===r){if(t)throw new Error("Invalid local format");t=o}else{if(!s[r-1])throw new Error("Invalid local format");i=s[r-1],a=o,(i.children||(i.children=[])).push(a)}s[r]=o}return t}(e)},node2Text:function(e){return Kt(e,0)}});var tn=/\r\n|\r|\n/;function nn(e){return function e(t,n){var r=[],o=function(e){var t="";for(;e--;)t+="#";return t}(n=n||1);r.push(o+" "+t.data.text),r.push("");var i=t.data.note;if(i){var a=/^#/.test(i);a&&(r.push("\x3c!--Note--\x3e"),i=i.replace(/^#+/gm,(function(e){return o+e}))),r.push(i),a&&r.push("\x3c!--/Note--\x3e"),r.push("")}t.children&&t.children.forEach((function(t){r=r.concat(e(t,n+1))}));return r}(e,1).join("\n")}function rn(e,t){var n={data:{text:e,note:""}};return t&&(t.children?t.children.push(n):t.children=[n]),n}function on(e,t){e.data.note+=t+"\n"}function an(e){var t=/^(#+)?\s*(.*)$/.exec(e);return{level:t[1]&&t[1].length||null,content:t[2],noteStart:"\x3c!--Note--\x3e"==e,noteClose:"\x3c!--/Note--\x3e"==e,codeBlock:/^\s*```/.test(e)}}function sn(e){if(/\S/.test(e.data.note)){for(var t=e.data.note.split("\n");t.length&&!/\S/.test(t[0]);)t.shift();for(;t.length&&!/\S/.test(t[t.length-1]);)t.pop();e.data.note=t.join("\n")}else e.data.note=null,delete e.data.note;e.children&&e.children.forEach(sn)}se.registerProtocol("markdown",{fileDescription:"Markdown/GFM 格式",fileExtension:".md",mineType:"text/markdown",dataType:"text",encode:function(e){return nn(e.root)},decode:function(e){return function(e){var t,n,r,o,i,a,s,c={};t=(e=e.replace(/^(.+)\n={3,}/,(function(e,t){return"# "+t}))).split(tn);for(var l=0;l<t.length;l++)(r=an(n=t[l])).noteClose?a=!1:r.noteStart?a=!0:(s=r.codeBlock?!s:s,a||s||!r.level||r.level>o+1?i&&on(i,n):(o=r.level,i=rn(r.content,c[o-1]),c[o]=i));return sn(c[1]),c[1]}(e)}});var cn={landscape:{pdf:[1540,940],default:[1920,920]},portrait:{}};se.registerProtocol("svg",{fileDescription:"SVG 矢量图",fileExtension:".svg",mineType:"image/svg+xml",dataType:"text",encode:function(e,t,n){var r,o,i,a,s=t.getPaper(),c=t.getRenderContainer(),l=c.getRenderBox(),u=l.width,d=l.height,h=s.shapeNode.getAttribute("transform");s.shapeNode.removeAttribute("transform"),c.translate(20-l.x,20-l.y),r=s.container.innerHTML,s.shapeNode.setAttribute("transform",h),c.translate(l.x,l.y),o=document.createElement("div"),document.body.appendChild(o),o.innerHTML=r,(a=o.querySelector("svg")).setAttribute("width",u+40|0),a.setAttribute("height",d+40|0);var g=u+40,f=d+40;a.setAttribute("viewBox",[0,0,0|g,0|f].join(" ")),function(e,t,n){e.querySelectorAll("g[id^=node_expander], g#minder_selectedRect_container, g#minder_touch_container").forEach((function(e){e.remove()})),e.querySelectorAll('#minder_connect_container path[fill="none"][stroke-width="0"]').forEach((function(e){e.remove()})),function(e){e.querySelectorAll('path[stroke-width="0"]').forEach((function(e){e.removeAttribute("stroke")}))}(e),e.querySelectorAll("image[loadfailed]").forEach((function(e){e.remove()}))}(a,l.x,l.y),document.body.removeChild(o);var p="";n.noBackground?p="background: transparent;":(p="background: "+t.getBackground()+";",t.getBackgroundImageName()&&(p.includes("url(")&&(p+="background-image:url("+window.bridge.getBackgroundUrl(t.getBackgroundImageName())+");"),p+="background-repeat: no-repeat;background-size:cover;"));var m=n.type,y=!n||!["pdf","jpg","png"].includes(m);(i=document.createElement("div")).appendChild(a),r=(r=(r=i.innerHTML).replace(/&nbsp;/g,"&#xa0;")).replace(/<br>/g,"<br/>");var b=this.conversion_getDPI(),v=b[0],w=b[1],k=t.getBackgroundImageName();return p.includes("url(")?new Promise((function(e,t){var o=new Image;o.onload=function(){var t=Math.max(u+40|0,o.width),s=Math.max(d+40|0,o.height);if(!n.noBackground){var c=void 0,l=void 0;cn.landscape[m]?(c=cn.landscape[m][0],l=cn.landscape[m][1]):(c=cn.landscape.default[0],l=cn.landscape.default[1]);var h=c/l,g=t,f=s;t/s>h?f=Math.round(t/h):g=Math.round(s*h),function(e,t){return e>32767||t>32767||e*t>268435456}(g,f)||(t=g,s=f)}a.setAttribute("width","100%"),a.setAttribute("height","100%"),p+="height: "+s+"px;",a.setAttribute("viewBox",[0,0,u+40,d+40].join(" ")),y?a.setAttribute("style",p):p+="background-position-y: 100%; background-position-x: center;",r=(r=(r=i.innerHTML).replace(/&nbsp;/g,"&#xa0;")).replace(/<br>/g,"<br/>"),e(y?r:{width:t,height:s,svgXml:r,style:p,deviceXDPI:v,deviceYDPI:w})},o.src=window.bridge.getBackgroundUrl(k)})):new Promise((function(e,t){y?(a.setAttribute("style",p),e(r=(r=(r=i.innerHTML).replace(/&nbsp;/g,"&#xa0;")).replace(/<br>/g,"<br/>"))):e({width:g,height:f,svgXml:r,style:p,deviceXDPI:v,deviceYDPI:w})}))},conversion_getDPI:function(){var e=[];if(window.screen.deviceXDPI)e[0]=window.screen.deviceXDPI,e[1]=window.screen.deviceYDPI;else{var t=document.createElement("DIV");t.style.cssText="width:1in;height:1in;position:absolute;left:0px;top:0px;z-index:99;visibility:hidden",document.body.appendChild(t),e[0]=parseInt(t.offsetWidth),e[1]=parseInt(t.offsetHeight),t.parentNode.removeChild(t)}return e},pxConversionMm:function(e){return 25.4*(e/this.conversion_getDPI()[0])}});var ln=window.URL||window.webkitURL||window;function un(e,t){return new Promise((function(t,n){var r=document.createElement("img");r.onload=function(){t({element:this,x:e.x,y:e.y,width:e.width,height:e.height})},r.onerror=function(e){n(e)},r.crossOrigin="anonymous",r.src=e.url}))}function dn(e,t){var n,r,o,i,a,s,c=e.getPaper(),l=e.getRenderContainer(),u=l.getRenderBox(),d=2*u.width,h=2*u.height;a=d,s=h;var g=function(e,t){var n,r,o=2*e.width,i=2*e.height,a=!1;if(u(o,i)){var s;o=2*e.width,(i=2*e.height)>o?(o=Math.min(32767,o),s=Math.floor(268435456/o),i=Math.min(s,32767)):(i=Math.min(32767,i),s=Math.floor(268435456/i),o=Math.min(s,32767)),o-=160,r=(n=i-=160)/(920/1920),a=!0}else{var c=o,l=i;l/c<920/1920?l=Math.round(c*(920/1920)):c=Math.round(l/(920/1920)),u(c,l)?(c=(l=i)/(920/1920),a=!0):(o=c,i=l),r=c+160,n=l+160}function u(e,t){return e>32767||t>32767||e*t>268435456}return{width:o,height:i,bgAtr:{height:n,width:r,isCrop:a}}}(u);d=g.width,h=g.height;var f,m=g.bgAtr;n=c.shapeNode.getAttribute("transform"),c.shapeNode.setAttribute("transform","translate(0.5, 0.5)"),l.translate(-u.x,-u.y),r=c.container.innerHTML,l.translate(u.x,u.y),c.shapeNode.setAttribute("transform",n),(o=document.createElement("div")).innerHTML=r,(i=o.querySelector("svg")).setAttribute("viewBox","0 0 "+(u.width+1)+" "+(u.height+1)),i.setAttribute("width",d),i.setAttribute("height",h),i.setAttribute("style",'font-family: Arial, "Microsoft Yahei","Heiti SC";'),i.querySelectorAll("g[id^=node_expander], g#minder_selectedRect_container, g#minder_touch_container").forEach((function(e){e.remove()})),(o=document.createElement("div")).appendChild(i);var y=o.getElementsByTagName("image")||[];y=Array.prototype.slice.call(y);for(var b=0;b<y.length;b++)/^http/i.test(y[b].getAttribute("xlink:href"))&&y[b].remove();y=null,r=(r=(r=(r=(r=o.innerHTML).replace(' xmlns="http://www.w3.org/2000/svg" xmlns:NS1="" NS1:ns1:xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:NS2="" NS2:xmlns:ns1=""',"")).replace(/&nbsp;|[\x00-\x09\x0B-\x1F\x7F-\x9F]/g,"")).replace(/NS\d+:title/gi,"xlink:title")).replace(/<br>/g,"<br/>"),f="data:image/svg+xml;charset=utf-8,"+encodeURIComponent(r);var v=[];function w(t){var n=t.data;if(n.image){e.renderNode(t);var r=n.image,o=n.imageSize,i=t.getRenderBox("ImageRenderer",e.getRenderContainer()),a={url:r,width:2*o.width,height:2*o.height,x:2*(-l.getBoundaryBox().x+i.x),y:2*(-l.getBoundaryBox().y+i.y)};v.push(a)}if(!t.isCollapsed())for(var s=t.getChildren(),c=0;c<s.length;c++)w(s[c])}return w(e.getRoot()),p.each(e._subtreeMap,(function(e){w(e.getRoot())})),{width:d,height:h,offsetX:Math.round((d-a)/2),offsetY:Math.round((h-s)/2),dataUrl:f,xml:r,imagesInfo:v,bgAtr:m}}function hn(e,t,n,r){var o=document.createElement("canvas"),i=o.getContext("2d"),a=n.noBackground,s=t.getBackground().toString(),c=a?"":/url\((.+)\)/.exec(s),l=a?"transparent":kity.Color.parse(s),u=dn(t),d=n&&n.width&&n.width>u.width?n.width:u.width,h=n&&n.height&&n.height>u.height?n.height:u.height,g=n&&n.width&&n.width>u.width?(n.width-u.width)/2:0,f=n&&n.height&&n.height>u.height?(n.height-u.height)/2:0,m=u.dataUrl,y=u.imagesInfo,b=d,v=h;o.width=b+160,o.height=v+160;var w=u.bgAtr;return"jpg"===r.name&&(i.fillStyle="#fff",i.fillRect(0,0,o.width,o.height),i.restore()),c?un({url:c[1]}).then((function(e){return i.drawImage(e.element,0,0,w.width,w.height),S()})):(i.save(),i.fillStyle=l.toString(),i.fillRect(0,0,o.width,o.height),i.restore(),S());function k(e,t,n,r,o,i){o&&i?e.drawImage(t,n+80,r+80,o,i):e.drawImage(t,n+80,r+80)}function x(e){return e.toDataURL(r.mineType)}function C(e){var t=e.map((function(e){return t=e,new Promise((function(e,n){var r=document.createElement("img");r.onload=function(){ln.revokeObjectURL(r.src),e({element:r,x:t.x,y:t.y,width:t.width,height:t.height})},r.onerror=function(){ln.revokeObjectURL(r.src),e(null)},r.crossOrigin="anonymous",r.src=t.url+"&time="+Date.now()}));var t}));return Promise.all(t)}function S(){return un({url:m,width:d,height:h}).then((function(e){return k(i,e.element,g,f,e.width,e.height),C(y)})).then((function(e){for(var t=0;t<e.length;t++)e[t]&&k(i,e[t].element,e[t].x+u.offsetX,e[t].y+u.offsetY,e[t].width,e[t].height);return n={url:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAADICAMAAACahl6sAAAAllBMVEVHcEz////////////////////////////////////+/v7////////////////////+/v7////////+/v77+/v////////j4+P09PTi4uLo6Oji4uLt7e3t7e3l5eXn5+fj4+Pn5+fn5+fr6+vk5OTj4+Pk5OTy8vLq6urk5OTi4uLl5eXk5OTk5OTm5ubp6eni4uLi4uJydk5nAAAAMXRSTlMACg8DCBMCAQQGKRsVFwsOHQ0QIyYgGNQ483/xRlSpedFxj07G4acyY6T4nbmyiV7oKkWjtQAAEx5JREFUeNrtnedy6kgWgC/ZlhAIFJAlEUTOWO//cntSBzyeqZ2qXWiq6B/XvrZ/6OP06ZNbf/6813u913u913u913u9179aPWu9OEa322214J/uC7MgRav1wQtoXpUEOBDjU9ZHC6XyohyI0ebFKC9IIhzt9oBWo9F+TRLiAHEMBsNmM2w2h4DyiiSaY9gcd6qi7Iybo8ELkjBHuzEYjjudqq6BpDMevh6J5gBx9IEDSfoWyetxdDoBcdyRdF+FxOLoB3OAWGxfkkRxjIAjRY7JLnpFEs0xNhzRC5L8whHHQrKIiaT9CiS/chCKkPRfQyY2h08cWezN4J8XI7E4AuHwvFldn2OL5AX05Bd5EEddx/d6MnKbRPwrsh+pxVHUdUYkuxchEb/dcOxL5Jgt63qPINUmeQkS2ViDoeLIiyVyeAjixbd1Xd+Sw52euOlACgcoCHNMyceaeQiS7df4n3liSEZgT9x0IAmEFET0Y8Mc3rmu8dt6UyWwzO5qtD8+XBRJr0sba4zxB9hBAph52X5ZkGg28yhKbBLcXB8t90BkZzWFI6Ytpde5wmMrsUhQJKQl7qn6xwcKRDjuQJZwDsfxjUAAh0gi9Lpwb7l5ZDV3+OC3SEDWy2VV1BtQlPJUFJEsJkmaqO5ugfQsm44SKVYIMsNj18tBIB4fWitFgqdBvQgdA6H8LqfiUNUpRi+mQLImEDiwKsIoZiUgbFbCUZ+GToEoDErFYc4kICsCJB58IYHMkOOcg3HPgWpGHIvDaTxsOKQjRhqS++kHacgkcPAuvQzO3nJZz0pQ9v0EBbGey/GLKuLMqaU4gIJScZ2on6Z+qGRCenKKpyVIozwTxo05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",width:200,height:200},p.checkBridgeApi("getEnv")&&window.bridge.getEnv().isAirmoreCom&&(n.url="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAPsAAAD7CAMAAACbrBKUAAAAmVBMVEVHcEz////////////////////////////////////////////////////////////////////9/f3////9/f3////////i4uLj4+P////k5OTn5+fy8vLr6+vz8/Pm5ubr6+vl5eXk5OTm5ubs7Ozm5ubj4+Pi4uLl5eXi4uLj4+Ps7Ozp6enj4+Pk5OTo6Ojj4+Pi4uLi4uJ3TsaTAAAAMnRSTlMABA8QCAIMAQMGGBQWGwkLDR8iEigcJfDSHqV5MEc3cE6os4FAieP4kvPCVFzInmTe6d3do5cAABW6SURBVHja7J3XcuJKEIaPkUgKoAyIIHJRwNpbev+HO51mRnhd672l8VxsutrPownd/fc///33M37Gz/gZP+NnPOsYDl8UuzNejrwPY4S/vBg9ko9GbzhGI6J/LXTgHo/HhI/0L8Q+InLf9wl/9Drwgj7h4Y9fCR7ZEX2wSZLBdDJ5JfhhH6Yd0N9nR6+XJFOc+heBHw5h2n1Ab9vZMc+93uB14Il9Ml3NWoBfR2HuJdNXgaflPhn0jgwfRC8Ez+yJl68NfOglL/LZG/YwEPj4deBxm/enSR4G5dbA5y8CD+xjf9rLo7hMXwzebHXAvkizbWfD0w/vlnt8v1x/nVsD39MPz588LPdi39oB8GEOlxy43ipm55sNfvJzYL6e7qf5IzxMvOpdHj/5CxCf0gxGY254fMdRO/Ey7Um+At56sUhxHOcMj/udzomnvCRudLDavfwAuEVZlgvkl7t9mMPEK2Tn9OSIQrikl4ew0V3LRVkSfnrnNc8rXhu7ydFR9NrzwugK7IwO8GlaE/yRPnpl7PixU6LKn0yTnpdHAR5wK4JfIHvDR12pj31oU3TTAaz1MAriE27zbuLho4cNr9E374LuI3mP0eMtfeMCv1gA+2neKFzvBl3IAb0sU1jw7Ry+esaHz+CDD3hV+7zMOi/07ONwK2Jc4Tjx7fy4QPYFRvIbVRc7qTUadJjzAx3kpxXe55a0uy1TgL/DP9cmd/X897qhKTjSmc7o2VVCl/kK2KsT/fl8oRv9bAXoOqbdXGWo5EgnGxxsVxe3bbOqqpbdQE7Qn3/aO5VWOtTpZGvcLCM8jK39EI6E7quYdltpHVP1CdEDgK5XELqcLHya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",n.width=251,n.height=251),un(n).then((function(e){if(p.checkBridgeApi("isVip")&&!window.bridge.isVip()&&p.checkBridgeApi("getEnv")&&!window.bridge.getEnv().isGitmind)for(var t=3*n.width,r=3*n.height,a=Math.ceil(o.width/t),s=Math.ceil(o.height/r),c=0;c<=a;c++)for(var l=0;l<=s;l++)k(i,e.element,t*c,r*l,n.width,n.height)}));var n})).then((function(){ln.revokeObjectURL(m),document.body.appendChild(o);var e=x(o);return document.body.removeChild(o),e}),(function(e){console.error(e),ln.revokeObjectURL(m),document.body.appendChild(o);var t=x(o);return document.body.removeChild(o),t}))}}se.registerProtocol("jpg",{fileDescription:"JPG 图片",fileExtension:".jpg",mineType:"image/jpeg",dataType:"base64",encode:hn}),se.registerProtocol("png",{fileDescription:"PNG 图片",fileExtension:".png",mineType:"image/png",dataType:"base64",encode:hn}),Ee.register("mind",kity.createClass({base:Ee,doLayout:function(e,t){var n=[],r=[],o=e.getDataRightNumber();t.forEach((function(e){e.getIndex()<o?n.push(e):r.push(e)}));var i=y.getLayoutInstance("left"),a=y.getLayoutInstance("right");i.doLayout(e,r),a.doLayout(e,n);var s=e.getContentBox();e.setVertexOut(new kity.Point(s.cx,s.cy)),e.setLayoutVectorOut(new kity.Vector(0,0))},getOrderHint:function(e){var t=[],n=e.getLayoutBox();return t.push({type:"up",node:e,area:new kity.Box({x:n.x,y:n.top-e.getStyle("margin-top")-5,width:n.width,height:e.getStyle("margin-top")}),path:["M",n.x,n.top-5,"L",n.right,n.top-5]}),t.push({type:"down",node:e,area:new kity.Box({x:n.x,y:n.bottom+5,width:n.width,height:e.getStyle("margin-bottom")}),path:["M",n.x,n.bottom+5,"L",n.right,n.bottom+5]}),t}})),["left","right","top","bottom"].forEach((function(e){var t="left"==e||"right"==e?"x":"y",n="left"==e||"top"==e?-1:1,r={left:"right",right:"left",top:"bottom",bottom:"top",x:"y",y:"x"};Ee.register(e,kity.createClass({base:Ee,doLayout:function(o,i){var a=o.getContentBox();if("x"==t?(o.isRoot()?o.setVertexOut(new kity.Point(a.cx,a.cy)):o.setVertexOut(new kity.Point(a[e],a.cy)),o.setLayoutVectorOut(new kity.Vector(n,0))):(o.setVertexOut(new kity.Point(a.cx,a[e])),o.setLayoutVectorOut(new kity.Vector(0,n))),!i.length)return!1;i.forEach((function(o){var i=o.getContentBox();o.setLayoutTransform(new kity.Matrix),"x"==t?(o.setVertexIn(new kity.Point(i[r[e]],i.cy)),o.setLayoutVectorIn(new kity.Vector(n,0))):(o.setVertexIn(new kity.Point(i.cx,i[r[e]])),o.setLayoutVectorIn(new kity.Vector(0,n)))})),this.align(i,r[e]),this.stack(i,r[t]);var s=this.getBranchBox(i),c=0,l=0;"x"==t?(c=a[e],c+=n*o.getStyle("margin-"+e),c+=n*i[0].getStyle("margin-"+r[e]),l=a.bottom,l-=a.height/2,l-=s.height/2,l-=s.y):(c=a.right,c-=a.width/2,c-=s.width/2,c-=s.x,l=a[e],l+=n*o.getStyle("margin-left"),l+=n*i[0].getStyle("margin-left")),this.move(i,c,l)},getOrderHint:function(e){var n=[],r=e.getLayoutBox();return"x"==t?(n.push({type:"up",node:e,area:new kity.Box({x:r.x,y:r.top-e.getStyle("margin-top")-5,width:r.width,height:e.getStyle("margin-top")}),path:["M",r.x,r.top-5,"L",r.right,r.top-5]}),n.push({type:"down",node:e,area:new kity.Box({x:r.x,y:r.bottom+5,width:r.width,height:e.getStyle("margin-bottom")}),path:["M",r.x,r.bottom+5,"L",r.right,r.bottom+5]})):(n.push({type:"up",node:e,area:new kity.Box({x:r.left-e.getStyle("margin-left")-5,y:r.top,width:e.getStyle("margin-left"),height:r.height}),path:["M",r.left-5,r.top,"L",r.left-5,r.bottom]}),n.push({type:"down",node:e,area:new kity.Box({x:r.right+5,y:r.top,width:e.getStyle("margin-right"),height:r.height}),path:["M",r.right+5,r.top,"L",r.right+5,r.bottom]})),n}}))})),[-1,1].forEach((function(e){var t="filetree-"+(e>0?"down":"up");Ee.register(t,kity.createClass({base:Ee,doLayout:function(t,n){var r=t.getContentBox();if(t.setVertexOut(new kity.Point(r.left+20,e>0?r.bottom:r.top)),t.setLayoutVectorOut(new kity.Vector(0,e)),n.length){n.forEach((function(e){var t=e.getContentBox();e.setLayoutTransform(new kity.Matrix),e.setVertexIn(new kity.Point(t.left,t.cy)),e.setLayoutVectorIn(new kity.Vector(1,0))})),this.align(n,"left"),this.stack(n,"y");var o=0;o+=r.left,o+=20,o+=n[0].getStyle("margin-left");var i=0;e>0?(i+=r.bottom,i+=t.getStyle("margin-bottom"),i+=n[0].getStyle("margin-top")):(i-=this.getTreeBox(n).bottom,i+=r.top,i-=t.getStyle("margin-top"),i-=n[0].getStyle("margin-bottom")),this.move(n,o,i)}},getOrderHint:function(e){var t=[],n=e.getLayoutBox(),r=e.getLevel()>1?3:5;return t.push({type:"up",node:e,area:new kity.Box({x:n.x,y:n.top-e.getStyle("margin-top")-r,width:n.width,height:e.getStyle("margin-top")}),path:["M",n.x,n.top-r,"L",n.right,n.top-r]}),t.push({type:"down",node:e,area:new kity.Box({x:n.x,y:n.bottom+r,width:n.width,height:e.getStyle("margin-bottom")}),path:["M",n.x,n.bottom+r,"L",n.right,n.bottom+r]}),t}}))})),Ee.register("fish-bone-master",kity.createClass("FishBoneMasterLayout",{base:Ee,doLayout:function(e,t){var n=[],r=[],o=t[0],i=e.getContentBox();if(e.setVertexOut(new kity.Point(i.right,i.cy)),e.setLayoutVectorOut(new kity.Vector(1,0)),o){var a=e.getStyle("margin-right"),s=o.getStyle("margin-left"),c=o.getStyle("margin-top"),l=o.getStyle("margin-bottom");t.forEach((function(e,t){e.setLayoutTransform(new kity.Matrix);var o=e.getContentBox();t%2?(r.push(e),e.setVertexIn(new kity.Point(o.left,o.top)),e.setLayoutVectorIn(new kity.Vector(1,1))):(n.push(e),e.setVertexIn(new kity.Point(o.left,o.bottom)),e.setLayoutVectorIn(new kity.Vector(1,-1)))})),this.stack(n,"x"),this.stack(r,"x"),this.align(n,"bottom"),this.align(r,"top");var u=i.right+a+s,d=i.cy-l-e.getStyle("margin-top"),h=i.cy+c+e.getStyle("margin-bottom");this.move(n,u,d),this.move(r,u+s,h)}}})),Ee.register("fish-bone-slave",kity.createClass("FishBoneSlaveLayout",{base:Ee,doLayout:function(e,t,n){var r=this,o=Math.abs,i=e.getContentBox(),a=e.getLayoutVectorIn();e.setLayoutVectorOut(a);var s=i.left+.382*i.width,c=new kity.Point(s,a.y>0?i.bottom:i.top);e.setVertexOut(c);var l=t[0];if(l){var u=l.getContentBox();t.forEach((function(e,t){e.setLayoutTransform(new kity.Matrix),e.setLayoutVectorIn(new kity.Vector(1,0)),e.setVertexIn(new kity.Point(u.left,u.cy))})),this.stack(t,"y"),this.align(t,"left");var d=0,h=0;d+=c.x,e.getLayoutVectorOut().y<0?(h-=this.getTreeBox(t).bottom,h+=e.getContentBox().top,h-=e.getStyle("margin-top"),h-=l.getStyle("margin-bottom")):(h+=e.getContentBox().bottom,h+=e.getStyle("margin-bottom"),h+=l.getStyle("margin-top")),this.move(t,d,h),2==n&&t.forEach((function(e){var t=e.getLayoutTransform(),n=e.getContentBox(),i=t.transformPoint(new kity.Point(n.left,0));r.move([e],o(i.y-c.y),0)}))}}})),Ee.register("tianpan",kity.createClass({base:Ee,doLayout:function(e,t){if(0!=t.length){var n,r,o,i=this,a=e.getContentBox(),s=5,c=Math.max(a.width,50);t.forEach((function(e,t){e.setLayoutTransform(new kity.Matrix),o=i.getTreeBox(e),c=Math.max(Math.max(o.width,o.height),c)})),c=c/1.5/Math.PI,t.forEach((function(e,t){n=c*(Math.cos(s)+Math.sin(s)*s),r=c*(Math.sin(s)-Math.cos(s)*s),s+=.9-.02*t,e.setLayoutVectorIn(new kity.Vector(1,0)),e.setVertexIn(new kity.Point(a.cx,a.cy)),e.setLayoutTransform(new kity.Matrix),i.move([e],n,r)}))}},getOrderHint:function(e){var t=[],n=e.getLayoutBox();return t.push({type:"up",node:e,area:{x:n.x,y:n.top-e.getStyle("margin-top")-5,width:n.width,height:e.getStyle("margin-top")},path:["M",n.x,n.top-5,"L",n.right,n.top-5]}),t.push({type:"down",node:e,area:{x:n.x,y:n.bottom+5,width:n.width,height:e.getStyle("margin-bottom")},path:["M",n.x,n.bottom+5,"L",n.right,n.bottom+5]}),t}}));Ee.register("generalize",kity.createClass({base:Ee,doLayout:function(e){var t=e.generalizes;t&&t.forEach((function(e){}))}}));[{name:"classic",options:{map:{background:"#3A4144"},root:{color:"#430",background:"#e9df98","font-size":24,padding:[15,25],margin:[30,40],shape:"annulus"},main:{color:"#333",background:"#a4c5c0","font-size":16,padding:[10,20],margin:[20,20],stroke:"#a4c5c0","connect-width":3,"connect-color":"white"},sub:{color:"white",background:"transparent","font-size":14,padding:[5,10],margin:[15,20],"connect-color":"white","connect-width":2},relLine:{color:"#fff"}}},{name:"classic-2",options:{map:{background:"rgb(241, 236, 230)"},root:{color:"#fff",background:"rgb(97, 121, 159)",branch:"arc","stroke-width":2,startPos:!0,shape:"annulus"},main:{color:"rgb(97, 121, 159)",background:"#fff",branch:"bezier","stroke-width":2,"connect-color":"#fff",shape:"circle","font-weight":"bold"},sub:{color:"rgb(97, 121, 159)",branch:"bezier","stroke-width":2,"connect-color":"#fff","font-weight":"bold"},relLine:{"line-color":"rgb(56, 123, 233)",color:"rgb(97, 121, 159)"},generalize:{"line-color":"rgb(56, 123, 233)",background:"rgb(56, 123, 233)",color:"#fff"}}},{name:"classic-3",options:{map:{background:"rgb(239, 250, 239)"},root:{color:"#fff",background:"rgb(30, 53, 86)",branch:"dotted","stroke-width":2,shape:"hexagon"},main:{color:"#fff",background:"rgb(169, 218, 218)","stroke-width":2,"connect-color":"rgb(30, 53, 86)",branch:"dotted",shape:"hexagon","font-weight":"bold"},sub:{color:"rgb(30, 53, 86)","stroke-width":2,branch:"dotted","connect-color":"rgb(30, 53, 86)"},relLine:{"line-color":"rgb(56, 123, 233)",color:"rgb(30, 53, 86)"},generalize:{"line-color":"rgb(56, 123, 233)",background:"rgb(56, 123, 233)",color:"#fff"}}}].forEach((function(e){De.register(e.name,e.options)}));function gn(e,t,n){return kity.Color.createHSL(e,t,n)}[{name:"colorful-1",options:{map:{background:"#E7E4DC","background-image":"study5"},root:{color:"#333",background:"#FFCB48",shape:"rect-arc",branch:"stitch","branch-multicolor":"multiColor14",padding:[12,20]},main:{color:"#333",background:"#fff",shape:"rect-arc",branch:"slingshot","connect-color":"#fff",stroke:"#fff","stroke-width":2,padding:[10,15]},sub:{color:"#333",branch:"slingshot","connect-color":"#fff"},relLine:{"line-color":"#FF930F",color:"#333"},generalize:{"line-color":"#FF930F",background:"#FF930F",color:"#fff",shape:"ellipse"}}},{name:"colorful-2",options:{map:{background:"rgb(239, 250, 239)","background-image":"study6"},root:{color:"#333",background:"#fff","stroke-width":2,shape:"rect-arc","branch-multicolor":"multiColor13",branch:"straight"},main:{color:"#fff","background-multicolor":"multiColor13","stroke-width":2,"connect-color":"rgb(30, 53, 86)",branch:"round-elbow","font-weight":"bold"},sub:{color:"rgb(30, 53, 86)","connect-color":"rgb(30, 53, 86)",branch:"round-elbow","font-weight":"bold"},relLine:{"line-color":"rgb(241, 163, 58)",color:"#333"},generalize:{"line-color":"rgb(241, 163, 58)",background:"rgb(241, 163, 58)",color:"#333"}}},{name:"colorful-3",options:{map:{background:"rgb(239, 250, 239)","background-image":"art1"},root:{color:"#333","branch-tapared":!0,branch:"arc",stroke:"rgb(133, 143, 165)","stroke-width":2,"branch-multicolor":"multi",background:"#fff"},main:{color:"#333",branch:"round-elbow","stroke-width":2},sub:{color:"#333",branch:"round-elbow"},relLine:{"line-color":"rgb(72, 155, 123)",color:"#333"},generalize:{"line-color":"rgb(72, 155, 123)",background:"rgb(72, 155, 123)",color:"#fff"}}},{name:"colorful-4",options:{map:{background:"rgb(239, 250, 239)","background-image":"grain3"},root:{color:"#fff","branch-tapared":!0,branch:"arc",background:"rgb(128, 204, 111)",shape:"annulus"},main:{color:"#333",background:"rgb(187, 235, 175)",branch:"round-elbow","connect-color":"rgb(128, 204, 111)",shape:"annulus"},sub:{color:"#333","connect-color":"rgb(128, 204, 111)"},relLine:{"line-color":"rgb(243, 133, 98)",color:"#333"},generalize:{"line-color":"rgb(243, 133, 98)",background:"rgb(243, 133, 98)",color:"#fff"}}},{name:"colorful-5",options:{map:{background:"rgb(239, 250, 239)","background-image":"gradient4"},root:{color:"#333",branch:"arc",stroke:"rgb(118, 168, 128)","stroke-width":2,background:"#fff","branch-multicolor":"multiColor8"},main:{color:"#333","connect-color":"rgb(128, 204, 111)",stroke:"rgb(57, 143, 141)","stroke-width":2,branch:"bezier"},sub:{color:"#333","connect-color":"rgb(128, 204, 111)",branch:"bezier"},relLine:{"line-color":"rgb(255, 198, 16)",color:"#333"},generalize:{"line-color":"rgb(255, 198, 16)",background:"rgb(255, 198, 16)",color:"#333"}}},{name:"colorful-6",options:{map:{background:"rgb(239, 250, 239)","background-image":"gradient2"},root:{color:"#fff",background:"rgb(8, 116, 176)",startPos:!0},main:{color:"#fff","connect-color":"rgb(220, 220, 220)",branch:"round-elbow","background-multicolor":"multiColor9"},sub:{branch:"round-elbow","color-multicolor":"multiColor9"},relLine:{"line-color":"rgb(8, 116, 176)",color:"#333"},generalize:{"line-color":"rgb(8, 116, 176)",background:"rgb(8, 116, 176)",color:"#fff"}}}].forEach((function(e){De.register(e.name,e.options)})),De.register("snow",{map:{background:"#3A4144"},root:{color:"#430",background:"#e9df98",stroke:"#e9df98","font-size":24,padding:[15,25],margin:[30,30],"connect-color":"white","connect-width":2},main:{color:"#333",background:"#a4c5c0",stroke:"#a4c5c0","font-size":16,padding:[6,20],margin:[20,40],"connect-color":"white","connect-width":3},sub:{color:"black",background:"white",stroke:"white","font-size":14,padding:[5,10],margin:[10,20],"connect-color":"white","connect-width":2}});var fn,pn,mn={red:0,soil:25,green:122,blue:212,purple:246,pink:334};for(fn in mn)De.register("fresh-"+fn,{map:{background:"#fbfbfb"},root:{color:"white",background:gn(pn=mn[fn],37,60).toRGB(),stroke:"transparent","font-size":16,padding:[12,24],margin:[30,50],"connect-color":gn(pn,37,60).toRGB(),"connect-width":2},main:{color:"black",background:gn(pn,33,95).toRGB(),stroke:gn(pn,37,60).toRGB(),"stroke-width":1,"font-size":14,padding:[6,20],margin:[20,20],"connect-color":gn(pn,37,60).toRGB(),"connect-width":2},sub:{color:"black",background:"transparent",stroke:"transparent","font-size":14,padding:[5,10],margin:[15,20],"connect-color":gn(pn,37,60).toRGB(),"connect-width":2}});De.register("fish",{map:{background:"#3A4144"},root:{color:"#430",background:"#e9df98",stroke:"#e9df98","font-size":24,padding:[35,35],margin:[30,30],shape:"annulus","connect-color":"white","connect-width":3},main:{color:"#333",background:"#a4c5c0",stroke:"#a4c5c0","font-size":16,padding:[6,20],margin:[10,20],"connect-color":"white","connect-width":3},sub:{color:"black",background:"white",stroke:"white","font-size":14,padding:[5,10],margin:[10,10],"connect-color":"white","connect-width":3}});[{name:"word-1",options:{root:{background:"#fff",color:"#02215e","connect-color":"#41599E"},main:{"connect-color":"#41599E"},sub:{"connect-color":"#41599E"}}},{name:"ice-1",options:{root:{background:"rgb(66, 133, 246)",padding:[15,30],"connect-color":"#dbdbdb"},main:{padding:[5,10],"connect-color":"#dbdbdb"},sub:{"connect-color":"#dbdbdb"}}},{name:"ice-2",options:{map:{background:"#f2fae9"},root:{background:"rgb(128, 211, 53)",padding:[15,30],shape:"annulus","connect-color":"rgb(180, 228, 164)"},main:{padding:[5,10],shape:"annulus","connect-color":"rgb(180, 228, 164)"},sub:{shape:"annulus","connect-color":"rgb(180, 228, 164)"}}},{name:"ice-3",options:{root:{background:"rgb(243, 165, 53)",padding:[15,30],"connect-color":"#dbdbdb"},main:{color:"#fff",background:"rgb(243, 165, 53)",padding:[5,10],"connect-color":"#dbdbdb"},sub:{"connect-color":"#dbdbdb"}}},{name:"ice-4",options:{root:{background:"rgb(228, 95, 55)",padding:[15,30],"connect-color":"#dfcfb6"},main:{color:"#fff",background:"rgb(228, 95, 55)",padding:[5,10],"connect-color":"#dfcfb6"},sub:{color:"rgb(228, 95, 55)",stroke:"rgb(228, 95, 55)","stroke-width":1,shape:"annulus","connect-color":"#dfcfb6"}}},{name:"ice-5",options:{map:{background:"rgb(248, 245, 251)"},root:{background:"rgb(165, 76, 241)",padding:[15,30],shape:"annulus","connect-color":"rgb(195, 171, 215)"},main:{color:"#fff",background:"rgb(165, 76, 241)",stroke:"rgb(165, 76, 241)",padding:[5,10],shape:"annulus","connect-color":"rgb(195, 171, 215)"},sub:{shape:"annulus","connect-color":"rgb(195, 171, 215)"}}},{name:"ice-6",options:{map:{background:"rgb(247, 246, 245)"},root:{background:"rgb(138, 86, 46)",padding:[15,30],shape:"annulus","connect-color":"rgb(190, 179, 171)"},main:{color:"#fff",background:"rgb(138, 86, 46)",stroke:"rgb(138, 86, 46)",padding:[5,10],shape:"annulus","connect-color":"rgb(190, 179, 171)"},sub:{shape:"annulus","connect-color":"rgb(190, 179, 171)"}}},{name:"dark",options:{map:{background:"rgb(26, 35, 43)"},root:{background:"rgb(26, 35, 43)",stroke:"#fff","connect-color":"white",color:"#fff","stroke-width":2,branch:"arc",startPos:!0},main:{background:"rgb(26, 35, 43)",stroke:"#fff",padding:[15,30],"connect-color":"white",color:"#fff","stroke-width":2,branch:"bezier"},sub:{color:"white","connect-color":"white",margin:[10,16]},relLine:{"line-color":"rgb(255, 216, 53)",color:"#fff"},generalize:{"line-color":"rgb(255, 216, 53)",background:"rgb(255, 216, 53)",color:"rgb(26, 35, 43)"}}},{name:"sky",options:{map:{background:"#e6eef2"},root:{background:"#1cabfc"},main:{stroke:"#ccc"}}},{name:"sky-1",options:{map:{background:"#fbe4ec"},root:{background:"#3352fa","connect-color":"#fff"},main:{"connect-color":"#fff"},sub:{"connect-color":"#fff"}}},{name:"sky-2",options:{map:{background:"#E9F2F9","background-image":"sky2"},root:{background:"rgb(0, 152, 91)","font-weight":"bold",shape:"annulus","connect-color":"rgb(134, 138, 132)",color:"#fff",startPos:!0},main:{background:"rgb(229, 229, 229)",shape:"annulus",color:"rgb(51, 51, 51)","stroke-width":1,stroke:"#fff","connect-color":"rgb(134, 138, 132)",branch:"bezier"},sub:{color:"#02215e","connect-color":"rgb(134, 138, 132)",margin:[10,16]},relLine:{"line-color":"rgb(243, 179, 48)",color:"rgb(51, 51, 51)"},generalize:{"line-color":"rgb(243, 179, 48)",background:"rgb(243, 179, 48)",color:"rgb(51, 51, 51)"}}},{name:"sky-3",options:{map:{background:"#E9F2F9","background-image":"sky3"},root:{background:"#fff","font-weight":"bold",shape:"annulus","connect-color":"rgb(107, 189, 232)",color:"#333",startPos:!0},main:{background:"#fff",shape:"annulus",color:"#02215e","stroke-width":1,stroke:"#fff","connect-color":"rgb(107, 189, 232)",branch:"bezier"},sub:{color:"#02215e","connect-color":"rgb(107, 189, 232)",margin:[10,16]},relLine:{"line-color":"rgb(255, 180, 46)"},generalize:{"line-color":"rgb(255, 180, 46)",background:"rgb(255, 180, 46)",color:"#fff"}}},{name:"sky-4",options:{root:{background:"#35455b","font-size":26,"connect-color":"#35455b","connect-width":4},main:{color:"#333333",background:"#84a1c9","font-size":20,shape:"annulus","connect-color":"#35455b","connect-width":4},sub:{color:"#000",background:"#e2e9f1",shape:"annulus","connect-color":"#35455b","connect-width":4}}},{name:"sky-5",options:{map:{background:"#ecf5e7"},root:{color:"#ff9f00",background:"#fff","font-size":28,"font-weight":"bold","connect-color":"#fff","connect-width":4},main:{color:"#ff9f00",stroke:"#ccc","stroke-width":1,"font-size":20,"connect-width":4,"connect-color":"#fff"},sub:{"connect-color":"#fff","connect-width":4}}},{name:"sky-6",options:{map:{background:"#f7fdd5"},root:{color:"#1a8d6b",background:"#dff774","font-size":26,"font-weight":"bold","connect-color":"#1a8d6b","connect-width":2},main:{"connect-color":"#1a8d6b","connect-width":2},sub:{"connect-color":"#1a8d6b","connect-width":2}}},{name:"sky-7",options:{map:{background:"#fff8e1"},root:{background:"#ff6f01","connect-color":"#0d5302"},main:{background:"#ffe082",stroke:"#ccc","stroke-width":1,"connect-color":"#0d5302"},sub:{"connect-color":"#0d5302"}}},{name:"sky-8",options:{map:{background:"#fde2e2"},root:{background:"#febeaf","connect-color":"#60752e"},main:{stroke:"#60752e","stroke-width":1,"connect-color":"#60752e"},sub:{"connect-color":"#60752e"}}},{name:"sky-9",options:{map:{background:"#daebd0"},root:{background:"#1a8d6b","font-size":26,"font-weight":"bold","connect-color":"#1a8d6b"},main:{"connect-color":"#1a8d6b"},sub:{"connect-color":"#1a8d6b"}}},{name:"sky-10",options:{map:{background:"#e4daee","background-image":"sky10"},root:{background:"#4e317d","font-size":26,"font-weight":"bold","connect-color":"#4e317d",startPos:!0},main:{color:"#fff",background:"rgb(152, 136, 216)","connect-color":"#4e317d",branch:"bezier"},sub:{color:"#4e317d","connect-color":"#4e317d",margin:[10,16]},relLine:{color:"#4e317d","line-color":"rgb(255, 131, 102)"},generalize:{"line-color":"rgb(255, 131, 102)",background:"rgb(255, 131, 102)",color:"rgb(152, 136, 216)"}}},{name:"sky-11",options:{map:{background:"#ffe4ec"},root:{background:"#ff90aa","font-weight":"bold","connect-color":"#ff90aa"},main:{color:"#4a148c",background:"#d5dce7","font-weight":"bold","connect-color":"#ff90aa"},sub:{"connect-color":"#ff90aa"}}},{name:"sky-12",options:{map:{background:"#c7e5e6"},root:{color:"#333",background:"#fff8e1","connect-color":"#fff"},main:{"connect-color":"#fff"},sub:{"connect-color":"#fff"}}},{name:"sky-13",options:{map:{background:"#edddeb"},root:{color:"#333",background:"#badbee","connect-color":"#dfcfb6"},main:{color:"#4a148c",background:"#badbee","connect-color":"#dfcfb6"},sub:{"connect-color":"#dfcfb6"}}},{name:"sky-14",options:{map:{background:"#c6d4e2"},root:{background:"#7f84c3","connect-color":"#dbdbdb"},main:{color:"#fff",background:"#7f84c3","connect-color":"#dbdbdb"},sub:{"connect-color":"#dbdbdb"}}},{name:"sky-15",options:{map:{background:"#acc7c9"},root:{color:"#333",background:"#d5d9dd","connect-color":"#fff"},main:{background:"#d5d9dd","connect-color":"#fff"},sub:{"connect-color":"#fff"}}},{name:"sky-16",options:{map:{background:"#509CAA"},root:{color:"#04225C",background:"#fff","font-weight":"bold","connect-color":"#fff","connect-width":3},main:{color:"#04225C",background:"#FBE3BC","connect-color":"#fff","connect-width":3},sub:{color:"#04225C","connect-color":"#fff","connect-width":3}}},{name:"sky-17",options:{map:{background:"#F5FAFE"},root:{background:"#5A7397"},main:{background:"#96D3E4"},sub:{"connect-color":"#89929B","connect-width":3}}},{name:"sky-18",options:{map:{background:"#e6eef2","background-image":"sky18"},root:{color:"#fff",background:"rgb(66, 88, 159)","font-weight":"bold",shape:"annulus","connect-color":"rgb(66, 88, 159)",startPos:!0},main:{color:"rgb(66, 88, 159)","font-weight":"bold","stroke-width":2,stroke:"rgb(66, 88, 159)","connect-color":"rgb(66, 88, 159)",branch:"bezier"},sub:{color:"rgb(66, 88, 159)","connect-color":"rgb(66, 88, 159)",margin:[10,16]},relLine:{color:"rgb(66, 88, 159)","line-color":"rgb(246, 138, 76)"},generalize:{"line-color":"rgb(246, 138, 76)",background:"rgb(246, 138, 76)",color:"rgb(66, 88, 159)"}}},{name:"sky-19",options:{root:{background:"#41599E",shape:"annulus","connect-color":"#41599E"},main:{background:"#fff",color:"#02215e",stroke:"#41599E","stroke-width":1,"connect-color":"#41599E"},sub:{color:"#02215e","connect-color":"#41599E"}}},{name:"simple-1",options:{root:{background:"#49B938","connect-color":"#8793A4"},main:{color:"#fff",background:"#8793A4",shape:"annulus","connect-color":"#8793A4"},sub:{"connect-color":"#8793A4"}}},{name:"simple-2",options:{map:{background:"#F4F9FA"},root:{background:"#41C0C1","connect-color":"#CEE7EB"},main:{color:"#41C0C1",background:"transparent",stroke:"#999999","stroke-width":2,"stroke-dasharray":"3,3","connect-color":"#CEE7EB"},sub:{"connect-color":"#CEE7EB"}}},{name:"simple-3",options:{map:{background:"#F1ECE6"},root:{background:"#61789F","font-weight":"bold","connect-color":"#fff","connect-width":4},main:{color:"#61789F",background:"#fff","stroke-width":1,stroke:"#CCCCCC",shape:"annulus","connect-color":"#fff","connect-width":4},sub:{color:"#61789F","connect-color":"#fff","connect-width":4}}},{name:"simple-4",options:{map:{background:"#545753"},root:{background:"#6AA47D","font-weight":"bold",startPos:!0},main:{color:"#fff",background:"transparent",stroke:"#A4A8A3","stroke-width":2,"connect-color":"#A4A8A3",branch:"bezier"},sub:{color:"#fff","connect-color":"#A4A8A3",margin:[10,16]},relLine:{color:"#fff","line-color":"rgb(244, 220, 118)"},generalize:{"line-color":"rgb(244, 220, 118)",background:"rgb(244, 220, 118)",color:"#545753"}}},{name:"fresh-1",options:{map:{background:"#FAF4F6","background-image":"fresh1"},root:{background:"#F3AEAC",startPos:!0},main:{background:"#F3CBC7","connect-color":"#F3AEAC","connect-width":2,branch:"bezier",color:"rgb(66, 88, 159)"},sub:{shape:"rect","connect-color":"#F3AEAC","connect-width":2,color:"rgb(66, 88, 159)",margin:[10,16]},relLine:{color:"#F3CBC7","line-color":"rgb(66, 88, 159)"},generalize:{"line-color":"rgb(66, 88, 159)",background:"rgb(66, 88, 159)",color:"#F3CBC7"}}},{name:"fresh-2",options:{map:{background:"#F1FAEE"},root:{background:"#1E3556","font-family":"楷体,楷体_GB2312,SimKai,STKaiti","font-size":26},main:{color:"#fff",background:"#A9DADC","font-family":"楷体,楷体_GB2312,SimKai,STKaiti","font-size":20,"font-weight":"bold","connect-color":"#1E3556","connect-width":2},sub:{"font-family":"楷体,楷体_GB2312,SimKai,STKaiti","font-size":20,"connect-color":"#1E3556","connect-width":2}}},{name:"default-1",options:{map:{background:"#FFF1E6"},root:{background:"#ffbb91","font-size":26,"connect-color":"#ff8e6e","connect-width":2,shape:"annulus"},main:{stroke:"#ffbb91","stroke-width":2,"font-size":16,radius:10,"font-weight":"bold","connect-color":"#ff8e6e"},sub:{"connect-color":"#ff8e6e"}}}].forEach((function(e){De.register(e.name,e.options)}));[{name:"spy-1",options:{map:{background:"#2E2933"},root:{color:"#fff",background:"#241B37",stroke:"#fff","stroke-width":2,"branch-tapared":!0,branch:"arc"},main:{color:"#fff",background:"#241B37",stroke:"#C07093","stroke-width":2,branch:"round-elbow","connect-color":"#C07093"},sub:{color:"#fff",branch:"round-elbow","connect-color":"#C07093",margin:[10,16]},relLine:{"line-color":"#EB5F58",color:"#fff"},generalize:{"line-color":"#4BA5ED",background:"#4BA5ED"}}},{name:"spy-2",options:{map:{background:"#2E2933"},root:{color:"#333",background:"#D8F693",shape:"annulus",branch:"under"},main:{color:"#fff",background:"transparent",branch:"under","connect-color":"#64C7B8"},sub:{color:"#fff",branch:"under","connect-color":"#64C7B8",margin:[13,16]},relLine:{"line-color":"#fff",color:"#fff"},generalize:{"line-color":"#fff",background:"#fff",color:"#333"}}},{name:"spy-3",options:{map:{"background-image":"study3"},root:{color:"#fff",background:"#F4A067",shape:"annulus","branch-tapared":!0,branch:"arc"},main:{color:"#333",background:"#fff",stroke:"#F4A067","stroke-width":2,branch:"bezier","connect-color":"#F4A067"},sub:{color:"#333",branch:"bezier","connect-color":"#F4A067",margin:[10,16]},relLine:{"line-color":"#5F76FF",color:"#333"},generalize:{"line-color":"#5F76FF",background:"#5F76FF"}}},{name:"spy-4",options:{root:{color:"#333",background:"#F5C244","branch-tapared":!0,branch:"arc"},main:{color:"#fff",background:"#5DBADC",branch:"round-elbow","connect-color":"#4D97D2"},sub:{color:"#333",branch:"round-elbow","connect-color":"#5DBADC",margin:[10,16]},relLine:{"line-color":"#5DBADC",color:"#333"},generalize:{"line-color":"#5DBADC",background:"#4351AE"}}},{name:"spy-5",options:{map:{background:"#61B3C6"},root:{color:"#333",background:"#FFFEFE",shape:"hexagon",branch:"dotted"},main:{color:"#333",background:"#FAE6C2",shape:"hexagon",branch:"dotted","connect-color":"#fff"},sub:{color:"#fff",branch:"dotted","connect-color":"#fff",margin:[10,20]},relLine:{"line-color":"#fff",color:"#333"},generalize:{"line-color":"#fff",background:"#fff",color:"#333"}}},{name:"spy-6",options:{map:{background:"#F4D9DF"},root:{color:"#fff",background:"#4C8ADA",branch:"bracket",margin:[20,20]},main:{color:"#333",background:"#fff",branch:"bracket","connect-color":"#fff",margin:[20,10]},sub:{color:"#333",branch:"bracket","connect-color":"#fff",stroke:"#fff","stroke-width":2,margin:[13,16]},relLine:{"line-color":"#4C8ADA",color:"#333"},generalize:{"line-color":"#4C8ADA",background:"#4C8ADA",color:"#fff"}}},{name:"spy-7",options:{map:{background:"#E7E4DC","background-image":"grain2"},root:{color:"#333",background:"#FFCB48",shape:"rect-arc",branch:"stitch","branch-multicolor":"multi",padding:[12,20]},main:{color:"#333",background:"#fff",shape:"rect-arc",branch:"slingshot","connect-color":"#fff",stroke:"#fff","stroke-width":2,padding:[10,15]},sub:{color:"#333",branch:"slingshot","connect-color":"#fff",margin:[10,20]},relLine:{"line-color":"#FF930F",color:"#333"},generalize:{"line-color":"#FF930F",background:"#FF930F",color:"#fff",shape:"ellipse"}}},{name:"spy-8",options:{map:{background:"#FFF2EB"},root:{color:"#fff",background:"#ED7786",shape:"annulus","branch-tapared":!0,branch:"arc"},main:{color:"#fff",background:"#ED7786",branch:"bezier","connect-color":"#7F56B0"},sub:{color:"#333",branch:"bezier","connect-color":"#7F56B0",margin:[10,16]},relLine:{"line-color":"#7F56B0",color:"#333"},generalize:{"line-color":"#7F56B0",background:"#7F56B0"}}},{name:"spy-9",options:{map:{background:"#F8F8F8","background-image":"study5"},root:{color:"#333",background:"#F4F4F4",branch:"arc","branch-multicolor":"multi",stroke:"#CE79E0","stroke-width":2},main:{color:"#333",background:"#F4F4F4",branch:"bezier","stroke-width":2},sub:{color:"#333",branch:"bezier","stroke-width":2,margin:[10,16]},relLine:{"line-color":"#8D98FF",color:"#333"},generalize:{"line-color":"#8D98FF",background:"#8D98FF"}}},{name:"spy-10",options:{map:{background:"#E9EFFD","background-image":"business2"},root:{color:"#fff",background:"#46589A",branch:"bracket"},main:{color:"#333",background:"transparent",branch:"bracket","connect-color":"#46589A"},sub:{color:"#333",branch:"bracket","connect-color":"#46589A",margin:[10,16]},relLine:{"line-color":"#F1A33A",color:"#333"},generalize:{"line-color":"#F1A33A",background:"#F1A33A"}}},{name:"fresh-2",options:{map:{background:"#F1FAEE","background-image":"paper2"},root:{background:"#1E3556","font-family":"楷体,楷体_GB2312,SimKai,STKaiti","font-size":26,"branch-tapared":!0},main:{color:"#fff",background:"#A9DADC","font-family":"楷体,楷体_GB2312,SimKai,STKaiti","font-size":20,"font-weight":"bold","connect-color":"#1E3556","connect-width":2,branch:"bezier"},sub:{"font-family":"楷体,楷体_GB2312,SimKai,STKaiti","font-size":20,"connect-color":"#1E3556","connect-width":2,margin:[10,16]},relLine:{"line-color":"rgb(228, 116, 120)",color:"#333"},generalize:{"line-color":"rgb(228, 116, 120)",background:"rgb(228, 116, 120)"}}}].forEach((function(e){De.register(e.name,e.options)}));[{name:"business-1",options:{map:{background:"#E7E4DC","background-image":"business6"},root:{color:"#333",background:"#fff",shape:"annulus",branch:"stitch","branch-multicolor":"multiColor10",padding:[12,20]},main:{color:"#333",background:"transparent","stroke-width":2,shape:"annulus",branch:"under","font-weight":"bold"},sub:{color:"#333",branch:"under"},relLine:{"line-color":"rgb(255, 147, 15)",color:"#333"},generalize:{"line-color":"rgb(255, 147, 15)",background:"rgb(255, 147, 15)",color:"#333",shape:"ellipse"}}},{name:"business-2",options:{map:{background:"#E7E4DC","background-image":"business4"},root:{color:"#333",background:"#fff",shape:"annulus",branch:"under","branch-multicolor":"multiColor11",padding:[12,20]},main:{color:"#333",background:"transparent",shape:"annulus",branch:"under","font-weight":"bold"},sub:{color:"#333",branch:"under"},relLine:{"line-color":"rgb(241, 120, 125)",color:"#333"},generalize:{"line-color":"rgb(241, 120, 125)",background:"rgb(241, 120, 125)",color:"#333",shape:"ellipse"}}},{name:"business-3",options:{map:{background:"#E7E4DC","background-image":"grain2"},root:{color:"#333",background:"rgb(192, 223, 32)","branch-tapared":!0,branch:"arc","branch-multicolor":"multiColor12"},main:{color:"#fff",branch:"bezier","background-multicolor":"multiColor12"},sub:{color:"#fff",branch:"bezier","background-multicolor":"multiColor12"},relLine:{"line-color":"rgb(48, 38, 36)",color:"rgb(229, 78, 93)","font-weight":"bold"},generalize:{"line-color":"rgb(48, 38, 36)",background:"rgb(48, 38, 36)",color:"#FD6574"}}},{name:"business-4",options:{map:{background:"#E7E4DC","background-image":"business2"},root:{color:"rgb(78, 97, 215)",background:"#fff",shape:"annulus",branch:"stitch","branch-multicolor":"multiColor13",padding:[12,20]},main:{color:"#fff","background-multicolor":"multiColor13",shape:"annulus",branch:"bezier"},sub:{color:"#333",branch:"bezier","stroke-width":2,background:"#fff"},relLine:{"line-color":"rgb(241, 163, 58)",color:"#333"},generalize:{"line-color":"rgb(241, 163, 58)",background:"rgb(241, 163, 58)",color:"#333",shape:"ellipse"}}}].forEach((function(e){De.register(e.name,e.options)})),Me.register("arc",(function(e,t,n,r,o){var i,a,s,c=e.getLayoutBox(),l=t.getLayoutBox(),u=Math.abs,d=[],h=c.x>l.x?"right":"left",g=l.cx;t.isRoot()&&minder.getStyle("map","startPos")&&(g=minder.getConnectStartPosX(h,e,l)),i=new kity.Point(g,l.cy),a="left"==h?new kity.Point(c.right+2,c.cy):new kity.Point(c.left-2,c.cy),s=kity.Vector.fromPoints(i,a),d.push("M",i),d.push("A",u(s.x),u(s.y),0,0,s.x*s.y>0?0:1,a),n.setPathData(d)})),Me.register("arc_tp",(function(e,t,n,r,o){var i,a,s=e.getLayoutBox(),c=t.getLayoutBox(),l=e.getIndex(),u=t.getChildren()[l+1];e.getIndex()>0&&(c=t.getChildren()[l-1].getLayoutBox());var d=[];i=new kity.Point(c.cx,c.cy),a=new kity.Point(s.cx,s.cy);var h=Math.sqrt(Math.pow(i.x-a.x,2)+Math.pow(i.y-a.y,2));if(h=0==e.getIndex()?.4*h:h,d.push("M",i),d.push("A",h,h,0,0,1,a),n.setPathData(d),u&&u.getConnection()){var g=u.getConnection(),f=u.getLayoutBox(),p=new kity.Point(f.cx,f.cy),m=Math.sqrt(Math.pow(a.x-p.x,2)+Math.pow(a.y-p.y,2));(d=[]).push("M",a),d.push("A",m,m,0,0,1,p),g.setPathData(d)}})),Me.register("bezier",(function(e,t,n){var r=t.getLayoutVertexOut(),o=e.getLayoutVertexIn(),i=t.getLayoutVectorOut().normalize(),a=Math.round,s=Math.abs,c=[];if(c.push("M",a(r.x),a(r.y)),s(i.x)>s(i.y)){var l=(o.x+r.x)/2;c.push("C",l,r.y,l,o.y,o.x,o.y)}else{var u=(o.y+r.y)/2;c.push("C",r.x,u,o.x,u,o.x,o.y)}n.setMarker(null),n.setPathData(c)})),Me.register("fish-bone-master",(function(e,t,n){var r=t.getLayoutVertexOut(),o=e.getLayoutVertexIn(),i=Math.abs,a=i(r.y-o.y),s=i(r.x-o.x),c=[];c.push("M",r.x,r.y),c.push("h",s-a),c.push("L",o.x,o.y),n.setMarker(null),n.setPathData(c)})),Me.register("l",(function(e,t,n){var r=t.getLayoutVertexOut(),o=e.getLayoutVertexIn(),i=t.getLayoutVectorOut(),a=[],s=Math.round,c=Math.abs;a.push("M",r.round()),c(i.x)>c(i.y)?a.push("H",s(o.x)):a.push("V",o.y),a.push("L",o),n.setPathData(a)}));var yn=[4,3];Me.register("dotted",(function(e,t,n){var r=t.getLayoutVertexOut(),o=e.getLayoutVertexIn(),i=[];i.push("M",r.x,r.y),i.push("L",o.x,o.y),n.setPathData(i);var a=e.getStyle("connect-width");n.setAttr("stroke-dasharray",yn.map((function(e){return e*a})).join(","))})),Me.register("straight",(function(e,t,n){var r=t.getLayoutVertexOut(),o=e.getLayoutVertexIn(),i=[];i.push("M",r.x,r.y),i.push("L",o.x,o.y),n.setPathData(i)})),Me.register("poly",(function(e,t,n,r){var o=e.root.minder,i=t.getLayoutVertexOut(),a=e.getLayoutVertexIn(),s=t.getLayoutVectorOut().normalize(),c=t.getLayoutBox();o&&["default-poly","right-poly"].indexOf(o.getTemplate(e))>-1&&(s=new kity.Vector(a.x-i.x,0));var l=0;t.isRoot()&&(l=c.width/2);var u=Math.round,d=Math.abs,h=[];switch(h.push("M",u(i.x),u(i.y)),!0){case d(s.x)>d(s.y)&&s.x<0:h.push("h",-(l+20)),h.push("v",a.y-i.y),h.push("H",a.x);break;case d(s.x)>d(s.y)&&s.x>=0:h.push("h",l+20),h.push("v",a.y-i.y),h.push("H",a.x);break;case d(s.x)<=d(s.y)&&s.y<0:h.push("v",-t.getStyle("margin-top")),h.push("h",a.x-i.x),h.push("V",a.y);break;case d(s.x)<=d(s.y)&&s.y>=0:h.push("v",t.getStyle("margin-bottom")),h.push("h",a.x-i.x),h.push("V",a.y)}n.setMarker(null),n.setPathData(h)}));var bn=Math.round,vn=Math.abs;Me.register("round-elbow",(function(e,t,n){var r,o=t.getLayoutVertexOut(),i=e.getLayoutVertexIn(),a=e.getLayoutVectorIn().normalize();switch(!0){case vn(a.x)>vn(a.y)&&a.x<0:r="left";break;case vn(a.x)>vn(a.y)&&a.x>=0:r="right";break;case vn(a.x)<=vn(a.y)&&a.y<0:r="top";break;case vn(a.x)<=vn(a.y)&&a.y>=0:r="bottom"}var s=8,c=15,l=t.getLayoutBox();if(["left","right"].includes(r)){var u,d=i.y-o.y;vn(d)<8&&(s=vn(d)),u=d>0?i.y-s:i.y+s,t.isRoot()&&(c+=l.width/2)}else{var h,g=i.x-o.x;vn(g)<8&&(s=vn(g)),h=g>0?i.x-s:i.x+s}var f={x:bn(o.x),y:bn(o.y)},p={},m={},y={},b={},v={x:i.x,y:i.y};switch(r){case"left":p={x:o.x-c,y:o.y},m={x:o.x-c,y:u},y={x:o.x-c,y:i.y},b={x:o.x-c-s,y:i.y};break;case"right":p={x:o.x+c,y:o.y},m={x:o.x+c,y:u},y={x:o.x+c,y:i.y},b={x:o.x+c+s,y:i.y};break;case"top":p={x:o.x,y:o.y-c},m={x:h,y:o.y-c},y={x:i.x,y:o.y-c},b={x:i.x,y:o.y-c-s};break;case"bottom":p={x:o.x,y:o.y+c},m={x:h,y:o.y+c},y={x:i.x,y:o.y+c},b={x:i.x,y:o.y+c+s}}var w=["M",f.x,f.y,"L",p.x,p.y,"L",m.x,m.y,"Q",y.x,y.y,b.x,b.y,"L",v.x,v.y];n.setPathData(w)}));var wn=Math.abs;function kn(e,t){var n=.182*(t.x-e.x)+e.x,r=t.y;return new kity.Point(n,r)}function xn(e,t,n,r,o,i,a,s){var c=Math.round,l=1===o||3===o?1:-1,u=1.2*i,d=3*i,h=c(t.x)+s*(r+20),g=d/3,f=.8*d,p=2*u;Math.abs(e.y-t.y)<u-1&&(p=0,f=0);var m=1;(1===a&&e.x<h||-1===a&&e.x>h)&&(m=-1);var y=[c(t.x),t.y+l*u],b=[h,t.y+l*u],v=[h,e.y+l*g/2],w=[e.x,e.y+l*g/2],k=[w[0],w[1]-m*l*g],x=[v[0]-a*p,v[1]-m*l*g],C=[h-a*p,t.y-l*u],S=[c(t.x),t.y-l*u],A=[h,e.y+l*(g/2+f)],M=[h+m*a*f,e.y+l*g/2],R=[A[0]-a*p,A[1]-m*l*g],E=[M[0]-a*p,M[1]-m*l*g];(1===l&&R[1]>S[1]||-1===l&&R[1]<S[1])&&(R[1]=S[1]),n.push("L",y),n.push("L",b),n.push("L",A),n.push("Q",v,M),n.push("L",w),n.push("L",k),n.push("L",E),n.push("Q",x,R),n.push("L",C),n.push("L",S)}function Cn(e,t,n,r,o,i,a){var s=Math.round,c=1===o||2===o?1:-1,l=1.2*i,u=3*i,d=s(t.y)-a*r.getStyle("margin-bottom"),h=u/3,g=.8*u,f=2*l;Math.abs(e.x-t.x)<l-1&&(f=0,g=0);var p=1;(-1===a&&e.y<d||1===a&&e.y>d)&&(p=-1);var m=[t.x+c*l,s(t.y)],y=[t.x+c*l,d],b=[e.x+c*h/2,d],v=[e.x+c*h/2,e.y],w=[v[0]-p*c*h,v[1]],k=[b[0]-p*c*h,b[1]-a*f],x=[t.x-c*l,d-a*f],C=[t.x-c*l,s(t.y)],S=[e.x+c*(h/2-g),d],A=[e.x+c*h/2,d-p*a*g],M=[S[0]-p*c*h,S[1]-a*f],R=[A[0]-p*c*h,A[1]-a*f];(-1===c&&S[0]>y[0]||1===c&&S[0]<y[0])&&(S[0]=y[0]),n.push("L",m),n.push("L",y),n.push("L",S),n.push("Q",b,A),n.push("L",v),n.push("L",w),n.push("L",R),n.push("Q",k,M),n.push("L",x),n.push("L",C)}function Sn(e){var t=e.getLevel();if(0===t)return"mind";if(1===t){var n=e.parent.getDataRightNumber();return e.getIndex()<n?"right":"left"}return e.parent.getLayout(e)}function An(e){return"right"}Me.register("bracket",(function(e,t,n){var r=t.getChildren(),o=r[0],i=r[r.length-1];if("mind"===t.getLayout()){var a=t.getDataRightNumber();e.getIndex()<a?i=t.getChild(a-1):o=t.getChild(a)}if(e===i){var s,c=t.getLayoutVertexOut(),l=o.getLayoutVertexIn(),u=i.getLayoutVertexIn(),d=i.getLayoutVectorIn().normalize(),h=t.getLayoutBox(),g=i.getLayoutBox(),f=5,p=t.isRoot(),m=p?10:6,y=o===i;switch(!0){case wn(d.x)>wn(d.y)&&d.x<0:s="left",p&&(f+=h.width/2),c.x-=f,y&&(l.y-=g.height/2,u.y+=g.height/2);break;case wn(d.x)>wn(d.y)&&d.x>=0:s="right",p&&(f+=h.width/2),c.x+=f,y&&(l.y-=g.height/2,u.y+=g.height/2);break;case wn(d.x)<=wn(d.y)&&d.y<0:s="top",c.y-=f,y&&(l.x-=g.width/2,u.x+=g.width/2);break;case wn(d.x)<=wn(d.y)&&d.y>=0:s="bottom",c.y+=f,y&&(l.x-=g.width/2,u.x+=g.width/2)}var b=function(e,t,n,r,o){var i=[];switch(r){case"left":i=[["M",e.x,e.y],["Q",e.x-o,e.y,e.x-o,e.y-o],["L",e.x-o,t.y+o],["Q",e.x-o,t.y,e.x-2*o,t.y],["M",e.x,e.y],["Q",e.x-o,e.y,e.x-o,e.y+o],["L",e.x-o,n.y-o],["Q",e.x-o,n.y,e.x-2*o,n.y]];break;case"right":i=[["M",e.x,e.y],["Q",e.x+o,e.y,e.x+o,e.y-o],["L",e.x+o,t.y+o],["Q",e.x+o,t.y,e.x+2*o,t.y],["M",e.x,e.y],["Q",e.x+o,e.y,e.x+o,e.y+o],["L",e.x+o,n.y-o],["Q",e.x+o,n.y,e.x+2*o,n.y]];break;case"top":i=[["M",e.x,e.y],["Q",e.x,e.y-o,e.x-o,e.y-o],["L",t.x+o,e.y-o],["Q",t.x,e.y-o,t.x,e.y-2*o],["M",e.x,e.y],["Q",e.x,e.y-o,e.x+o,e.y-o],["L",n.x-o,e.y-o],["Q",n.x,e.y-o,n.x,e.y-2*o]];break;case"bottom":i=["M",e.x,e.y,"Q",e.x,e.y+o,e.x-o,e.y+o,"L",t.x+o,e.y+o,"Q",t.x,e.y+o,t.x,e.y+2*o,"M",e.x,e.y,"Q",e.x,e.y+o,e.x+o,e.y+o,"L",n.x-o,e.y+o,"Q",n.x,e.y+o,n.x,e.y+2*o]}return i}(c,l,u,s,m);n.setPathData(b)}else n.setPathData(null)})),Me.register("under",(function(e,t,n){var r=e.getMinder(),o=e.getLayoutBox(),i=t.getLayoutBox(),a=[],s=o.x>i.x?"right":"left",c="right"===s?i.right:i.left;t.isRoot()&&(c=r.getConnectStartPosX(s,e,i));var l=i.cy;t.isRoot()||"under"!==t.getConnect()||(l=i.bottom+3);var u,d,h,g,f=o.bottom+3;"right"===s?(u=new kity.Point(c,l),d=new kity.Point(o.left-10,f),h=new kity.Point(o.right,f)):(u=new kity.Point(c,l),d=new kity.Point(o.right+10,f),h=new kity.Point(o.left,f)),g=(u.x+d.x)/2,a.push("M",u),a.push("C",g,u.y,g,d.y,d),a.push("L",h),n.setMarker(null),n.setPathData(a)})),Me.register("arc-tapared",(function(e,t,n,r,o){var i=e.getLayoutBox(),a=t.getLayoutBox(),s=[],c=i.x>a.x?"right":"left";(function(e,t,n,r,o,i,a,s){var c,l,u=p.getTanDeg(n,r);l=minder.getConnectStartPosX(e,a,o),c=function(e,t,n,r,o){o*=5;var i,a,s,c=new kity.Point(e,n.cy);if(1===r||4===r)i=2*Math.PI/360*(90-t),a=Math.tan(i),s=1;else{i=2*Math.PI/360*(90-t);var l=Math.tan(i);a=l<0?0:-l,s=-1}var u=Math.sqrt(Math.pow(o/2,2)/(1+Math.pow(a,2))),d=c.x+u,h=c.x-u,g=c.y-a*c.x,f=0!==t?a*d+g:c.y+s*o/2,p=0!==t?a*h+g:c.y-s*o/2,m=new kity.Point(d,f);return[new kity.Point(h,p),c,m]}(l,u,o,t,s);var d=new kity.Point(r.x,r.y+s);i.push("M",c[1]),i.push("L",c[2]),1===t||4===t?(i.push("Q",kn(c[2],d),d),i.push("L",r),i.push("Q",kn(c[0],r),c[0])):(i.push("Q",kn(c[2],r),r),i.push("L",d),i.push("Q",kn(c[0],d),c[0]));i.push("L",c[1]),i.push("Z")})(c,p.getQuadrant(e,t),new kity.Point(a.cx,a.cy),"left"==c?new kity.Point(i.right,i.cy):new kity.Point(i.left,i.cy),a,s,e,r),n.setPathData(s)})),Me.register("stitch",(function(e,t,n,r,o){var i,a,s=e.getLayoutBox(),c=t.getLayoutBox(),l=[],u=s.x>c.x?"right":"left",d=minder.getConnectStartPosX(u,e,c);i=new kity.Point(d,c.cy),a="left"==u?new kity.Point(s.right,s.cy):new kity.Point(s.left,s.cy);var h=.618*(i.x-a.x),g=new kity.Point(i.x-h,a.y);l.push("M",i),l.push("L",g),l.push("L",a),n.setPathData(l)})),Me.register("slingshot",(function(e,t,n){var r,o,i=e.getLayoutBox(),a=t.getLayoutBox(),s=[],c=i.x>a.x?"right":"left",l="right"===c?1:-1;r=new kity.Point(a.cx+l*a.width/2,a.cy),o="left"==c?new kity.Point(i.right,i.cy):new kity.Point(i.left,i.cy);var u=.5*(r.x-o.x),d=new kity.Point(r.x-u,r.y);s.push("M",r),s.push("L",d),s.push("L",o),n.setMarker(null),n.setPathData(s)})),Me.register("poly-tapared",(function(e,t,n,r){var o=e.root.minder,i=t.getLayoutVertexOut(),a=e.getLayoutVertexIn(),s=t.getLayoutVectorOut().normalize(),c=t.getLayoutBox();o&&["default-poly","right-poly"].indexOf(o.getTemplate(e))>-1&&(s=new kity.Vector(a.x-i.x,0));var l=0;t.isRoot()&&(l=c.width/2);var u=Math.round,d=Math.abs,h=p.getQuadrant(e,t),g=[];switch(g.push("M",u(i.x),u(i.y)),!0){case d(s.x)>d(s.y)&&s.x<0:xn(a,i,g,l,h,r,-1,-1);break;case d(s.x)>d(s.y)&&s.x>=0:xn(a,i,g,l,h,r,1,1);break;case d(s.x)<=d(s.y)&&s.y<0:Cn(a,i,g,t,h,r,1);break;case d(s.x)<=d(s.y)&&s.y>=0:Cn(a,i,g,t,h,r,-1)}n.setMarker(null),n.setPathData(g)})),ze.register("default",{getLayout:Sn,getConnect:function(e){var t=(this.parent||this).getStyle("branch");return t||(1===e.getLevel()?"arc":"under")}}),ze.register("default-poly",{getLayout:Sn,getConnect:function(e){return"poly"}}),ze.register("structure",{getLayout:function(e){return"bottom"},getConnect:function(e){return"poly"}}),ze.register("filetree",{getLayout:function(e){return e.isRoot()?"bottom":"filetree-down"},getConnect:function(e){return 1==e.getLevel()?"poly":"l"}}),ze.register("right",{getLayout:An,getConnect:function(e){var t=(this.parent||this).getStyle("branch");return t||(1===e.getLevel()?"arc":"bezier")}}),ze.register("right-poly",{getLayout:An,getConnect:function(e){return"poly"}}),ze.register("fish-bone",{getLayout:function(e){var t=e.getLevel();if(0===t)return"fish-bone-master";if(1===t)return"fish-bone-slave";for(var n=e.parent;"main"!==n.getType();)n=n.parent;return n.getIndex()%2==0?"filetree-down":"filetree-up"},getConnect:function(e){switch(e.getLevel()){case 1:return"fish-bone-master";case 2:return"line";default:return"l"}}}),ze.register("tianpan",{getLayout:function(e){return e.getData("layout")?e.getData("layout"):0===e.getLevel()?"tianpan":e.parent.getLayout(e)},getConnect:function(e){return"arc_tp"}});var Mn={Minder:y,Node:R,Module:be,Command:v,Event:b,Render:xe,Connect:Me,Layout:Ee,Theme:De,Template:ze,KeyMap:ce,data:se,utils:p,version:e};function Rn(e,t){return"object"!=(void 0===t?"undefined":w(t))&&(t=[].slice.call(arguments,1)),String(e).replace(/\{(\w+)\}/gi,(function(e,n){return t[n]||n}))}function En(){}var Ln=new function(e){if(this.flaged=-1!=window.location.search.indexOf(e)){var t=Rn("background: hsl({0}, 50%, 80%); color: hsl({0}, 100%, 30%); padding: 2px 3px; margin: 1px 3px 0 0;border-radius: 2px;",function(e){for(var t=0,n=0;n<e.length;n++)t+=e.charCodeAt(n);return t}(e)%360),n="background: none; color: black;";this.log=function(){var r=Rn.apply(null,arguments);console.log(Rn("%c{0}%c{1}",e,r),t,n)}}else this.log=En}("fsm");function Dn(e,t,n,r){return e.when==t&&(("*"==e.enter||e.enter==r)&&("*"==e.exit||e.exit==n||void 0))}function Nn(e){var t=e,n=[];this.jump=function(e,r){if(!r)throw new Error("Please tell fsm the reason to jump");var o,i,a=t,s=[a,e].concat([].slice.call(arguments,1));for(o=0;o<n.length;o++)if(Dn((i=n[o]).condition,"before",a,e)&&i.apply(null,s))return;for(t=e,Ln.log("[{0}] {1} -> {2}",r,a,e),o=0;o<n.length;o++)Dn((i=n[o]).condition,"after",a,e)&&i.apply(null,s);return t},this.state=function(){return t},this.when=function(e,t){var r,o,i,a;if(1==arguments.length&&(t=e,e="* -> *"),2==(o=e.split(" - ")).length?r="before":2==(o=e.split(" -> ")).length&&(r="after"),!r)throw new Error("Illegal fsm condition: "+e);i=o[0],a=o[1],t.condition={when:r,exit:i,enter:a},n.push(t)},this.isInputState=function(){return"input"===this.state()}}var Tn={Shift:16,Control:17,Alt:18,CapsLock:20,BackSpace:8,Tab:9,Enter:13,Esc:27,Space:32,PageUp:33,PageDown:34,End:35,Home:36,Insert:45,Left:37,Up:38,Right:39,Down:40,Direction:{37:1,38:1,39:1,40:1},Del:46,NumLock:144,Cmd:91,CmdFF:224,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,"`":192,"=":187,"-":189,"/":191,".":190};for(var In in Tn)Tn.hasOwnProperty(In)&&(Tn[In.toLowerCase()]=Tn[In]);var On="a".charCodeAt(0);"abcdefghijklmnopqrstuvwxyz".split("").forEach((function(e){Tn[e]=e.charCodeAt(0)-On+65}));var Pn=9;do{Tn[Pn.toString()]=Pn+48}while(--Pn);function zn(e){return"string"==typeof e?(t=0,e.toLowerCase().split(/\s*\+\s*/).forEach((function(e){switch(e){case"ctrl":case"cmd":t|=4096;break;case"alt":t|=8192;break;case"shift":t|=16384;break;default:t|=Tn[e]}})),t):function(e){var t=0;(e.ctrlKey||e.metaKey)&&(t|=4096);e.altKey&&(t|=8192);e.shiftKey&&(t|=16384);if(-1===[16,17,18,91].indexOf(e.keyCode)){if(229===e.keyCode&&e.keyIdentifier)return t|=parseInt(e.keyIdentifier.substr(2),16);t|=e.keyCode}return t}(e);var t}var Gn={hash:zn,is:function(e,t){return"Space"===t?e.code===t:e&&t&&zn(e)==zn(t)}};var Bn="";
/*!
   * https://github.com/Starcounter-Jack/JSON-Patch
   * (c) 2017 Joachim Wester
   * MIT license
   */
var _n,Fn=(_n=function(e,t){return(_n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}_n(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),Vn=Object.prototype.hasOwnProperty;function jn(e,t){return Vn.call(e,t)}function Un(e){if(Array.isArray(e)){for(var t=new Array(e.length),n=0;n<t.length;n++)t[n]=""+n;return t}if(Object.keys)return Object.keys(e);t=[];for(var r in e)jn(e,r)&&t.push(r);return t}function Qn(e){switch(typeof e){case"object":return JSON.parse(JSON.stringify(e));case"undefined":return null;default:return e}}function Hn(e){for(var t,n=0,r=e.length;n<r;){if(!((t=e.charCodeAt(n))>=48&&t<=57))return!1;n++}return!0}function Zn(e){return-1===e.indexOf("/")&&-1===e.indexOf("~")?e:e.replace(/~/g,"~0").replace(/\//g,"~1")}function Yn(e){return e.replace(/~1/g,"/").replace(/~0/g,"~")}function Wn(e,t){var n=[e];for(var r in t){var o="object"==typeof t[r]?JSON.stringify(t[r],null,2):t[r];void 0!==o&&n.push(r+": "+o)}return n.join("\n")}var Jn=function(e){function t(t,n,r,o,i){var a=this.constructor,s=e.call(this,Wn(t,{name:n,index:r,operation:o,tree:i}))||this;return s.name=n,s.index=r,s.operation=o,s.tree=i,Object.setPrototypeOf(s,a.prototype),s.message=Wn(t,{name:n,index:r,operation:o,tree:i}),s}return Fn(t,e),t}(Error),qn=Jn,Kn=Qn,Xn={add:function(e,t,n){return e[t]=this.value,{newDocument:n}},remove:function(e,t,n){var r=e[t];return delete e[t],{newDocument:n,removed:r}},replace:function(e,t,n){var r=e[t];return e[t]=this.value,{newDocument:n,removed:r}},move:function(e,t,n){var r=er(n,this.path);r&&(r=Qn(r));var o=tr(n,{op:"remove",path:this.from}).removed;return tr(n,{op:"add",path:this.path,value:o}),{newDocument:n,removed:r}},copy:function(e,t,n){var r=er(n,this.from);return tr(n,{op:"add",path:this.path,value:Qn(r)}),{newDocument:n}},test:function(e,t,n){return{newDocument:n,test:ir(e[t],this.value)}},_get:function(e,t,n){return this.value=e[t],{newDocument:n}}},$n={add:function(e,t,n){return Hn(t)?e.splice(t,0,this.value):e[t]=this.value,{newDocument:n,index:t}},remove:function(e,t,n){return{newDocument:n,removed:e.splice(t,1)[0]}},replace:function(e,t,n){var r=e[t];return e[t]=this.value,{newDocument:n,removed:r}},move:Xn.move,copy:Xn.copy,test:Xn.test,_get:Xn._get};function er(e,t){if(""==t)return e;var n={op:"_get",path:t};return tr(e,n),n.value}function tr(e,t,n,r,o,i){if(void 0===n&&(n=!1),void 0===r&&(r=!0),void 0===o&&(o=!0),void 0===i&&(i=0),n&&("function"==typeof n?n(t,0,e,t.path):rr(t,0)),""===t.path){var a={newDocument:e};if("add"===t.op)return a.newDocument=t.value,a;if("replace"===t.op)return a.newDocument=t.value,a.removed=e,a;if("move"===t.op||"copy"===t.op)return a.newDocument=er(e,t.from),"move"===t.op&&(a.removed=e),a;if("test"===t.op){if(a.test=ir(e,t.value),!1===a.test)throw new qn("Test operation failed","TEST_OPERATION_FAILED",i,t,e);return a.newDocument=e,a}if("remove"===t.op)return a.removed=e,a.newDocument=null,a;if("_get"===t.op)return t.value=e,a;if(n)throw new qn("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",i,t,e);return a}r||(e=Qn(e));var s=(t.path||"").split("/"),c=e,l=1,u=s.length,d=void 0,h=void 0,g=void 0;for(g="function"==typeof n?n:rr;;){if(h=s[l],o&&"__proto__"==h)throw new TypeError("JSON-Patch: modifying `__proto__` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(n&&void 0===d&&(void 0===c[h]?d=s.slice(0,l).join("/"):l==u-1&&(d=t.path),void 0!==d&&g(t,0,e,d)),l++,Array.isArray(c)){if("-"===h)h=c.length;else{if(n&&!Hn(h))throw new qn("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",i,t,e);Hn(h)&&(h=~~h)}if(l>=u){if(n&&"add"===t.op&&h>c.length)throw new qn("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",i,t,e);if(!1===(a=$n[t.op].call(t,c,h,e)).test)throw new qn("Test operation failed","TEST_OPERATION_FAILED",i,t,e);return a}}else if(h&&-1!=h.indexOf("~")&&(h=Yn(h)),l>=u){if(!1===(a=Xn[t.op].call(t,c,h,e)).test)throw new qn("Test operation failed","TEST_OPERATION_FAILED",i,t,e);return a}c=c[h]}}function nr(e,t,n,r,o){if(void 0===r&&(r=!0),void 0===o&&(o=!0),n&&!Array.isArray(t))throw new qn("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");r||(e=Qn(e));for(var i=new Array(t.length),a=0,s=t.length;a<s;a++)i[a]=tr(e,t[a],n,!0,o,a),e=i[a].newDocument;return i.newDocument=e,i}function rr(e,t,n,r){if("object"!=typeof e||null===e||Array.isArray(e))throw new qn("Operation is not an object","OPERATION_NOT_AN_OBJECT",t,e,n);if(!Xn[e.op])throw new qn("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",t,e,n);if("string"!=typeof e.path)throw new qn("Operation `path` property is not a string","OPERATION_PATH_INVALID",t,e,n);if(0!==e.path.indexOf("/")&&e.path.length>0)throw new qn('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",t,e,n);if(("move"===e.op||"copy"===e.op)&&"string"!=typeof e.from)throw new qn("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",t,e,n);if(("add"===e.op||"replace"===e.op||"test"===e.op)&&void 0===e.value)throw new qn("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",t,e,n);if(("add"===e.op||"replace"===e.op||"test"===e.op)&&function e(t){if(void 0===t)return!0;if(t)if(Array.isArray(t)){for(var n=0,r=t.length;n<r;n++)if(e(t[n]))return!0}else if("object"==typeof t){var o=Un(t),i=o.length;for(n=0;n<i;n++)if(e(t[o[n]]))return!0}return!1}(e.value))throw new qn("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",t,e,n);if(n)if("add"==e.op){var o=e.path.split("/").length,i=r.split("/").length;if(o!==i+1&&o!==i)throw new qn("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",t,e,n)}else if("replace"===e.op||"remove"===e.op||"_get"===e.op){if(e.path!==r)throw new qn("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",t,e,n)}else if("move"===e.op||"copy"===e.op){var a=or([{op:"_get",path:e.from,value:void 0}],n);if(a&&"OPERATION_PATH_UNRESOLVABLE"===a.name)throw new qn("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",t,e,n)}}function or(e,t,n){try{if(!Array.isArray(e))throw new qn("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(t)nr(Qn(t),Qn(e),n||!0);else{n=n||rr;for(var r=0;r<e.length;r++)n(e[r],r,t,void 0)}}catch(e){if(e instanceof qn)return e;throw e}}function ir(e,t){if(e===t)return!0;if(e&&t&&"object"==typeof e&&"object"==typeof t){var n,r,o,i=Array.isArray(e),a=Array.isArray(t);if(i&&a){if((r=e.length)!=t.length)return!1;for(n=r;0!=n--;)if(!ir(e[n],t[n]))return!1;return!0}if(i!=a)return!1;var s=Object.keys(e);if((r=s.length)!==Object.keys(t).length)return!1;for(n=r;0!=n--;)if(!t.hasOwnProperty(s[n]))return!1;for(n=r;0!=n--;)if(!ir(e[o=s[n]],t[o]))return!1;return!0}return e!=e&&t!=t}var ar=Object.freeze({__proto__:null,JsonPatchError:qn,deepClone:Kn,getValueByPointer:er,applyOperation:tr,applyPatch:nr,applyReducer:function(e,t,n){var r=tr(e,t);if(!1===r.test)throw new qn("Test operation failed","TEST_OPERATION_FAILED",n,t,e);return r.newDocument},validator:rr,validate:or,_areEquals:ir}),sr=new WeakMap,cr=function(e){this.observers=new Map,this.obj=e},lr=function(e,t){this.callback=e,this.observer=t};
/*!
   * https://github.com/Starcounter-Jack/JSON-Patch
   * (c) 2017 Joachim Wester
   * MIT license
   */function ur(e,t){void 0===t&&(t=!1);var n=sr.get(e.object);dr(n.value,e.object,e.patches,"",t),e.patches.length&&nr(n.value,e.patches);var r=e.patches;return r.length>0&&(e.patches=[],e.callback&&e.callback(r)),r}function dr(e,t,n,r,o){if(t!==e){"function"==typeof t.toJSON&&(t=t.toJSON());for(var i=Un(t),a=Un(e),s=!1,c=a.length-1;c>=0;c--){var l=e[d=a[c]];if(!jn(t,d)||void 0===t[d]&&void 0!==l&&!1===Array.isArray(t))Array.isArray(e)===Array.isArray(t)?(o&&n.push({op:"test",path:r+"/"+Zn(d),value:Qn(l)}),n.push({op:"remove",path:r+"/"+Zn(d)}),s=!0):(o&&n.push({op:"test",path:r,value:e}),n.push({op:"replace",path:r,value:t}));else{var u=t[d];"object"==typeof l&&null!=l&&"object"==typeof u&&null!=u?dr(l,u,n,r+"/"+Zn(d),o):l!==u&&(o&&n.push({op:"test",path:r+"/"+Zn(d),value:Qn(l)}),n.push({op:"replace",path:r+"/"+Zn(d),value:Qn(u)}))}}if(s||i.length!=a.length)for(c=0;c<i.length;c++){var d;jn(e,d=i[c])||void 0===t[d]||n.push({op:"add",path:r+"/"+Zn(d),value:Qn(t[d])})}}}function hr(e,t,n){void 0===n&&(n=!1);var r=[];return dr(e,t,r,"",n),r}var gr=Object.freeze({__proto__:null,unobserve:function(e,t){t.unobserve()},observe:function(e,t){var n,r=function(e){return sr.get(e)}(e);if(r){var o=function(e,t){return e.observers.get(t)}(r,t);n=o&&o.observer}else r=new cr(e),sr.set(e,r);if(n)return n;if(n={},r.value=Qn(e),t){n.callback=t,n.next=null;var i=function(){ur(n)},a=function(){clearTimeout(n.next),n.next=setTimeout(i)};"undefined"!=typeof window&&(window.addEventListener("mouseup",a),window.addEventListener("keyup",a),window.addEventListener("mousedown",a),window.addEventListener("keydown",a),window.addEventListener("change",a))}return n.patches=[],n.object=e,n.unobserve=function(){ur(n),clearTimeout(n.next),function(e,t){e.observers.delete(t.callback)}(r,n),"undefined"!=typeof window&&(window.removeEventListener("mouseup",a),window.removeEventListener("keyup",a),window.removeEventListener("mousedown",a),window.removeEventListener("keydown",a),window.removeEventListener("change",a))},r.observers.set(t,new lr(t,n)),n},generate:ur,compare:hr});Object.assign({},ar,gr,{JsonPatchError:Jn,deepClone:Qn,escapePathComponent:Zn,unescapePathComponent:Yn});var fr=hr;var pr=Quill.import("attributors/style/size");delete pr.whitelist,Quill.register(pr,!0);var mr=Quill.import("attributors/style/font");delete mr.whitelist,Quill.register(mr,!0);var yr=Quill.import("attributors/style/align");Quill.register(yr,!0);var br=[];function vr(e){br.push(e)}function wr(e,t){this.selector=e,this.options=t||{};for(var n=0;n<br.length;n++)"function"==typeof br[n]&&br[n].call(this,this)}return wr.assemble=vr,vr((function(){Object.assign(this,{enable:function(){this.minder.enable(),this.quill.enable()},disable:function(){this.minder.disable(),this.quill.disable()},addCommandShortcutKeys:function(e){var t=this;e.forEach((function(e){t.minder.addShortcut(e.key,e.fn)}))}})})),vr((function(){var e;if(!(e="string"==typeof this.selector?document.querySelector(this.selector):this.selector))throw new Error("Invalid selector: "+this.selector);e.classList.add("km-editor"),this.container=e})),vr((function(){this.fsm=new Nn("normal")})),vr((function(){var e=new window.aminder.Minder({enableKeyReceiver:!1,enableAnimation:!1});e.renderTo(this.selector);var t=document.createElement("style");t.innerHTML="* {margin: 0;padding: 0;}";var n=e.getPaper().node;n.insertBefore(t,n.firstElementChild),this.minder=e})),vr((function(){var e=this,t=this.fsm,n=this.minder;function r(r){if(V.isMobile&&"input"===t.state()&&!e.isHideQuill()){var i=(r.clipboardData||window.clipboardData).getData("text");if(o(i)){if(!V.isIOS)return;null.focus();var a=null.getSelection();a?(null.insertText(a.index+a.length,i),null.setSelection(a.index,a.length),window.setTimeout((function(){null.setSelection(a.index+i.length,"silent")}),50)):console.log("User cursor is not in editor")}else n.Text2Children(n.getSelectedNode(),i,!0),e.receiver.blur(),r.preventDefault()}}function o(e){var t=e.split(/\r|\n|\r\n/).filter((function(e){return void 0!==e&&!function(e){return""===e&&!/\S/.test(e)}(e=e.replace(/&nbsp;/g,""))}));return!(t&&t.length>1)}this.mobilePaste={extendsClipboard:function(){var e=function(e){function t(){return k(this,t),A(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),x(t,[{key:"onPaste",value:function(){for(var e,n=arguments.length,o=Array(n),i=0;i<n;i++)o[i]=arguments[i];return V.isMobile&&r.apply(void 0,o),(e=S(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"onPaste",this)).call.apply(e,[this].concat(o))}}]),t}(window.Quill.imports["modules/clipboard"]);window.Quill.imports["modules/clipboard"]=e},isSingleLine:function(e){o(e)}}})),vr((function(){var e,t=this,n=aminder.utils,r=this.fsm,o=V.isMobile,i=this.minder,a=this.container,s=Quill.import("delta"),c=null,l=null,u=[{key:"Enter",handler:function(){}},{key:27,handler:function(){t.cancelInput()}},{key:"Enter",shortKey:!0,handler:function(){var e=c.getSelection();c.insertText(e.index,"\n")}},{key:"Tab",handler:function(){}}];function d(e){var t=e.getHtml();if(!t){var r=e.getText()||"";t="<p>"+(r=n.encodeHtml(r)).split("\n").join("</p><p>")+"</p>"}return t}function h(e){var t=document.createElement("div"),n=function(e){var t=" ",n=e.match(/<span(([\s\S])*?)>/g),r=e.match(/<strong(([\s\S])*?)>/g),o=e.match(/<em(([\s\S])*?)>/g),i=e.match(/<s(([\s\S])*?)>/g),a=e.match(/<s>/g),s=e.match(/<u(([\s\S])*?)>/g);return s&&(t=s+t+"</u>"),r&&a&&(t=a+t+"</s>"),!r&&i&&(t=i+t+"</s>"),o&&(t=o+t+"</em>"),r&&(t=r+t+"</strong>"),{isSpan:n,str:t}}(e);return"<p><br></p>"!==e?n.isSpan?(t.innerHTML=e,t.querySelectorAll("span")[0].innerText=" "):t.innerHTML=n.str:t.innerHTML="<p> </p>",t.innerHTML}function g(){var e=i.getRenderTarget().getBoundingClientRect(),t=i.getSelectedNode().getRenderBox("TextRenderer"),n=i.getZoomValue()/100,r=[5,8],o=Math.round(e.left+t.x-r[1]*n),a=e.top;V.isIOS&&(a=0),a=Math.round(a+t.y-r[0]*n);var s=Math.round(t.width);if(s>window.innerWidth-40&&(s=window.innerWidth-40),(s=Math.round(s/n)+2*r[1])<24&&(s=24),l.style.top=a+"px",l.style.transform="scale("+n+")",l.style.minWidth=s+"px",V.isMobile||V.isTablet){var c=(K+2*r[1])*n,u=K+2*r[1],d=window.innerWidth-40;if(c>window.innerWidth){var h=n>1?n:1;u=Math.floor(d/h-2*r[1])}var g=l.getBoundingClientRect().width;if(g>=d){var f=window.innerWidth-g;o=f<0?0:Math.round(f/2)}l.style.maxWidth=u+"px"}else l.style.maxWidth=i.getWordWrapWidth()===1/0?"unset":K+"px";l.style.left=o+"px"}e=document.createElement("div"),a.appendChild(e),V.isMobile&&t.mobilePaste.extendsClipboard(),c=new window.Quill(e,{formats:["background","bold","color","font","italic","size","strike","underline","code","script","link","align"],modules:{keyboard:{bindings:u},clipboard:{matchers:[[Node.ELEMENT_NODE,function(e,t){var n=new s;return t.forEach((function(e){n.insert(e.insert)})),n}]]}}}),(l=c.root).addEventListener("contextmenu",(function(e){i.dispatchKeyEvent(e)})),i.on("dblclick",(function(e){if(!o&&i.getSelectedNode()){var t=e.kityEvent.targetShape;t&&"image"===t.getAttr("type")||i.getSelectedNode()&&"normal"===i._status&&r.jump("input","input-request")}})),i.on("beforemousedown beforewheel statuschange beforetouchstart",(function(e){if(!o||!["statuschange"].includes(e.type)){var n=r.isInputState();!V.isMobile&&n&&r.jump("normal","input-commit"),V.isMobile&&n&&(t.isHideQuill()?r.jump("normal","fake-input-exit"):r.jump("normal","input-commit"))}})),i.on("selectionchange",(function(){var e=i.getSelectedNode();if(c.setContents(),e){g();var t=h(d(e));l.innerHTML=t}})),i.on("patch",(function(){var e=i.getSelectedNode();e&&(c.setContents(),l.innerHTML=d(e),c.updateContents())}));var f=null;function p(e){f&&f.getRenderer("TextRenderer").getRenderShape().setVisible(!0),f=e,e.getRenderer("TextRenderer").getRenderShape().setVisible(!1),l.style.fontSize=e.getStyle("font-size")+"px",l.style.fontWeight=e.getStyle("font-weight")||"normal",l.style.fontStyle=e.getStyle("font-style")||"normal",l.style.fontFamily=e.getStyle("font-family")||"inherit",l.style.color=e.getStyle("color")||"initial";var t=e.getBackgroundColor();l.style.background="transparent"===t?i.getBackground():t}function m(){var e=i.getSelectedNode();e&&e.getRenderer("TextRenderer").getRenderShape().setVisible(!0),l.classList.remove("input"),o?t.receiver.blur():t.receiver.focus()}function y(e){i.getSelectedNodes().reverse().forEach((function(t){c.setContents(),l.innerHTML=d(t),c.updateContents(),e&&e(0,c.getLength(),c),t.setContent(l.innerHTML,b()),t.render()})),i.fire("contentchange"),window.setTimeout((function(){i.layout()}))}function b(){return c.getText().replace(/\n$/,"")}i.on("viewchange layoutallfinish",(function(){r.isInputState()&&g()})),i.on("zoom",(function(){r.isInputState()&&t.commitInput()})),r.when("input -> normal",n.throttle((function(){var e=i.getSelectedNode();e&&!r.isInputState()&&(l.innerHTML=h(d(e)))}),50)),r.when("* -> input",(function(e,t,n){i.fire("hideiconrequest");var r=i.getSelectedNode();if(r){"input-request"!==n&&"user-space"!==n||(c.setContents(),l.innerHTML=d(r),c.updateContents()),V.isMobile||g(),p(r);var a=c.getLength();if(o)!function(){switch(n){case"user-space":c.setSelection(a);break;default:c.setSelection(0,a-1)}}();else switch(n){case"user-space":var s=l.innerHTML;window.setTimeout((function(){l.innerHTML=s,c.updateContents(),c.setSelection(c.getLength())}));break;case"user-input":V.isSafari&&c.setSelection(a);break;default:c.setSelection(0,a)}l.classList.add("input")}})),r.when("input -> *",(function(e,t,n){var r;if("input"!==t)switch(n){case"input-cancel":case"fake-input-exit":m();break;case"input-commit":r=i.getSelectedNode(),l.innerHTML.includes("<p> </p>")&&(l.innerHTML=l.innerHTML.replace(/<p> <\/p>/g,"")),r.setContent(l.innerHTML,b()),m(),r.render(),i.fire("contentchange"),window.setTimeout((function(){i.layout(r.getRoot())})),m()}})),o||r.when("input -> *",(function(){t.receiver.focus()})),this.quill=c,this.richText={quill:c,silentEdit:y,getText:b,exitInputMode:m,setColor:function(e){r.isInputState()?c.format("color",e):y((function(t,n){c.formatText(t,n,"color",e)})),c.format("color",e)},setSize:function(e){c.format("size",e+"px")},setFont:function(e){c.format("font",e)},setBold:function(e){c.format("bold",e)},setItalic:function(e){c.format("italic",e)},setUnderline:function(e){void 0===e&&(e=!this.getFormat().underline),r.isInputState()?c.format("underline",e):y((function(t,n){c.formatText(t,n,"underline",e)}))},setStrike:function(e){void 0===e&&(e=!this.getFormat().strike),r.isInputState()?c.format("strike",e):y((function(t,n){c.formatText(t,n,"strike",e)}))},setBackground:function(e){c.format("background",e)},setAlign:function(e){r.isInputState()?c.format("align",e):y((function(t,n){c.formatText(t,n,"align",e)}))},getFormat:function(){return r.isInputState()?c.getFormat():c.getFormat(0,c.getLength())},clearFormat:function(){if(r.isInputState()){var e=c.getSelection();c.removeFormat(e.index,e.length),p(i.getSelectedNode())}else{i.getSelectedNodes().reverse().forEach((function(e){c.setContents(),c.clipboard.dangerouslyPasteHTML(d(e)),e.setContent(l.innerHTML,b()),e.render()})),i.layout()}return Promise.resolve()},updatePosition:g},Object.assign(this,{commitInput:function(){r.jump("normal","input-commit")},cancelInput:function(){r.jump("normal","input-cancel")},commitInputContent:function(){if(r.isInputState()){var e=i.getSelectedNode();e.setContent(l.innerHTML,b()),e.render()}},editText:function(){i.getSelectedNode()&&r.jump("input","input-request")},editTextAtEnd:function(){i.getSelectedNode()&&r.jump("input","user-space")},clean:function(){c.setContents()},addLineBreak:function(){var e=c.getSelection();c.insertText(e.index,"\n")},hideQuill:function(){l.classList.remove("input")},showQuill:function(){l.classList.add("input")},isHideQuill:function(){return!l.classList.value.includes("input")}});var v=[{key:"Ctrl+U",fn:this.richText.setUnderline.bind(this.richText)},{key:"Ctrl+[",fn:this.richText.setStrike.bind(this.richText)}];this.addCommandShortcutKeys(v)})),vr((function(){var e=this.fsm,t=this.minder,n=this.quill,r=this.quill.root,o=V.isMobile;r.setAttribute("tabindex",-1),r.setAttribute("autocomplete","off"),r.classList.add("receiver"),V.isTablet?r.onkeyup=s:r.onkeydown=r.onkeypress=r.onkeyup=s,r.addEventListener("compositionstart",s);var i=this.receiver={element:r,focus:function(){r.focus()},blur:function(){r.blur()},selectAll:function(){var e=n.getLength();n.setSelection(0,e)},input:function(){var e=n.getLength();n.setSelection(e)}};o&&document.addEventListener("focusout",(function(e){window.scroll(0,0)})),o||(i.focus(),t.on("focus",i.focus));var a=[];function s(t){var n;t.is=function(e){for(var t=e.split("|"),n=0;n<t.length;n++)if(Gn.is(this,t[n]))return!0;return!1};for(var r=0;r<a.length;r++)if(("*"==(n=a[r]).notifyState||n.notifyState==e.state())&&n(t))return}i.listen=function(e,t){1==arguments.length&&(t=e,e="*"),t.notifyState=e,a.push(t)}})),vr((function(){var e=this.minder;if(e.supportClipboardEvent){var t=this.fsm,n=this.receiver,r=this.quill,o=window.aminder.data,i=o.getRegisterProtocol("json").decode,a=[],s=function(r){if((!V.isMobile||V.isTablet&&(!V.isTablet||e.getSelectedNode()))&&(!V.isMobile||e.getMobileMinderEditStatus())&&(V.isMobile||document.activeElement===n.element))if("normal"===e.getStatus()){var o=r,i=t.state();switch(V.isTablet&&"input"===i&&editor.isHideQuill()&&(i="fake-input",editor.cancelInput()),i){case"input":break;case"fake-input":case"normal":var a=[].concat(e.getSelectedNodes());if(a.length){a.length>1&&(a=d(a));var s=u(a);o.clipboardData&&(o.clipboardData.setData("text/plain",s.text),o.clipboardData.setData("text/html",s.html),o.clipboardData.setData("text/km",s.km)),Bn=s.km}r.preventDefault()}V.isMobile||editor.receiver.focus()}else r.preventDefault()},c=function(r){if((!V.isMobile||V.isTablet&&(!V.isTablet||e.getSelectedNode()))&&(!V.isMobile||e.getMobileMinderEditStatus())&&(V.isMobile||document.activeElement===n.element))if("normal"===e.getStatus()){var o=r,i=t.state();switch(V.isTablet&&"input"===i&&editor.isHideQuill()&&(i="fake-input",editor.cancelInput()),i){case"input":break;case"fake-input":case"normal":var a=e.getSelectedNodes();if(a.length){a.length>1&&(a=d(a));var s=u(a);o.clipboardData&&(o.clipboardData.setData("text/plain",s.text),o.clipboardData.setData("text/html",s.html),o.clipboardData.setData("text/km",s.km)),Bn=s.km,e.execCommand("removenode")}r.preventDefault()}V.isMobile||editor.receiver.focus()}else r.preventDefault()},l=function(n){if((!V.isMobile||V.isTablet&&(!V.isTablet||e.getSelectedNode()))&&(!V.isMobile||e.getMobileMinderEditStatus())&&(V.isMobile||document.activeElement===r.clipboard.container))if("normal"===e.getStatus()){var o=n,s=t.state();V.isTablet&&"input"===s&&editor.isHideQuill()&&(s="fake-input",editor.cancelInput());var c=o.clipboardData.getData("text/km"),l=o.clipboardData?o.clipboardData.getData("text/plain"):Bn;switch(s){case"input":break;case"fake-input":case"normal":var u=e.getSelectedNodes();if(u=u.filter((function(e){return!e.isRelLine})),c){var d=i(c);if(p.checkBridgeApi("nodeLimiter")&&window.bridge.nodeLimiter(window.bridge.calcNodeNum(d)))return n.preventDefault(),void window.bridge.openNodeLimitMsg();var h=void 0;u.forEach((function(t){for(var n=d.length-1;n>=0;n--)h=e.createNode(null,t),e.importNodeAndClearId(h,d[n]),a.push(h),t.appendChild(h)})),e.renderTreeBatch(u),e.layout(),e.select(a,!0),a=[],e.fire("contentchange")}else l&&u.forEach((function(t){e.Text2Children(t,l)}));n.preventDefault()}}else n.preventDefault()};this.clipboard={copy:s,cut:c,paste:l},document.addEventListener("copy",s),document.addEventListener("cut",c),document.addEventListener("paste",l)}function u(t){for(var n=[],r=0,i=t.length;r<i;r++)n.push(e.exportNode(t[r]));var a="<div>";!function e(t){t.forEach((function(t){a+="<div>"+(t.data.html||t.data.text)+"</div>",t.children&&e(t.children)}))}(n.reverse()),a+="</div>";var s="";return n.reverse().forEach((function(e){s+=o.getRegisterProtocol("text").node2Text(e)})),{html:a,text:s,km:o.getRegisterProtocol("json").encode(n)}}function d(e){var t;if(e.sort((function(e,t){return e.getLevel()-t.getLevel()})),(t=e[0].getLevel())!==e[e.length-1].getLevel()){var n=void 0,r=0,o=e.length,i=o-1;for(n=e[i];n.getLevel()!==t;){for(r=0;r<o&&e[r].getLevel()===t;){if(e[r].isAncestorOf(n)){e.splice(i,1);break}r++}n=e[--i]}}return e}})),vr((function(){var e,t,n=this.fsm,r=this.minder;n.when("* -> drag",(function(){})),n.when("drag -> *",(function(e,t,n){}));var o,i,a,s,c,l,u=1,d=!1,h=!1;function g(e,t){if(!e)return d=h=!1,l&&kity.releaseFrame(l),void(l=null);l||(l=kity.requestFrame(function(e,t,n){return function(r){switch(e){case"left":n._viewDragger.move({x:-t,y:0},0);break;case"top":n._viewDragger.move({x:0,y:-t},0);break;case"right":n._viewDragger.move({x:t,y:0},0);break;case"bottom":n._viewDragger.move({x:0,y:t},0);break;default:return}r.next()}}(e,t,r)))}r.on("mousedown",(function(n){u=0;var a=r.getPaper().container.getBoundingClientRect();e=n.originEvent.clientX,t=n.originEvent.clientY,c=a.top,o=a.width,i=a.height})),r.on("mousemove",(function(l){if("drag"===n.state()&&0==u&&r.getSelectedNode()&&(Math.abs(e-l.originEvent.clientX)>20||Math.abs(t-l.originEvent.clientY)>20)&&(a=l.originEvent.clientX,s=l.originEvent.clientY-c,a<20?g("right",20-a):a>o-20?g("left",20+a-o):d=!0,s<20?g("bottom",s):s>i-20?g("top",5):h=!0,d&&h&&g(!1)),"drag"!==n.state()&&0===u&&r.getSelectedNode()&&(Math.abs(e-l.originEvent.clientX)>20||Math.abs(t-l.originEvent.clientY)>20))return n.jump("drag","user-drag")})),window.addEventListener("mouseup",(function(e){if(u=1,"drag"===n.state())return g(!1),e.stopPropagation(),n.jump("normal","drag-finish")}),!1)})),vr((function(){if(!V.isMobile){var e=this,t=this.minder,n=this.fsm,r=0;["Tab|Insert:AppendChildNode","Enter:AppendSiblingNode","Shift+Tab|Shift+Insert:AppendParentNode","Del|Backspace:RemoveNode","Shift+Del|Shift+Backspace:RemoveSingleNode","Alt+Up:ArrangeUp","Alt+Down:ArrangeDown"].forEach((function(o){var i=o.split(":"),a=i.shift(),s=i.shift();t.addShortcut(a,(function(){0===s.indexOf("Append")?(r++,t.execCommand(s),t.on("layoutallfinish",(function n(){--r||e.editText(),t.off("layoutallfinish",n)}))):(t.execCommand(s),n.jump("normal","command-executed"))}))}))}})),vr((function(){var e,t=this.minder,n={},r=[],o=[];function i(){r=[],o=[],n=t.exportJson()}var a=["replace.zoom","replace.position.x","replace.position.y"];function s(){var e=t.exportJson(),o=fr(e,n);if((o=function(e){return e.filter((function(e){var t=e.op+e.path.split("/").join(".");return!a.includes(t)}))}(o)).length){for(r.push(o);r.length>100;)r.shift();return n=e,!0}}function c(){e=!0;var i,a=r.pop();a&&(t.applyPatches(a),i=t.exportJson(),o.push(fr(i,n)),n=i),e=!1}function l(){e=!0;var n=o.pop();n&&(t.applyPatches(n),s()),e=!1}this.history={reset:i,undo:c,redo:l,hasUndo:function(){return!!r.length},hasRedo:function(){return!!o.length}},t.on("contentchange",p.throttle((function(){e||s()&&(o=[])}),100)),t.on("import",(function(){i()})),t.addShortcut("Ctrl+Z",c),t.addShortcut("Ctrl+Y",l)})),vr((function(){var e=this.fsm,t=this.minder,n=this.receiver,r=n.element,o=!1;n.listen("normal",(function(n){switch(n.is("Space")&&(n.preventDefault(),kity.Browser.safari&&(r.innerHTML="")),n.type){case"keydown":o(n);break;case"keyup":!V.isElectron&&!V.isEdge||t.isKeydown||o(n),t.isKeydown=!1}function o(n){if(!t.isShareModeBeforeSave){if(t.getSelectedNode()){if(function(e){return!(e.ctrlKey||e.metaKey||e.altKey)&&(e.keyCode>=65&&e.keyCode<=90||(e.keyCode>=48&&e.keyCode<=57||(108!=e.keyCode&&e.keyCode>=96&&e.keyCode<=111||(108!=e.keyCode&&e.keyCode>=96&&e.keyCode<=111||(229==e.keyCode||0===e.keyCode||(32===e.keyCode||(e.keyCode,!1)))))))}(n))return n.is("Space")?e.jump("input","user-space"):(t.isKeydown=!0,e.jump("input","user-input"))}else r.innerHTML="";e.jump("normal","shortcut-handle",n),t.dispatchKeyEvent(n)}}})),n.listen("input",(function(t){if("keydown"==t.type){if(!V.isMobile&&t.is("Enter"))return t.preventDefault(),void e.jump("normal","input-commit");if(t.is("Esc"))return t.preventDefault(),e.jump("normal","input-cancel");(t.is("Tab")||t.is("Shift + Tab"))&&t.preventDefault()}else if("keyup"==t.type&&t.is("Esc")){if(t.preventDefault(),!o)return e.jump("normal","input-cancel")}else"compositionstart"==t.type?o=!0:"compositionend"==t.type&&setTimeout((function(){o=!1}))}))})),Mn.Editor=wr,window.aminder=Mn,Mn}();